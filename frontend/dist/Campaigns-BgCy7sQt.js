import{j as e,C as V,a as J,b as K,R as te,c as H,B as g,r as o}from"./index-BmR0vpzv.js";import{CampaignTemplate as X,User as z,Campaign as L,Company as le,Contact as ne}from"./entities-BF_CoRhL.js";import{B}from"./badge-mbvrvUdE.js";import{P as re}from"./progress-yKNMW9vo.js";import{c as Q}from"./createLucideIcon-DHDzDx_v.js";import{P as R}from"./pen-line-JRARnkXA.js";import{T as Y}from"./trash-2-BiKZvKhI.js";import{U as Z}from"./users-BbIiUK-e.js";import{f as ce,M as O}from"./format-BdGktAaM.js";import{C as ie}from"./calendar-DZjZSV9o.js";import{T as oe}from"./target-C_3lQRli.js";import{I as A}from"./input-CifF0tnf.js";import{T as I}from"./textarea-1K8hNfDH.js";import{S as q,a as $,b as M,c as U,d as w}from"./select-Cbc48yfk.js";import{S as de}from"./search-Cmow_l64.js";import{A as me}from"./arrow-right-gOOVZBr_.js";import{P as D}from"./plus-BKHYaIzA.js";import{F as xe}from"./file-text-DlkI9hbD.js";import{M as ue}from"./message-square-CMNkUvf7.js";import{L as ge}from"./LockedFeature-C2dDkowu.js";import{c as he}from"./planLimits-C4PMM81i.js";import{A as pe,a as je,b as fe}from"./alert-DzaN8o21.js";import{T as ye}from"./triangle-alert-CKo9A6by.js";import"./base44Client-C-YMJfZQ.js";import"./index-DMCx0746.js";import"./Combination-DKDTH7Vf.js";import"./proxy-DqViEuMF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],G=Q("Pause",be);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],W=Q("Play",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Ce=Q("UserPlus",Ne);function we({campaign:a,onToggle:_,onEdit:v,onDelete:p,onClick:c}){var N;const x=m=>{const b={active:"bg-green-100 text-green-800",paused:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800"};return b[m]||b.draft},f=m=>{const y={active:W,paused:G,completed:oe,draft:R}[m]||R;return e.jsx(y,{className:"w-4 h-4"})},k=a.sent_count>0?Math.round((a.open_rate||0)*100):0;return a.sent_count>0&&Math.round((a.reply_count||0)/a.sent_count*100),e.jsxs(V,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none hover:shadow-xl transition-all duration-300 cursor-pointer",children:[e.jsxs(J,{className:"pb-3",onClick:()=>c&&c(a),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(K,{className:"text-lg line-clamp-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(B,{className:x(a.status),children:[te.createElement(f(a.status),{className:"w-3 h-3 mr-1"}),a.status]}),e.jsx(B,{variant:"outline",className:"text-xs",children:(N=a.campaign_type)==null?void 0:N.replace("_"," ")})]})]})}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Created ",ce(new Date(a.created_date),"MMM dd, yyyy")]})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:a.sent_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:[k,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Open Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:a.reply_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Replies"})]})]}),a.status==="active"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[a.sent_count||0," / ",(a.target_contacts||[]).length]})]}),e.jsx(re,{value:(a.target_contacts||[]).length>0?(a.sent_count||0)/(a.target_contacts||[]).length*100:0,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:m=>{m.stopPropagation(),_(a.id,a.status)},disabled:a.status==="completed",className:"h-8",children:[a.status==="active"?e.jsx(G,{className:"w-3 h-3 mr-1"}):e.jsx(W,{className:"w-3 h-3 mr-1"}),a.status==="active"?"Pause":"Start"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:m=>{m.stopPropagation(),v(a)},className:"h-8",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Edit"]})]}),e.jsx(g,{size:"sm",variant:"outline",onClick:m=>{m.stopPropagation(),p(a.id)},className:"h-8 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Y,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),(a.target_contacts||[]).length," contacts"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),(a.sequence_steps||[]).length," steps"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),a.status==="active"?"Running":"Paused"]})]})]})]})}function _e({onSelectTemplate:a,onClose:_}){const[v,p]=o.useState([]),[c,x]=o.useState([]),[f,k]=o.useState(""),[N,m]=o.useState("all"),[b,y]=o.useState(!0),S=[{value:"all",label:"All Templates"},{value:"prospecting",label:"Prospecting"},{value:"nurturing",label:"Nurturing"},{value:"demo",label:"Demo & Discovery"},{value:"closing",label:"Closing"},{value:"followup",label:"Follow-up"}],u=async()=>{try{const s=await X.filter({is_active:!0},"name"),n=Array.isArray(s)?s:s!=null&&s.data&&Array.isArray(s.data)?s.data:[];p(n)}catch(s){console.error("Error loading templates:",s),p([])}y(!1)},P=o.useCallback(()=>{let s=v;f&&(s=s.filter(n=>n.name.toLowerCase().includes(f.toLowerCase())||n.objective.toLowerCase().includes(f.toLowerCase())||n.audience.toLowerCase().includes(f.toLowerCase()))),N!=="all"&&(s=s.filter(n=>n.category===N)),x(s)},[v,f,N]);o.useEffect(()=>{u()},[]),o.useEffect(()=>{P()},[P]);const T=s=>({prospecting:"bg-blue-100 text-blue-800",nurturing:"bg-green-100 text-green-800",demo:"bg-purple-100 text-purple-800",closing:"bg-orange-100 text-orange-800",followup:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",t=s=>{switch(s){case"email":return"ðŸ“§";case"linkedin_connect":return"ðŸ”—";case"linkedin_message":return"ðŸ’¼";default:return"ðŸ“„"}};return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-center",children:"Loading templates..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Choose Campaign Template"}),e.jsx(g,{variant:"outline",onClick:_,children:"Close"})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(A,{placeholder:"Search templates...",value:f,onChange:s=>k(s.target.value),className:"pl-10"}),e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]}),e.jsx("div",{className:"flex gap-2",children:S.map(s=>e.jsx(g,{variant:N===s.value?"default":"outline",size:"sm",onClick:()=>m(s.value),children:s.label},s.value))})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No templates found matching your criteria."}),e.jsx(g,{variant:"outline",onClick:()=>{k(""),m("all")},children:"Clear Filters"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(s=>e.jsxs(V,{className:"hover:shadow-lg transition-shadow cursor-pointer border-2 hover:border-blue-300",onClick:()=>a(s),children:[e.jsx(J,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(K,{className:"text-lg mb-2",children:s.name}),e.jsx(B,{className:T(s.category),children:s.category})]}),e.jsx(me,{className:"w-5 h-5 text-gray-400"})]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.objective}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:s.audience}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["Sequence (",s.steps.length," steps):"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.steps.slice(0,4).map((n,i)=>e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",title:n.subject||n.message,children:[t(n.type)," Day ",n.day_offset]},i)),s.steps.length>4&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.steps.length-4," more"]})]})]})]})]},s.id))})})]})})}function ke({campaign:a,onClose:_}){const[v,p]=o.useState(!1),[c,x]=o.useState({name:"",campaign_type:"email_only",status:"draft",email_template:"",linkedin_template:"",subject_line:"",target_companies:[],target_contacts:[],sequence_steps:[]}),[f,k]=o.useState([]),[N,m]=o.useState(!1);o.useEffect(()=>{a&&x({name:a.name||"",campaign_type:a.campaign_type||"email_only",status:a.status||"draft",email_template:a.email_template||"",linkedin_template:a.linkedin_template||"",subject_line:a.subject_line||"",target_companies:a.target_companies||[],target_contacts:a.target_contacts||[],sequence_steps:a.sequence_steps||[]})},[a]),o.useEffect(()=>{(async()=>{m(!0);try{const s=await z.all();k(s)}catch(s){console.error("Failed to load available contacts:",s)}finally{m(!1)}})()},[]);const b=async t=>{t.preventDefault();try{const s=await z.me(),n={...c,created_by:s.email};a?await L.update(a.id,n):await L.create(n),_()}catch(s){console.error("Error saving campaign:",s),alert("Failed to save campaign. Please try again.")}},y=t=>{x(s=>{var n,i,E;return{...s,name:t.name,email_template:((n=t.steps.find(h=>h.type==="email"))==null?void 0:n.body)||"",subject_line:((i=t.steps.find(h=>h.type==="email"))==null?void 0:i.subject)||"",linkedin_template:((E=t.steps.find(h=>h.type==="linkedin_message"))==null?void 0:E.message)||"",sequence_steps:t.steps.map((h,F)=>({step_number:F+1,type:h.type,wait_days:h.day_offset,template:h.body||h.message||"",subject:h.subject||""}))}}),p(!1)},S=()=>{const t={step_number:c.sequence_steps.length+1,type:"email",wait_days:c.sequence_steps.length===0?0:3,template:"",subject:""};x({...c,sequence_steps:[...c.sequence_steps,t]})},u=(t,s,n)=>{const i=[...c.sequence_steps];i[t][s]=n,x({...c,sequence_steps:i})},P=t=>{const s=c.sequence_steps.filter((n,i)=>i!==t);s.forEach((n,i)=>{n.step_number=i+1}),x({...c,sequence_steps:s})},T=t=>{switch(t){case"email":return e.jsx(O,{className:"w-4 h-4"});case"linkedin":return e.jsx(Ce,{className:"w-4 h-4"});case"linkedin_message":return e.jsx(ue,{className:"w-4 h-4"});default:return e.jsx(O,{className:"w-4 h-4"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a?"Edit Campaign":"Create New Campaign"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>p(!0),children:"Use Template"}),e.jsx(g,{variant:"outline",onClick:_,children:"Close"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Name"}),e.jsx(A,{required:!0,value:c.name,onChange:t=>x({...c,name:t.target.value}),placeholder:"e.g., Q1 Manufacturing Outreach"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Type"}),e.jsxs(q,{value:c.campaign_type,onValueChange:t=>x({...c,campaign_type:t}),children:[e.jsx($,{children:e.jsx(M,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"email_only",children:"Email Only"}),e.jsx(w,{value:"linkedin_only",children:"LinkedIn Only"}),e.jsx(w,{value:"email_linkedin_sequence",children:"Email + LinkedIn"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs(q,{value:c.status,onValueChange:t=>x({...c,status:t}),children:[e.jsx($,{children:e.jsx(M,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"draft",children:"Draft"}),e.jsx(w,{value:"active",children:"Active"}),e.jsx(w,{value:"paused",children:"Paused"}),e.jsx(w,{value:"completed",children:"Completed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Companies (comma-separated)"}),e.jsx(I,{value:c.target_companies.join(", "),onChange:t=>x({...c,target_companies:t.target.value.split(",").map(s=>s.trim()).filter(Boolean)}),placeholder:"e.g., Google, Microsoft, Apple",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Contacts (email addresses, comma-separated)"}),e.jsx(I,{value:c.target_contacts.join(", "),onChange:t=>x({...c,target_contacts:t.target.value.split(",").map(s=>s.trim()).filter(Boolean)}),placeholder:"e.g., john.doe@example.com, jane.smith@example.com",rows:3}),N?e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Loading available contacts..."}):f.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Available: ",f.map(t=>t.email).join(", ").substring(0,100),f.length>5?"...":""]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Campaign Sequence"}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),c.sequence_steps.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-3",children:"No sequence steps yet"}),e.jsxs(g,{type:"button",variant:"outline",onClick:()=>p(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Use Template"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"or"}),e.jsxs(g,{type:"button",variant:"outline",onClick:S,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Create Step"]})]}):e.jsx("div",{className:"space-y-3",children:c.sequence_steps.map((t,s)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:t.step_number}),e.jsxs("span",{className:"font-medium",children:["Step ",t.step_number]}),T(t.type)]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(s),children:e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Type"}),e.jsxs(q,{value:t.type,onValueChange:n=>u(s,"type",n),children:[e.jsx($,{children:e.jsx(M,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"email",children:"Email"}),e.jsx(w,{value:"linkedin",children:"LinkedIn Connect"}),e.jsx(w,{value:"linkedin_message",children:"LinkedIn Message"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Wait Days"}),e.jsx(A,{type:"number",min:"0",value:t.wait_days,onChange:n=>u(s,"wait_days",parseInt(n.target.value)||0)})]}),t.type==="email"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Subject"}),e.jsx(A,{value:t.subject||"",onChange:n=>u(s,"subject",n.target.value),placeholder:"Email subject..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:t.type==="email"?"Email Content":"LinkedIn Message"}),e.jsx(I,{value:t.template,onChange:n=>u(s,"template",n.target.value),placeholder:t.type==="email"?"Email body...":"LinkedIn message...",rows:4})]})]},s))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(g,{type:"button",variant:"outline",onClick:_,children:"Cancel"}),e.jsx(g,{type:"submit",children:a?"Update Campaign":"Create Campaign"})]})]})})]})}),v&&e.jsx(_e,{onSelectTemplate:y,onClose:()=>p(!1)})]})}const j=a=>Array.isArray(a)?a:a&&typeof a=="object"&&Array.isArray(a.data)?a.data:[];function es(){const[a,_]=o.useState(null),[v,p]=o.useState([]),[c,x]=o.useState([]),[f,k]=o.useState([]),[N,m]=o.useState([]),[b,y]=o.useState(!0),[S,u]=o.useState(null),[P,T]=o.useState(!1),[t,s]=o.useState(null),[n,i]=o.useState(""),[E,h]=o.useState(!1);o.useEffect(()=>{(async()=>{y(!0),u(null),i("Starting to load all data (user, campaigns, companies, contacts, templates)...");try{console.log("CampaignsPage: Loading user data...");const d=await z.me();if(_(d),console.log("CampaignsPage: User loaded:",d),!he(d,"campaigns")){console.log("CampaignsPage: User does not have campaigns access"),h(!1),y(!1),i("User does not have access to Campaigns feature.");return}h(!0),console.log("CampaignsPage: User has campaigns access, loading entities...");try{i(r=>r+`
Loading campaigns...`);const l=await L.filter({created_by:d.email},"-created_date");p(j(l)),console.log("CampaignsPage: Campaigns loaded:",j(l).length),i(r=>r+`
Loaded ${j(l).length} campaigns.`)}catch(l){console.error("CampaignsPage: Failed to load campaigns:",l),u(r=>(r?r+`
`:"")+`Failed to load campaigns: ${l.message}`),i(r=>r+`
ERROR loading campaigns: ${l.message}`),p([])}try{i(r=>r+`
Loading companies...`);const l=await le.list("-created_date",100);x(j(l)),console.log("CampaignsPage: Companies loaded:",j(l).length),i(r=>r+`
Loaded ${j(l).length} companies.`)}catch(l){console.error("CampaignsPage: Failed to load companies:",l),u(r=>(r?r+`
`:"")+`Failed to load companies: ${l.message}`),i(r=>r+`
ERROR loading companies: ${l.message}`),x([])}try{i(r=>r+`
Loading contacts...`);const l=await ne.list("-created_date",500);k(j(l)),console.log("CampaignsPage: Contacts loaded:",j(l).length),i(r=>r+`
Loaded ${j(l).length} contacts.`)}catch(l){console.error("CampaignsPage: Failed to load contacts:",l),u(r=>(r?r+`
`:"")+`Failed to load contacts: ${l.message}`),i(r=>r+`
ERROR loading contacts: ${l.message}`),k([])}try{i(r=>r+`
Loading templates...`);const l=await X.filter({is_active:!0},"name");m(j(l)),console.log("CampaignsPage: Templates loaded:",j(l).length),i(r=>r+`
Loaded ${j(l).length} templates.`)}catch(l){console.error("CampaignsPage: Failed to load templates:",l),u(r=>(r?r+`
`:"")+`Failed to load templates: ${l.message}`),i(r=>r+`
ERROR loading templates: ${l.message}`),m([])}}catch(d){console.error("CampaignsPage: Critical error loading user or initial data:",d);const l=`Failed to load initial data (user/access): ${d.message}`;u(l),h(!1),i(`CRITICAL ERROR: ${l}`),d.message.includes("fetch")&&i(r=>r+" | Network error detected - check Base44 backend connectivity")}finally{y(!1)}})()},[]);const F=()=>{s(null),T(!0)},ee=C=>{s(C),T(!0)},se=async C=>{t?await L.update(t.id,C):await L.create(C),T(!1),s(null),y(!0);try{const d=a;if(d){const l=await L.filter({created_by:d.email},"-created_date");p(j(l)),u(null)}}catch(d){console.error("Failed to refresh campaigns after save:",d),u(`Failed to refresh campaigns: ${d.message}`)}finally{y(!1)}},ae=async C=>{await L.delete(C),y(!0);try{const d=a;if(d){const l=await L.filter({created_by:d.email},"-created_date");p(j(l)),u(null)}}catch(d){console.error("Failed to refresh campaigns after delete:",d),u(`Failed to refresh campaigns: ${d.message}`)}finally{y(!1)}};return b?e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 h-full bg-[#F6F8FB] min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1E5EFF] mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading data..."}),n&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded text-xs text-gray-700 max-w-md",children:["Debug: ",n]})]}):!E&&!b?e.jsx(ge,{featureName:"Campaigns"}):P||t?e.jsx(ke,{campaign:t,onSave:se,onClose:()=>{T(!1),s(null)}}):e.jsx("div",{className:"p-6 bg-[#F6F8FB] min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Campaigns"}),e.jsxs(g,{onClick:F,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),S&&e.jsxs(pe,{variant:"destructive",className:"mb-6",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(je,{children:"Data Loading Error"}),e.jsxs(fe,{children:[S,e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"This indicates a backend connectivity issue or missing data. Please contact Base44 support if this persists."}),n&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs",children:"Technical Details"}),e.jsx("pre",{className:"text-xs mt-1 bg-gray-100 p-2 rounded whitespace-pre-wrap",children:n})]})]})]}),v.length===0&&!b&&!S&&e.jsx(V,{className:"text-center p-12 border-2 border-dashed",children:e.jsxs(H,{children:[e.jsx(Z,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No campaigns yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new outreach campaign."}),e.jsx("div",{className:"mt-6",children:e.jsxs(g,{onClick:F,children:[e.jsx(D,{className:"mr-2 h-4 w-4"})," Create Campaign"]})})]})}),!b&&!S&&v.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(C=>e.jsx(we,{campaign:C,onEdit:ee,onDelete:ae},C.id))})]})})}export{es as default};
