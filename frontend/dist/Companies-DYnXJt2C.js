import{r as i,j as e,B as h,R as ie,u as le}from"./index-G9C_8T3I.js";import{CompanySave as T,Company as ne,User as oe}from"./entities-BF_CoRhL.js";import{I as ce}from"./input-DMFbO1PS.js";import{c as $}from"./index-A7ElDbZk.js";import{c as W}from"./planLimits-C4PMM81i.js";import{L as de}from"./LockedFeature-BB6Qo6n3.js";import{B as me}from"./badge-NQQeEk5P.js";import{D as G,a as H,b as Q,c as k,d as J}from"./dropdown-menu-BoZWrhED.js";import{m as R}from"./proxy-CSNf8dJE.js";import{B as X}from"./building-2-DuB8deBv.js";import{c as Y}from"./createLucideIcon-CZoKmv7U.js";import{E as Z,T as xe,A as he,C as ue}from"./CompanyDetailModal-kfmJo87E.js";import{E}from"./eye-d-DQEqRC.js";import{M as I,f as K}from"./format-CwCFaA-X.js";import{T as ee}from"./trash-2-CmDHxHWL.js";import{S as U}from"./ship-BpOpyZCE.js";import{T as se,P as pe}from"./truck-BHqXHKJL.js";import{U as ge}from"./UpgradePrompt-DMrvyij-.js";import{S as O}from"./search-DfotrM1P.js";import{C as fe}from"./circle-alert-Dr6ykTjt.js";import{L as je}from"./list-CT-zrj-S.js";import"./base44Client-C-YMJfZQ.js";import"./textarea-B5fFurcT.js";import"./index-C3p_Ua7M.js";import"./Combination-BxtzCso3.js";import"./index-DSjVBQf_.js";import"./index-DeDnLdjp.js";import"./dialog-CTExk-_V.js";import"./tabs-Bozvi6YO.js";import"./functions-BYakpOaC.js";import"./select-CcSYJjxg.js";import"./label-BJzTirfi.js";import"./loader-circle-CbhLENjE.js";import"./plus-CLzajg8b.js";import"./users-BRpiVyF2.js";import"./message-square-NFx75o6H.js";import"./trending-up-Dcc0kElN.js";import"./zap-Cjbe-0FU.js";import"./arrow-right-Ft_qmhnN.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ye=Y("Grid3x3",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],te=Y("MapPin",ve);function be({company:s,onDelete:j,onView:p,onStartOutreach:l}){var m,C;const[g,f]=i.useState(!1),u=r=>r==null||isNaN(r)?"N/A":r>=1e6?`${(r/1e6).toFixed(1)}M kg`:r>=1e3?`${(r/1e3).toFixed(0)}K kg`:`${r.toFixed(0)} kg`,b=s.total_weight_12m||0,_=s.shipments_12m||0,w=((m=s.top_routes)==null?void 0:m[0])||"Various routes",a=((C=s.top_carriers)==null?void 0:C[0])||"Multiple carriers",d=(r=>!r||typeof r!="object"?[]:Object.entries(r).filter(([,c])=>c>5).sort(([,c],[,N])=>N-c).slice(0,2))(s.mode_mix_json),M=()=>{f(!1),j?j(s.id):console.warn("onDelete handler not provided to CompanyCard")};return e.jsxs(R.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-2},className:"bg-white/90 backdrop-blur-sm rounded-2xl p-5 shadow-lg border border-gray-200/60 hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate text-lg mb-1",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.industry||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:[s.hq_city,s.hq_country].filter(Boolean).join(", ")||"N/A"})]})]})]}),e.jsxs(G,{open:g,onOpenChange:f,children:[e.jsx(H,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"w-4 h-4"})})}),e.jsxs(Q,{align:"end",children:[e.jsxs(k,{onClick:p,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(k,{onClick:()=>l(s),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Start Outreach"]}),e.jsx(J,{}),e.jsxs(k,{onClick:M,className:"text-red-600 focus:bg-red-50 focus:text-red-700",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"Total Weight (12m)"}),e.jsx("div",{className:"text-base font-bold text-blue-900",children:u(b)})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-purple-600 font-medium",children:"Shipments"}),e.jsx("div",{className:"text-base font-bold text-purple-900",children:_.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Route:"}),e.jsx("span",{className:"font-medium text-gray-900 truncate flex-1",children:w})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Carrier:"}),e.jsx("span",{className:"font-medium text-gray-900 truncate flex-1",children:a})]})]}),d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:d.map(([r,c])=>{const N={ocean:"bg-blue-100 text-blue-800",air:"bg-purple-100 text-purple-800",truck:"bg-green-100 text-green-800",rail:"bg-orange-100 text-orange-800"};return e.jsxs(me,{className:`text-xs ${N[r]||"bg-gray-100 text-gray-800"}`,children:[r.charAt(0).toUpperCase()+r.slice(1)," ",Math.round(c),"%"]},r)})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.enrichment_status==="enriched"?"bg-green-500":s.enrichment_status==="pending"?"bg-yellow-500":"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:s.enrichment_status||"none"})]}),e.jsx("span",{children:s.last_seen?`Last: ${K(new Date(s.last_seen),"MMM d")}`:"No recent activity"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:p,className:"flex-1",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(h,{size:"sm",onClick:()=>l(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Contact"]})]})]})}function we({company:s,onUpdate:j,onView:p,onStartOutreach:l,onDelete:g,index:f=0}){var c,N;const[u,b]=i.useState(!1),_=o=>o?o>=1e6?`${(o/1e6).toFixed(1)}M kg`:o>=1e3?`${(o/1e3).toFixed(0)}K kg`:`${o.toFixed(0)} kg`:"N/A",w=s.total_weight_12m||0,a=s.shipments_12m||0,F=((c=s.top_routes)==null?void 0:c[0])||"Various routes",d=((N=s.top_carriers)==null?void 0:N[0])||"Multiple carriers",m=(o=>{if(!o||typeof o!="object")return null;const D=Object.entries(o);if(D.length===0)return null;const[P,x]=D.reduce((A,S)=>A[1]>S[1]?A:S);return{mode:P,percentage:Math.round(x)}})(s.mode_mix_json),C=o=>({ocean:U,air:pe,truck:se,rail:xe})[o]||U,r=async()=>{g?g(s.id):console.warn("onDelete prop not provided to CompanyListItem. Cannot delete company."),b(!1)};return e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:f*.05},className:"p-4 hover:bg-gray-50/80 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsx("div",{className:`w-2 h-2 rounded-full ${s.enrichment_status==="enriched"?"bg-green-500":s.enrichment_status==="pending"?"bg-yellow-500":"bg-gray-300"}`,title:`Enrichment status: ${s.enrichment_status||"N/A"}`})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",title:"Industry",children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{children:s.industry||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-1",title:"Headquarters location",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsx("span",{children:[s.hq_city,s.hq_country].filter(Boolean).join(", ")||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{title:"Total weight shipped in last 12 months",children:[e.jsx("span",{className:"text-gray-500",children:"Weight (12m):"}),e.jsx("span",{className:"ml-1 font-medium text-blue-700",children:_(w)})]}),e.jsxs("div",{title:"Total shipments in last 12 months",children:[e.jsx("span",{className:"text-gray-500",children:"Shipments:"}),e.jsx("span",{className:"ml-1 font-medium text-purple-700",children:a.toLocaleString()})]}),e.jsxs("div",{className:"md:col-span-2",title:"Top shipping route",children:[e.jsx("span",{className:"text-gray-500",children:"Route:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900 truncate",children:F})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm mt-2",children:[e.jsxs("div",{title:"Primary shipping carrier",children:[e.jsx("span",{className:"text-gray-500",children:"Primary Carrier:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900 truncate",children:d})]}),m&&e.jsxs("div",{className:"flex items-center gap-1",title:`Primary mode of transport: ${m.mode}`,children:[e.jsx("span",{className:"text-gray-500",children:"Main Mode:"}),ie.createElement(C(m.mode),{className:"w-3 h-3 text-gray-600 ml-1 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-gray-900 capitalize",children:[m.mode," (",m.percentage,"%)"]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:s.last_seen?`Last activity: ${K(new Date(s.last_seen),"MMM d, yyyy")}`:"No recent activity"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:p,className:"hidden sm:inline-flex",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(h,{size:"sm",onClick:()=>l(s),className:"bg-blue-600 hover:bg-blue-700 text-white hidden sm:inline-flex",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Contact"]}),e.jsxs(G,{open:u,onOpenChange:b,children:[e.jsx(H,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"w-4 h-4"})})}),e.jsxs(Q,{align:"end",children:[e.jsxs(k,{onClick:p,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(k,{onClick:()=>l(s),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Start Outreach"]}),g&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsxs(k,{onClick:r,className:"text-red-600 focus:bg-red-50 focus:text-red-700",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]})]})]})]})})}function cs(){const[s,j]=i.useState([]),[p,l]=i.useState(!0),[g,f]=i.useState(null),[u,b]=i.useState(""),[_,w]=i.useState(!1),[a,F]=i.useState(null),[d,M]=i.useState("cards"),[m,C]=i.useState(null),[r,c]=i.useState(!1),[N,o]=i.useState(1),[D,P]=i.useState(0),[x,A]=i.useState(null),S=le(),L=i.useCallback(async()=>{if(x===!1){console.log("ðŸš« Access denied. Not loading saved companies."),l(!1);return}if(!a){console.log("â³ Waiting for appUser to be loaded before fetching companies..."),l(!1);return}l(!0),f(null);try{console.log("ðŸ” Fetching CompanySave records for user:",a.email);const t=await T.filter({created_by:a.email});if(console.log("âœ… Found saved records:",t.length),await new Promise(v=>setTimeout(v,100)),t.length===0){console.log("ðŸ“ No saved companies found"),j([]),P(0),l(!1);return}const n=t.map(v=>v.company_id).filter(Boolean);console.log("ðŸ” Fetching details for company IDs:",n),await new Promise(v=>setTimeout(v,100));const y=await ne.filter({id:{op:"in",value:n}});console.log("âœ… Found company details:",y.length);const q=u.trim()?y.filter(v=>(v.name||"").toLowerCase().includes(u.toLowerCase())):y;j(q),P(q.length)}catch(t){console.error("âŒ Error loading saved companies:",t),f((t==null?void 0:t.message)||"Failed to load saved companies"),j([]),P(0)}finally{l(!1)}},[u,x,a]);i.useEffect(()=>{(async()=>{l(!0);try{console.log("ðŸ” Checking user access for 'company_details' feature...");const n=await oe.me();F(n);const y=W(n,"company_details");A(y),console.log(`âœ… Access for 'company_details': ${y}`),l(!1)}catch(n){console.error("âŒ Error checking feature access or loading user:",n),A(!1),f("Failed to check access. Please try again."),l(!1)}})()},[]),i.useEffect(()=>{if(x===!0&&a){const t=setTimeout(()=>{L()},300);return()=>clearTimeout(t)}else x===!0&&!a&&l(!0)},[u,L,x,a]);const ae=t=>{t.key==="Enter"&&L()},z=t=>{if(!W(a,"company_details")){console.log("ðŸš« User does not have access to 'company_details'. Showing upgrade prompt."),w(!0);return}C(t),c(!0)},V=t=>{console.log("ðŸš€ Starting outreach for company:",t.name),S($(`EmailCenter?company_id=${t.id}`))},B=async t=>{if(!a){console.warn("User not loaded. Cannot delete company save record."),alert("User not logged in. Cannot delete company.");return}if(window.confirm("Are you sure you want to remove this company from your saved list?"))try{console.log("ðŸ” Attempting to delete CompanySave record for company ID:",t,"by user:",a.email);const n=await T.filter({created_by:a.email,company_id:t});n.length>0?(await T.delete(n[0].id),console.log("âœ… Company save record successfully deleted."),L()):(console.log("âŒ No matching CompanySave record found for deletion."),alert("Company save record not found."))}catch(n){console.error("âŒ Failed to remove company from saved list:",n),alert("Failed to remove company. Please try again.")}},re=()=>{console.log("ðŸ“ Company is already saved - no action needed from modal save button.")};return p&&x===null?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x===!1?(console.log("ðŸ”’ Displaying LockedFeature due to denied access."),e.jsx(de,{featureName:"Viewing Saved Companies"})):e.jsx("div",{className:"p-4 md:p-6 lg:p-8 bg-gradient-to-br from-gray-50 to-blue-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 lg:mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900",children:"Saved Companies"}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base",children:"All companies you've saved from your search results."}),a&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["User: ",a.email," | Plan: ",a.plan||"free"]})]}),e.jsxs(h,{onClick:()=>S($("Search")),className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Find Companies to Save"]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 shadow-lg border border-gray-200/60 mb-6 md:mb-8",children:e.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{placeholder:"Search your saved companies by name...",value:u,onChange:t=>b(t.target.value),onKeyPress:ae,className:"pl-10 bg-gray-50 border-0 text-base"}),e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})})}),g&&e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-6 flex items-center gap-3",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Data Retrieval Error"}),e.jsx("p",{children:g})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-gray-600 text-sm md:text-base",children:["Showing"," ",e.jsxs("span",{className:"font-medium",children:[s.length," of ",D," saved companies"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsxs(h,{variant:d==="cards"?"default":"ghost",size:"sm",onClick:()=>M("cards"),className:"h-8 px-3",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Cards"]}),e.jsxs(h,{variant:d==="list"?"default":"ghost",size:"sm",onClick:()=>M("list"),className:"h-8 px-3",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"List"]})]})})]}),e.jsx(he,{mode:"wait",children:p&&x!==!1?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.length>0?e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:d==="cards"?"grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6":"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 overflow-hidden",children:s.map((t,n)=>d==="cards"?e.jsx(be,{company:t,onDelete:()=>B(t.id),onView:()=>z(t),onStartOutreach:()=>V(t)},t.id):e.jsx(we,{company:t,onView:()=>z(t),onStartOutreach:()=>V(t),onDelete:()=>B(t.id),index:n},t.id))},d):e.jsxs("div",{className:"text-center py-12 md:py-16",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-600 mb-2",children:"No Saved Companies Found"}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm md:text-base px-4",children:"Go to the Search page to find and save companies to your list."}),e.jsxs(h,{onClick:()=>S($("Search")),className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Find Companies to Save"]})]})}),e.jsx(ue,{isOpen:r,onClose:()=>c(!1),company:m,user:a,onSave:re}),e.jsx(ge,{isOpen:_,onClose:()=>w(!1),feature:"company_details",currentPlan:a==null?void 0:a.plan})]})})}export{cs as default};
