import{r as p,j as e,C as k,a as I,b as D,c as M,B as N}from"./index-BAKPb1QP.js";import{D as _e,a as Se,b as Me,c as Ae,X as Ie}from"./dialog-BavuU3xq.js";import{B as A}from"./badge-BphqTXNQ.js";import{T as De,a as Le,b as F,c as P}from"./tabs-Dt56en1C.js";import{Contact as V,Note as le}from"./entities-BF_CoRhL.js";import{c as Ee}from"./index-A7ElDbZk.js";import{t as ie,p as Te,e as oe,g as $e,a as Fe}from"./functions-DZ6U6PmF.js";import{B as Q}from"./building-2-BVbKPFX-.js";import{c as C}from"./createLucideIcon-BDqU3BKp.js";import{T as B,P as Z}from"./truck-DpcrLGmf.js";import{S as L}from"./ship-D3vhigS_.js";import{f as R,M as me}from"./format-BguTH7K8.js";import{S as W,a as J,b as X,c as Y,d as S}from"./select-DB9F_2eo.js";import{I as z}from"./input-kNnbxgwk.js";import{L as T}from"./label-D9Ltm05_.js";import{D as Pe,a as ze,b as Ue,c as ce}from"./dropdown-menu-B0Uq1z3g.js";import{L as O}from"./loader-circle-CtorJgkS.js";import{S as qe}from"./search-j_ivXtL6.js";import{P as xe}from"./plus-CE1C5Hg5.js";import{L as he,T as Ve}from"./textarea-CfBTYPRA.js";import{U as pe}from"./users-BRdwJaYn.js";import{M as Be}from"./message-square-DYpBUJuc.js";import{T as Oe}from"./trash-2-Cvu9Ejvo.js";import{T as Re}from"./trending-up-BHd3P9nq.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],ue=C("Bookmark",He);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],We=C("ChartColumn",Ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Xe=C("EllipsisVertical",Je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],Qe=C("Filter",Ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ke=C("Globe",Ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],de=C("Linkedin",es);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],as=C("Package",ss);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],rs=C("Phone",ts);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],q=C("Sparkles",ns);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],is=C("SquarePen",ls);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]],K=C("TramFront",cs);function ds({company:s,isLoading:c}){const r=p.useMemo(()=>s?{totalShipments:s.shipments_12m||0,topRoute:s.top_route||"N/A",topCarriers:s.top_carriers||[],modeBreakdown:s.mode_breakdown||[]}:null,[s]),i=l=>({ocean:L,air:Z,truck:B,rail:K,unknown:L})[l]||L;return c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Company Details"]})}),e.jsxs(M,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Industry:"}),e.jsx("p",{className:"font-medium",children:s.industry||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Headquarters:"}),e.jsx("p",{className:"font-medium",children:[s.hq_city,s.hq_country].filter(Boolean).join(", ")||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Domain:"}),e.jsx("p",{className:"font-medium",children:s.domain?e.jsx("a",{href:`http://${s.domain}`,target:"_blank",rel:"noopener noreferrer",className:"ml-1 text-blue-600 hover:underline",children:s.domain}):"Not specified"})]}),s.employee_count&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Employees:"}),e.jsx("p",{className:"font-medium",children:s.employee_count.toLocaleString()})]})]})]}),e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Trade Activity Overview"]})}),e.jsxs(M,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Shipments (12m):"}),e.jsx("p",{className:"font-bold text-purple-700 text-lg",children:((r==null?void 0:r.totalShipments)||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Top Route:"}),e.jsx("p",{className:"font-medium",children:r==null?void 0:r.topRoute})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Seen:"}),e.jsx("p",{className:"font-medium",children:s.last_seen?R(new Date(s.last_seen),"MMM d, yyyy"):"No recent activity"})]})]})]})]}),r&&e.jsx("div",{className:"grid md:grid-cols-1 gap-6",children:e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Primary Carriers"]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-3",children:r.topCarriers.length>0?r.topCarriers.map((l,u)=>e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l})},u)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No carrier data available"})})})]})}),r&&r.modeBreakdown.length>0&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsx(D,{className:"text-lg",children:"Transportation Modes"})}),e.jsx(M,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:r.modeBreakdown.map(l=>{const u=i(l.mode),t=r.totalShipments,d=t>0?(l.cnt/t*100).toFixed(1):0;return e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx(u,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("h4",{className:"font-semibold capitalize text-gray-900",children:l.mode}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.cnt," shipments (",d,"%)"]})]},l.mode)})})})]}),s.top_hs&&s.top_hs.length>0&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Top Commodities (HS Codes)"]})}),e.jsx(M,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.top_hs.slice(0,10).map((l,u)=>e.jsx(A,{variant:"outline",className:"text-xs",children:l},u))})})]})]})}function os({shipments:s,isLoading:c}){const[r,i]=p.useState("date"),[l,u]=p.useState("desc"),[t,d]=p.useState("all"),m=a=>a==null?"N/A":a>=1e6?`${(a/1e6).toFixed(1)}M kg`:a>=1e3?`${(a/1e3).toFixed(0)}K kg`:`${a.toFixed(0)} kg`,j=p.useMemo(()=>{let a=s;return t!=="all"&&(a=s.filter(o=>{var g;return((g=o.mode)==null?void 0:g.toLowerCase())===t})),Array.isArray(a)||(a=[]),[...a].sort((o,g)=>{let n=o[r],x=g[r];return n==null&&(n=""),x==null&&(x=""),r==="date"?(n=n?new Date(n):new Date(0),x=x?new Date(x):new Date(0)):r==="gross_weight_kg"&&(n=n||0,x=x||0),l==="asc"?typeof n=="string"&&typeof x=="string"?n.localeCompare(x):n>x?1:-1:typeof n=="string"&&typeof x=="string"?x.localeCompare(n):n<x?1:-1})},[s,r,l,t]),f=a=>{const g={ocean:L,air:Z,truck:B,rail:K}[a==null?void 0:a.toLowerCase()]||L;return e.jsx(g,{className:"w-4 h-4"})},v=a=>({ocean:"bg-blue-100 text-blue-800",air:"bg-purple-100 text-purple-800",truck:"bg-green-100 text-green-800",rail:"bg-orange-100 text-orange-800"})[a==null?void 0:a.toLowerCase()]||"bg-gray-100 text-gray-800";return c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):!s||s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No shipment data"}),e.jsx("p",{className:"text-gray-500",children:"No shipment records found for this company"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),e.jsxs(W,{value:t,onValueChange:d,children:[e.jsx(J,{className:"w-32",children:e.jsx(X,{placeholder:"All Modes"})}),e.jsxs(Y,{children:[e.jsx(S,{value:"all",children:"All Modes"}),e.jsx(S,{value:"ocean",children:"Ocean"}),e.jsx(S,{value:"air",children:"Air"}),e.jsx(S,{value:"truck",children:"Truck"}),e.jsx(S,{value:"rail",children:"Rail"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs(W,{value:r,onValueChange:i,children:[e.jsx(J,{className:"w-32",children:e.jsx(X,{placeholder:"Date"})}),e.jsxs(Y,{children:[e.jsx(S,{value:"date",children:"Date"}),e.jsx(S,{value:"gross_weight_kg",children:"Weight"}),e.jsx(S,{value:"carrier_name",children:"Carrier"}),e.jsx(S,{value:"origin_country",children:"Origin"})]})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>u(l==="asc"?"desc":"asc"),children:l==="asc"?"↑":"↓"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[j.length," of ",s.length," shipments"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Mode"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Route"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Weight"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Carrier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Commodity"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.slice(0,50).map((a,o)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 whitespace-nowrap",children:a.date?R(new Date(a.date),"MMM d, yyyy"):"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[f(a.mode),e.jsx(A,{className:`text-xs ${v(a.mode)}`,children:a.mode||"Unknown"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-xs overflow-hidden",children:[e.jsx("div",{className:"font-medium truncate",children:a.origin_country||a.origin_port||"Unknown"}),e.jsxs("div",{className:"text-gray-500 text-xs truncate",children:["→ ",a.dest_country||a.dest_port||"Unknown"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-blue-700 whitespace-nowrap",children:m(a.gross_weight_kg)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"max-w-xs truncate",children:a.carrier_name||a.carrier||"Unknown"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsx("div",{className:"max-w-xs truncate",children:a.commodity_description||a.hs_code||"N/A"})})]},a.id||o))})]})}),j.length>50&&e.jsx("div",{className:"bg-gray-50 px-4 py-3 text-center border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing first 50 shipments. ",j.length-50," more available."]})})]})]})}function ms({onSubmit:s,onCancel:c}){const[r,i]=p.useState({full_name:"",title:"",dept:"",email:"",phone:"",linkedin:""}),l=t=>{if(t.preventDefault(),!r.full_name.trim()){alert("Full name is required");return}s(r),i({full_name:"",title:"",dept:"",email:"",phone:"",linkedin:""})},u=["Logistics","Supply Chain","Procurement","Operations","Sales","Marketing","Finance","Executive","Other"];return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Full Name (Required)"}),e.jsx(z,{value:r.full_name,onChange:t=>i(d=>({...d,full_name:t.target.value})),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Job Title"}),e.jsx(z,{value:r.title,onChange:t=>i(d=>({...d,title:t.target.value})),placeholder:"e.g., Logistics Manager"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Department"}),e.jsxs(W,{value:r.dept,onValueChange:t=>i(d=>({...d,dept:t})),children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select department"})}),e.jsx(Y,{children:u.map(t=>e.jsx(S,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Email Address"}),e.jsx(z,{type:"email",value:r.email,onChange:t=>i(d=>({...d,email:t.target.value})),placeholder:"contact@company.com"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Phone Number"}),e.jsx(z,{value:r.phone,onChange:t=>i(d=>({...d,phone:t.target.value})),placeholder:"+1 (555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx(T,{children:"LinkedIn Profile URL"}),e.jsx(z,{value:r.linkedin,onChange:t=>i(d=>({...d,linkedin:t.target.value})),placeholder:"https://linkedin.com/in/profile"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),e.jsx(N,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"Save Contact"})]})]})}const xs=s=>{switch(s==null?void 0:s.toLowerCase()){case"linkedin":return"bg-blue-100 text-blue-800";case"email":return"bg-yellow-100 text-yellow-800";case"referral":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},hs=s=>{switch(s==null?void 0:s.toLowerCase()){case"responded":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"not_contacted":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ps=({contact:s,onRefresh:c,onEdit:r})=>{var d,m;const[i,l]=p.useState({}),u=async j=>{confirm("Are you sure you want to delete this contact?")&&(await V.delete(j),c())},t=async(j,f)=>{var a,o,g;if(!j.linkedin){alert("No LinkedIn profile available for this contact.");return}const v=`${j.id}_${f}`;l({...i,[v]:!0});try{const n=f==="connect"?`Hi ${((a=j.full_name)==null?void 0:a.split(" ")[0])||""}, I'd like to connect and share some insights about your industry.`:`Hi ${((o=j.full_name)==null?void 0:o.split(" ")[0])||""}, I have some valuable market intelligence that might interest your team. Would you be open to a quick conversation?`,x=await Te({action:f,profile_url:j.linkedin,message:n,contactId:j.id});if(x.status===200)alert(`LinkedIn ${f} initiated for ${j.full_name}.`),await V.update(j.id,{last_contacted:new Date().toISOString()}),c();else throw new Error(((g=x.data)==null?void 0:g.error)||`LinkedIn ${f} failed`)}catch(n){console.error(`LinkedIn ${f} error:`,n),alert(`Failed to ${f} ${j.full_name}. ${n.message}`)}finally{l({...i,[v]:!1})}};return e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-lg",children:((d=s.full_name)==null?void 0:d.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900",children:s.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.title}),s.dept&&e.jsx("p",{className:"text-sm text-gray-500",children:s.dept}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[s.email&&e.jsxs("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4"}),s.email]}),s.phone&&e.jsxs("span",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(rs,{className:"w-4 h-4"}),s.phone]}),s.linkedin&&e.jsxs("a",{href:s.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),"LinkedIn"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.linkedin&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>t(s,"connect"),disabled:i[`${s.id}_connect`],className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:i[`${s.id}_connect`]?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Connect"]})}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>t(s,"message"),disabled:i[`${s.id}_message`],className:"text-green-600 border-green-200 hover:bg-green-50",children:i[`${s.id}_message`]?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-1"}),"Message"]})})]}),e.jsxs(Pe,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",children:e.jsx(Xe,{className:"w-4 h-4"})})}),e.jsxs(Ue,{children:[e.jsxs(ce,{onClick:r,children:[" ",e.jsx(is,{className:"w-4 h-4 mr-2"}),"Edit Contact"]}),e.jsxs(ce,{onClick:()=>u(s.id),className:"text-red-600",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Delete Contact"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[s.verified&&e.jsx(A,{className:"bg-green-100 text-green-800",children:"Verified"}),s.source&&e.jsx(A,{className:`${xs(s.source)}`,children:s.source}),s.response_status&&e.jsx(A,{className:`${hs(s.response_status)}`,children:(m=s.response_status)==null?void 0:m.replace("_"," ")}),s.last_contacted&&e.jsxs(A,{variant:"outline",children:["Contacted ",R(new Date(s.last_contacted),"MMM dd")]})]})]})};function us({company:s,contacts:c,onAddContact:r,onFindContacts:i,isLoadingContacts:l,onRefresh:u,user:t}){const[d,m]=p.useState(!1),[j,f]=p.useState(null),[v,a]=p.useState(!1);p.useEffect(()=>{s&&t?(async()=>{try{const{data:x}=await ie({list:!0}),U=new Set(x.map(H=>H.company_id));a(U.has(s.company_id||s.id))}catch(x){console.error("Error checking save status:",x),a(!1)}})():a(!1)},[s,t]);const o=async()=>{try{await ie({companyId:s.company_id||s.id}),a(!0),f(null),m(!0)}catch(n){console.error("Error saving company:",n),alert("Failed to save company.")}},g=n=>{f(n),m(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Contacts (",(c==null?void 0:c.length)||0,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:i,disabled:l||!v,className:"flex items-center gap-2",children:[l?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"}),"Find Contacts"]}),v?e.jsxs(N,{onClick:()=>{f(null),m(!0)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(xe,{className:"w-4 h-4"}),"Add Contact"]}):e.jsxs(N,{onClick:o,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Save Company to Add Contacts"]})]})]}),!v&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-800",children:"Save Company Required"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"You need to save this company to your CRM before adding or managing contacts. This helps organize your prospects and enables campaign features."})]})]}),e.jsx(N,{onClick:o,className:"mt-3 bg-amber-600 hover:bg-amber-700 text-white",children:"Save Company & Add Contacts"})]}),d&&e.jsx(ms,{company:s,contact:j,onSave:n=>{r(n),m(!1),f(null)},onCancel:()=>{m(!1),f(null)}}),c&&c.length>0?e.jsx("div",{className:"grid gap-4",children:c.map(n=>e.jsx(ps,{contact:n,onRefresh:u,onEdit:()=>g(n)},n.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No contacts found"}),e.jsx("p",{className:"text-sm mb-4",children:"Start building your prospect database by finding or adding contacts"}),v&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(N,{variant:"outline",onClick:i,disabled:l,children:"Find Contacts"}),e.jsx(N,{onClick:()=>{f(null),m(!0)},children:"Add Contact Manually"})]})]})]})}function gs({company:s,onCompanyUpdate:c,user:r,isGated:i,onUnlock:l,isLoading:u,onEnrich:t,isEnriching:d}){const[m,j]=p.useState(null),[f,v]=p.useState(null),a=async()=>{var o,g;if(s!=null&&s.id){v(null);try{const n=await oe({company_id:s.id});(o=n.data)!=null&&o.ok?(j({profile:n.data.profile,score:n.data.score}),c&&c({...s,enrichment_status:"enriched",enrichment_data:n.data})):v(((g=n.data)==null?void 0:g.error)||"Enrichment failed")}catch(n){console.error("Enrichment error:",n),v("Enrichment failed: "+n.message)}}};return i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4",children:e.jsx(q,{className:"mx-auto h-12 w-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"AI Insights Available"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6 max-w-sm mx-auto",children:"Save this company to unlock AI-powered insights including trade patterns, commodities analysis, and business intelligence."}),e.jsxs(N,{onClick:l,disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:[u&&e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Company to Unlock"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI-Powered Business Intelligence"}),e.jsxs(N,{onClick:a,disabled:d,className:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800",children:[d&&e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(q,{className:"w-4 h-4 mr-2"}),d?"Enriching...":"Enrich Now"]})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:f})}),m?e.jsxs("div",{className:"space-y-6",children:[m.score&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-green-600"}),"Business Score"]})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:m.score.overall||"N/A"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Overall business activity score based on trade patterns and volume"})})]})})]}),m.profile&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[m.profile.top_lanes&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),"Top Trade Lanes"]})}),e.jsx(M,{className:"space-y-2",children:m.profile.top_lanes.map((o,g)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.route}),e.jsxs(A,{variant:"outline",children:[o.volume," shipments"]})]},g))})]}),m.profile.top_commodities&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-purple-600"}),"Top Commodities"]})}),e.jsx(M,{className:"space-y-2",children:m.profile.top_commodities.map((o,g)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsxs(A,{variant:"outline",children:[o.percentage,"%"]})]},g))})]}),m.profile.top_carriers&&e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600"}),"Preferred Carriers"]})}),e.jsx(M,{className:"space-y-2",children:m.profile.top_carriers.map((o,g)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsxs(A,{variant:"outline",children:[o.share,"%"]})]},g))})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate AI Insights"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6 max-w-sm mx-auto",children:'Click "Enrich Now" to generate comprehensive business intelligence using AI analysis of trade patterns.'})]})]})}function js({notes:s,onAddNote:c,isLoading:r}){const[i,l]=p.useState(""),u=()=>{i.trim()&&(c(i),l(""))};return r?e.jsx("div",{className:"text-center",children:"Loading notes..."}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Notes & Activity Log"}),e.jsxs("div",{className:"mb-4",children:[e.jsx(Ve,{placeholder:"Add a note about this company...",value:i,onChange:t=>l(t.target.value),className:"mb-2"}),e.jsxs(N,{onClick:u,size:"sm",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-4",children:s.length>0?s.map(t=>e.jsx(k,{className:"bg-gray-50",children:e.jsxs(M,{className:"p-4",children:[e.jsx("p",{className:"text-sm",children:t.content}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex justify-between",children:[e.jsxs("span",{children:["by ",t.created_by.split("@")[0]]}),e.jsx("span",{children:R(new Date(t.created_date),"MMM dd, yyyy HH:mm")})]})]})},t.id)):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"No notes yet."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add a note to keep track of your interactions."})]})})]})}const ge="https://lit-caller-gw-2e68g4k3.uc.gateway.dev";async function je(s){if(!s.ok)throw new Error(`${s.status}`);return s.json()}async function Hs(s){const c=await fetch(`${ge}/crm/companies`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(s)});return je(c)}async function fs(){const s=await fetch(`${ge}/crm/feature-flags`,{headers:{accept:"application/json"}});return je(s)}function Ns(){const[s,c]=p.useState({companyDrawerPremium:!0});return p.useEffect(()=>{let r=!1;return fs().then(i=>{if(r)return;const l={};for(const u of i.flags||[])l[u.key]=!!u.enabled;c({companyDrawerPremium:l.companyDrawerPremium??!0})}).catch(()=>{}),()=>{r=!0}},[]),s}function ys({company:s,isOpen:c,onClose:r,onSave:i,user:l}){const{companyDrawerPremium:u}=Ns(),[t,d]=p.useState(null),[m,j]=p.useState([]),[f,v]=p.useState([]),[a,o]=p.useState([]),[g,n]=p.useState(!0),[x,U]=p.useState(!1),[H,ee]=p.useState(!1),b=s==null?void 0:s.id,$=p.useCallback(async()=>{var h,_;if(b){n(!0);try{const y=$e({company_id:b}),w=Fe({company_id:b,limit:50}),E=V.filter({company_id:b},"-created_date",50),we=le.filter({company_id:b},"-created_date",50),[re,ne,ke,Ce]=await Promise.all([y,w,E,we]);(h=re.data)!=null&&h.ok&&d(re.data.result),(_=ne.data)!=null&&_.ok&&j(ne.data.results),v(ke),o(Ce)}catch(y){console.error("Error loading related company data:",y)}finally{n(!1)}}},[b]);p.useEffect(()=>{c&&b?$():(d(null),j([]),o([]),v([]))},[c,b,$]);const fe=async h=>{await V.create({...h,company_id:b}),$()},Ne=async h=>{await le.create({content:h,company_id:b}),$()},G=async()=>{U(!0);try{await i(s)}catch(h){console.error("Error saving company:",h)}finally{U(!1)}},ye=async()=>{var h,_;ee(!0);try{const y=await oe({company_id:b});(h=y.data)!=null&&h.ok?$():alert("Enrichment failed: "+(((_=y.data)==null?void 0:_.error)||"Unknown error"))}catch(y){console.error("Error enriching company:",y),alert("Enrichment failed: "+y.message)}finally{ee(!1)}},ve=()=>{const h=Ee("EmailCenter")+`?company_id=${b}`;window.location.href=h,r()},be=h=>{if(!h||h.length===0)return[];const _=h.reduce((y,w)=>y+w.cnt,0);return h.map(y=>{let w,E;switch(y.mode.toLowerCase()){case"ocean":w=L,E="text-blue-500";break;case"air":w=Z,E="text-purple-500";break;case"truck":w=B,E="text-green-500";break;case"rail":w=K,E="text-purple-600";break;default:w=L,E="text-gray-500"}return{type:y.mode,percentage:_>0?Math.round(y.cnt/_*100):0,icon:w,color:E}}).sort((y,w)=>w.percentage-y.percentage)};if(!c||!s)return null;const se=!1,ae=be(t==null?void 0:t.mode_breakdown),te=t||s;return e.jsx(e.Fragment,{children:e.jsx(_e,{open:c,onOpenChange:r,children:e.jsxs(Se,{className:"max-w-4xl h-[90vh] flex flex-col p-0",children:[e.jsx(Me,{className:"p-6 border-b",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx(Ae,{className:"text-2xl font-bold text-gray-900",children:te.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsxs("span",{children:["ID: ",b]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{children:"Trade Data Available"})]})]}),ae.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-3",children:ae.map(h=>{const _=h.icon;return e.jsxs(A,{variant:"outline",className:"flex items-center gap-1.5 pl-2 pr-2.5 py-1",children:[e.jsx(_,{className:`w-4 h-4 ${h.color}`}),e.jsx("span",{className:"font-medium text-gray-700",children:h.type.charAt(0).toUpperCase()+h.type.slice(1)}),e.jsxs("span",{className:"text-gray-500",children:[h.percentage,"%"]})]},h.type)})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(N,{size:"sm",onClick:G,variant:"outline",className:"flex items-center gap-2",disabled:x||se,children:[x&&e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(ue,{className:"w-4 h-4"}),"Save"]}),e.jsxs(N,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:ve,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Start Outreach"]})]})]})}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsxs(De,{defaultValue:"overview",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 border-b",children:e.jsxs(Le,{children:[e.jsx(F,{value:"overview",children:"Overview"}),e.jsxs(F,{value:"shipments",children:["Shipments (",m.length,")"]}),u?e.jsxs(F,{value:"contacts",children:[e.jsx(he,{className:"w-3 h-3 mr-1.5"}),"Contacts"]}):null,e.jsxs(F,{value:"ai_insights",children:[e.jsx(q,{className:"w-3 h-3 mr-1.5"}),"AI Insights"]}),e.jsxs(F,{value:"notes",children:["Notes (",a.length,")"]})]})}),e.jsxs("div",{className:"flex-grow overflow-auto",children:[e.jsx(P,{value:"overview",className:"p-6",children:e.jsx(ds,{company:t,shipments:m,isLoading:g})}),e.jsx(P,{value:"shipments",className:"p-6",children:e.jsx(os,{shipments:m,isLoading:g})}),e.jsx(P,{value:"contacts",className:"p-6",children:e.jsx(us,{contacts:f,companyId:b,company:te,onAddContact:fe,isGated:!se,onUnlock:G,isLoading:x})}),e.jsx(P,{value:"ai_insights",className:"p-6",children:e.jsx(gs,{company:t||s,onCompanyUpdate:d,user:l,isGated:!1,onUnlock:G,isLoading:x,onEnrich:ye,isEnriching:H})}),e.jsx(P,{value:"notes",className:"p-6",children:e.jsx(js,{notes:a,onAddNote:Ne,isLoading:g})})]})]})}),e.jsx(N,{variant:"ghost",size:"icon",onClick:r,className:"absolute top-4 right-4 rounded-full",children:e.jsx(Ie,{className:"w-5 h-5"})})]})})})}const Gs=Object.freeze(Object.defineProperty({__proto__:null,default:ys},Symbol.toStringTag,{value:"Module"}));export{ue as B,ys as C,Xe as E,K as T,Gs as a,Hs as c};
