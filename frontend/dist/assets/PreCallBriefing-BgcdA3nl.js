const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/functions-BiBq-vTN.js","assets/main-CSxjyf2y.js","assets/main-DkWHp9qK.css"])))=>i.map(i=>d[i]);
import{u as D,r as l,j as s,B as c,C as x,d as h,e as p,b as u,_ as H,$ as M}from"./main-CSxjyf2y.js";import{I as v}from"./input-BsbiDyYk.js";import{getCompanyOverview as F,getCompanyShipments as q}from"./functions-BiBq-vTN.js";function G(){const{search:d}=M();return l.useMemo(()=>new URLSearchParams(d),[d])}function K(){var S,$,L,k,A,B;const d=G(),R=D(),g=d.get("company_id")||"",[i,I]=l.useState(g),[y,j]=l.useState(!1),[f,o]=l.useState(""),[e,b]=l.useState(null),[m,N]=l.useState([]),[P,Q]=l.useState(!1),[O,_]=l.useState(!1);async function C(){var t,n;if(!i){o("Enter a company ID");return}o(""),j(!0);try{const[a,r]=await Promise.all([F({company_id:i}),q({company_id:i,limit:50})]);b(((t=a==null?void 0:a.data)==null?void 0:t.result)||null),N(Array.isArray((n=r==null?void 0:r.data)==null?void 0:n.results)?r.data.results:[])}catch(a){console.error(a),o("Failed to load briefing."),b(null),N([])}finally{j(!1)}}function E(){const t=`Pre-Call Briefing — ${(e==null?void 0:e.name)||i}`,n=m.slice(0,6).map(a=>`${a.origin||a.origin_country||"—"} → ${a.destination||a.dest_country||"—"} (${a.mode||a.transport_mode||"—"})`).join("<br/>");return`<!doctype html><meta charset="utf-8"><title>${t}</title><style>body{font-family:Inter,system-ui,-apple-system,sans-serif;padding:24px;color:#111}h1{margin:0 0 8px}h2{margin:20px 0 8px}</style><h1>${t}</h1><h2>Overview</h2><div>Name: <b>${(e==null?void 0:e.name)||(e==null?void 0:e.company_name)||i}</b></div><div>Recent Activity: ${(e==null?void 0:e.last_seen)??"N/A"}</div><div>Modes: ${((e==null?void 0:e.mode_breakdown)||[]).map(a=>a.mode).join(", ")}</div><div>Top Lanes: ${((e==null?void 0:e.top_lanes)||[]).slice(0,3).map(a=>a.route).join(" · ")}</div><h2>Recent Shipments</h2><div>${n||"No recent shipments"}</div>`}async function T(){const t=E(),n=new Blob([t],{type:"text/html"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`briefing-${i}.html`,r.click(),URL.revokeObjectURL(a)}async function U(){try{_(!0);const t=E(),{sendEmail:n}=await H(async()=>{const{sendEmail:a}=await import("./functions-BiBq-vTN.js");return{sendEmail:a}},__vite__mapDeps([0,1,2]));await n({subject:`Pre-Call Briefing: ${(e==null?void 0:e.name)||i}`,html:t,to:[]}),alert("Email sent (if email service configured).")}catch(t){console.error(t),alert("Failed to send email.")}finally{_(!1)}}return l.useEffect(()=>{g&&C()},[]),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pre-Call Briefing"}),s.jsx("p",{className:"text-sm text-gray-600",children:"AI-aided context before you talk to a prospect"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(c,{variant:"outline",onClick:()=>R(-1),children:"Back"}),s.jsx(c,{onClick:T,disabled:!e||P,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Download HTML"}),s.jsx(c,{onClick:U,disabled:!e||O,className:"bg-purple-600 text-white hover:bg-purple-700",children:"Email Briefing"})]})]}),s.jsxs(x,{children:[s.jsx(h,{children:s.jsx(p,{children:"Load Company"})}),s.jsxs(u,{className:"flex flex-col sm:flex-row gap-3",children:[s.jsx(v,{value:i,onChange:t=>I(t.target.value),placeholder:"Company ID"}),s.jsx(c,{onClick:C,disabled:y,children:y?"Loading…":"Generate Briefing"})]})]}),f&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-3 text-sm",children:f}),e&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs(x,{className:"lg:col-span-2",children:[s.jsx(h,{children:s.jsx(p,{children:"Company Overview"})}),s.jsxs(u,{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500",children:"Name"}),s.jsx("div",{className:"font-medium",children:(e==null?void 0:e.name)||(e==null?void 0:e.company_name)||i})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500",children:"Recent Activity"}),s.jsx("div",{className:"font-medium",children:(e==null?void 0:e.last_seen)??"N/A"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500",children:"Modes"}),s.jsx("div",{className:"font-medium",children:Array.isArray(e==null?void 0:e.mode_breakdown)?e.mode_breakdown.map(t=>t.mode).join(", "):"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500",children:"Top Lanes"}),s.jsx("div",{className:"font-medium",children:Array.isArray(e==null?void 0:e.top_lanes)?e.top_lanes.slice(0,3).map(t=>t.route).join(" · "):"—"})]})]}),s.jsxs("div",{className:"text-gray-600",children:["Suggested opener: Based on your recent ",(($=(S=e==null?void 0:e.mode_breakdown)==null?void 0:S[0])==null?void 0:$.mode)||"trade"," activity to ",((B=(A=(k=(L=e==null?void 0:e.top_lanes)==null?void 0:L[0])==null?void 0:k.route)==null?void 0:A.split("→"))==null?void 0:B[1])||"target region",", we can reduce transit variability and improve landed cost by 3–7%."]})]})]}),s.jsxs(x,{children:[s.jsx(h,{children:s.jsx(p,{children:"Recent Shipments"})}),s.jsxs(u,{className:"space-y-2 text-sm",children:[m.slice(0,6).map((t,n)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"truncate",children:[t.origin||t.origin_country||"—"," → ",t.destination||t.dest_country||"—"]}),s.jsx("div",{className:"text-gray-500",children:t.mode||t.transport_mode||"—"})]},n)),m.length===0&&s.jsx("div",{className:"text-gray-500",children:"No recent shipments"})]})]})]})]})}export{K as default};
