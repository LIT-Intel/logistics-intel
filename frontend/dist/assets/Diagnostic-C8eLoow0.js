import{c as w,r as s,j as e,B as S}from"./main-ygLT4geW.js";import{User as v}from"./entities-CpFcElq0.js";import{A as u,a as m,b as h}from"./alert-1DCJ8E0j.js";import{litPing as C}from"./functions-CMf3EkrY.js";import{C as k}from"./clock-BNAn6qfO.js";import{C as b}from"./circle-check-big-gPEUZKHH.js";import"./base44Client-C-YMJfZQ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],p=w("ServerCrash",D);function V(){const[x,y]=s.useState(null),[i,g]=s.useState("loading"),[R,j]=s.useState("idle"),[L,G]=s.useState(null),[I,E]=s.useState(null),[P,f]=s.useState("idle"),[U,B]=s.useState(null),[M,A]=s.useState(null),[r,l]=s.useState("idle"),[o,c]=s.useState(null);s.useEffect(()=>{(async()=>{try{const a=await v.me();y(a),g("success")}catch(a){console.error("Diagnostic: Failed to load user",a),g("error")}})()},[]);const N=s.useCallback(async()=>{var t;l("loading"),c(null);try{const a=await C();console.log("LIT Ping Response:",a),c(a.data||a),l("success")}catch(a){console.error("LIT Ping Test failed:",a);const n=((t=a.response)==null?void 0:t.data)||{error:a.message};c(n),l("error")}},[]);s.useCallback(async()=>{j("loading")},[]),s.useCallback(async()=>{f("loading")},[]);const d=t=>e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto whitespace-pre-wrap",children:JSON.stringify(t,null,2)}),T=t=>{var n;return((t==null?void 0:t.error)||"").includes("bigquery.jobs.create permission")?e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:"Root Cause Identified: Cloud IAM Permissions"}),e.jsx("p",{className:"mt-2",children:"The LIT Gateway is responding, but it's being denied permission by Google Cloud. This is not an application code issue."}),e.jsxs("div",{className:"mt-3 bg-red-50 p-3 rounded-md border border-red-200",children:[e.jsx("p",{className:"font-bold text-sm",children:"Action Required:"}),e.jsxs("p",{className:"text-sm",children:["The service account for the Cloud Run service at ",e.jsx("code",{className:"text-xs bg-red-100 p-1 rounded",children:(n=t.env_check)==null?void 0:n.gateway_url})," needs the ",e.jsx("code",{className:"text-xs bg-red-100 p-1 rounded",children:"BigQuery Job User"})," role in the ",e.jsx("code",{className:"text-xs bg-red-100 p-1 rounded",children:"logistics-intel"})," Google Cloud project."]})]}),e.jsx("p",{className:"mt-3 font-semibold",children:"Raw Error:"}),d(t)]}):e.jsxs("div",{children:["The gateway returned an error. This is the most likely cause of the issues.",d(t)]})};return e.jsx("div",{className:"p-4 md:p-6 lg:p-8 bg-gradient-to-br from-gray-50 to-blue-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"System Diagnostic"}),e.jsx("p",{className:"text-gray-600",children:"Run tests to identify database and gateway connectivity issues."})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/60 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"LIT Gateway Connection Test"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Tests the connection to the LIT Gateway to see if it can perform a basic query."}),e.jsx(S,{onClick:N,disabled:r==="loading",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors mb-4",children:r==="loading"?"Pinging Gateway...":"Run LIT Gateway Test"}),r==="loading"&&e.jsxs(u,{className:"bg-blue-50 border-blue-200",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(m,{children:"Test in Progress..."}),e.jsx(h,{children:"Pinging the LIT Gateway..."})]}),r==="success"&&o&&e.jsxs(u,{className:"bg-green-50 border-green-200",children:[e.jsx(b,{className:"h-4 w-4 text-green-700"}),e.jsx(m,{className:"text-green-800",children:"Gateway Connection Successful"}),e.jsxs(h,{children:["The gateway responded. Here is the output:",d(o)]})]}),r==="error"&&o&&e.jsxs(u,{variant:"destructive",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(m,{children:"Gateway Test Failed"}),e.jsx(h,{children:T(o)})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/60 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Initial Check: User Status"}),i==="loading"&&e.jsx("p",{children:"Loading user..."}),i==="error"&&e.jsxs("p",{className:"text-red-600 font-semibold flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),"Failed to load user!"]}),i==="success"&&x&&e.jsxs("div",{className:"text-green-700 font-semibold flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("p",{children:["User loaded successfully: ",x.email]})]})]})]})})}export{V as default};
