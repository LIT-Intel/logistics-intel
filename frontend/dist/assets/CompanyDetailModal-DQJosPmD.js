import{c as $,r as c,j as e,a as ae,B as y,M as se}from"./main-BwGWMDCi.js";import{D as te,a as ne,b as re,c as ce,X as oe}from"./dialog-C_kz_kbv.js";import{B as le}from"./badge-u5ZeETXz.js";import{T as ie,a as de,b as j,c as v}from"./tabs-CUfPoQKT.js";import{Contact as O,Note as U}from"./entities-CnsKiLH-.js";import{c as me}from"./index-DR9D_4bA.js";import{getCompanyOverview as he,getCompanyShipments as pe,enrichCompany as ue}from"./functions-DLmuSLgl.js";import{B as xe,S as fe,O as ge,e as ye,f as je,g as ve,N as Ne,T as be}from"./NotesTab-B_nF1Pwf.js";import{L as we}from"./loader-circle-C-mQTauK.js";import{L as Se}from"./textarea-BtZvDFSN.js";import{S as F}from"./ship-CzOlKfq2.js";import{T as Ce,P as ke}from"./truck-BzQ1-Eds.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Te=$("BookmarkCheck",_e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],De=$("Globe",Ee),G="https://lit-caller-gw-2e68g4k3.uc.gateway.dev";async function V(s){if(!s.ok)throw new Error(`${s.status}`);return s.json()}async function Je(s){const d=await fetch(`${G}/crm/companies`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(s)});return V(d)}async function Pe(){const s=await fetch(`${G}/crm/feature-flags`,{headers:{accept:"application/json"}});return V(s)}function Ie(){const[s,d]=c.useState({companyDrawerPremium:!0});return c.useEffect(()=>{let u=!1;return Pe().then(w=>{if(u)return;const N={};for(const b of w.flags||[])N[b.key]=!!b.enabled;d({companyDrawerPremium:N.companyDrawerPremium??!0})}).catch(()=>{}),()=>{u=!0}},[]),s}function Ae({company:s,isOpen:d,onClose:u,onSave:w,user:N,isSaved:b=!1}){const{companyDrawerPremium:q}=Ie(),[x,S]=c.useState(null),[C,_]=c.useState([]),[H,T]=c.useState([]),[E,D]=c.useState([]),[k,P]=c.useState(!0),[m,I]=c.useState(!1),[J,A]=c.useState(!1),n=s==null?void 0:s.id,f=c.useCallback(async()=>{var a,o;if(n){P(!0);try{const t=he({company_id:n}),r=pe({company_id:n,limit:50}),p=O.filter({company_id:n},"-created_date",50),Y=U.filter({company_id:n},"-created_date",50),[l,i,R,ee]=await Promise.all([t,r,p,Y]),M=((a=l==null?void 0:l.data)==null?void 0:a.result)??(l==null?void 0:l.result)??(l==null?void 0:l.data)??l??null;M&&S(M);const z=((o=i==null?void 0:i.data)==null?void 0:o.results)??(i==null?void 0:i.results)??(i==null?void 0:i.rows)??[];_(Array.isArray(z)?z:[]),T(R),D(ee)}catch(t){console.error("Error loading related company data:",t)}finally{P(!1)}}},[n]);c.useEffect(()=>{d&&n?f():(S(null),_([]),D([]),T([]))},[d,n,f]);const X=async a=>{await O.create({...a,company_id:n}),f()},Z=async a=>{await U.create({content:a,company_id:n}),f()},g=async()=>{I(!0);try{await w(s)}catch(a){console.error("Error saving company:",a)}finally{I(!1)}},K=async()=>{var a,o;A(!0);try{const t=await ue({company_id:n});(a=t.data)!=null&&a.ok?f():alert("Enrichment failed: "+(((o=t.data)==null?void 0:o.error)||"Unknown error"))}catch(t){console.error("Error enriching company:",t),alert("Enrichment failed: "+t.message)}finally{A(!1)}},Q=()=>{const a=me("EmailCenter")+`?company_id=${n}`;window.location.href=a,u()},W=a=>{if(!a||a.length===0)return[];const o=a.reduce((t,r)=>t+r.cnt,0);return a.map(t=>{let r,p;switch(t.mode.toLowerCase()){case"ocean":r=F,p="text-blue-500";break;case"air":r=ke,p="text-purple-500";break;case"truck":r=Ce,p="text-green-500";break;case"rail":r=be,p="text-purple-600";break;default:r=F,p="text-gray-500"}return{type:t.mode,percentage:o>0?Math.round(t.cnt/o*100):0,icon:r,color:p}}).sort((t,r)=>r.percentage-t.percentage)};if(!d||!s)return null;const h=!!b,L=W(x==null?void 0:x.mode_breakdown),B=x||s;return e.jsx(e.Fragment,{children:e.jsx(te,{open:d,onOpenChange:u,children:e.jsxs(ne,{className:"max-w-4xl h-[90vh] flex flex-col p-0",children:[e.jsx(re,{className:"p-6 border-b",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx(ce,{className:"text-2xl font-bold text-gray-900",children:B.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["ID: ",n]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Trade Data Available"})]})]}),L.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-3",children:L.map(a=>{const o=a.icon;return e.jsxs(le,{variant:"outline",className:"flex items-center gap-1.5 pl-2 pr-2.5 py-1",children:[e.jsx(o,{className:`w-4 h-4 ${a.color}`}),e.jsx("span",{className:"font-medium text-gray-700",children:a.type.charAt(0).toUpperCase()+a.type.slice(1)}),e.jsxs("span",{className:"text-gray-500",children:[a.percentage,"%"]})]},a.type)})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(y,{size:"sm",onClick:g,variant:"outline",className:"flex items-center gap-2",disabled:m||h,children:[m&&e.jsx(we,{className:"mr-2 h-4 w-4 animate-spin"}),h?e.jsx(Te,{className:"w-4 h-4 text-blue-600"}):e.jsx(xe,{className:"w-4 h-4"}),h?"Saved":"Save"]}),e.jsxs(y,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:Q,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Start Outreach"]})]})]})}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsxs(ie,{defaultValue:"overview",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 border-b",children:e.jsxs(de,{children:[e.jsx(j,{value:"overview",children:"Overview"}),e.jsxs(j,{value:"shipments",children:["Shipments (",C.length,")"]}),q?e.jsxs(j,{value:"contacts",disabled:!h,children:[!h&&e.jsx(Se,{className:"w-3 h-3 mr-1.5"}),"Contacts"]}):null,e.jsxs(j,{value:"ai_insights",children:[e.jsx(fe,{className:"w-3 h-3 mr-1.5"}),"AI Insights"]}),e.jsxs(j,{value:"notes",disabled:!h,children:["Notes (",E.length,")"]})]})}),e.jsxs("div",{className:"flex-grow overflow-auto",children:[e.jsx(v,{value:"overview",className:"p-6",children:e.jsx(ge,{company:x,shipments:C,isLoading:k})}),e.jsx(v,{value:"shipments",className:"p-6",children:e.jsx(ye,{shipments:C,isLoading:k})}),e.jsx(v,{value:"contacts",className:"p-6",children:h?e.jsx(je,{contacts:H,companyId:n,company:B,onAddContact:X,isGated:!1,onUnlock:g,isLoading:m}):e.jsxs("div",{className:"text-sm text-gray-600",children:["Save this company to manage contacts.",e.jsx("div",{className:"mt-3",children:e.jsx(y,{size:"sm",variant:"outline",onClick:g,disabled:m,children:m?"Saving…":"Save Company"})})]})}),e.jsx(v,{value:"ai_insights",className:"p-6",children:e.jsx(ve,{company:x||s,onCompanyUpdate:S,user:N,isGated:!1,onUnlock:g,isLoading:m,onEnrich:K,isEnriching:J})}),e.jsx(v,{value:"notes",className:"p-6",children:h?e.jsx(Ne,{notes:E,onAddNote:Z,isLoading:k}):e.jsxs("div",{className:"text-sm text-gray-600",children:["Save this company to add and view notes.",e.jsx("div",{className:"mt-3",children:e.jsx(y,{size:"sm",variant:"outline",onClick:g,disabled:m,children:m?"Saving…":"Save Company"})})]})})]})]})}),e.jsx(y,{variant:"ghost",size:"icon",onClick:u,className:"absolute top-4 right-4 rounded-full",children:e.jsx(oe,{className:"w-5 h-5"})})]})})})}const Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));export{Te as B,Ae as C,Xe as a,Je as c};
