import{c as R,r as c,j as e,a as ee,B as S,M as ae}from"./main-CSxjyf2y.js";import{D as se,a as te,b as ne,c as re,X as ce}from"./dialog-Cdy6sIX4.js";import{B as oe}from"./badge-vZXRrHht.js";import{T as le,a as ie,b as x,c as f}from"./tabs-DN0jao0y.js";import{Contact as F,Note as B}from"./entities-CnsKiLH-.js";import{c as me}from"./index-DR9D_4bA.js";import{getCompanyOverview as de,getCompanyShipments as pe,enrichCompany as he}from"./functions-BiBq-vTN.js";import{B as ue,S as xe,O as fe,e as ge,f as ye,g as je,N as Ne,T as ve}from"./NotesTab-BVtcbGFY.js";import{L as be}from"./loader-circle-DZNa8K6w.js";import{L as we}from"./textarea-BPbnhhV7.js";import{S as $}from"./ship-lQw5zPSB.js";import{T as Ce,P as Se}from"./truck-BfuYRewr.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],_e=R("Globe",ke),z="https://lit-caller-gw-2e68g4k3.uc.gateway.dev";async function G(s){if(!s.ok)throw new Error(`${s.status}`);return s.json()}async function He(s){const m=await fetch(`${z}/crm/companies`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(s)});return G(m)}async function Te(){const s=await fetch(`${z}/crm/feature-flags`,{headers:{accept:"application/json"}});return G(s)}function Ee(){const[s,m]=c.useState({companyDrawerPremium:!0});return c.useEffect(()=>{let p=!1;return Te().then(N=>{if(p)return;const g={};for(const y of N.flags||[])g[y.key]=!!y.enabled;m({companyDrawerPremium:g.companyDrawerPremium??!0})}).catch(()=>{}),()=>{p=!0}},[]),s}function De({company:s,isOpen:m,onClose:p,onSave:N,user:g}){const{companyDrawerPremium:y}=Ee(),[h,v]=c.useState(null),[b,k]=c.useState([]),[H,_]=c.useState([]),[T,E]=c.useState([]),[w,D]=c.useState(!0),[j,P]=c.useState(!1),[J,I]=c.useState(!1),n=s==null?void 0:s.id,u=c.useCallback(async()=>{var a,o;if(n){D(!0);try{const t=de({company_id:n}),r=pe({company_id:n,limit:50}),d=F.filter({company_id:n},"-created_date",50),W=B.filter({company_id:n},"-created_date",50),[l,i,Y,Z]=await Promise.all([t,r,d,W]),O=((a=l==null?void 0:l.data)==null?void 0:a.result)??(l==null?void 0:l.result)??(l==null?void 0:l.data)??l??null;O&&v(O);const U=((o=i==null?void 0:i.data)==null?void 0:o.results)??(i==null?void 0:i.results)??(i==null?void 0:i.rows)??[];k(Array.isArray(U)?U:[]),_(Y),E(Z)}catch(t){console.error("Error loading related company data:",t)}finally{D(!1)}}},[n]);c.useEffect(()=>{m&&n?u():(v(null),k([]),E([]),_([]))},[m,n,u]);const V=async a=>{await F.create({...a,company_id:n}),u()},X=async a=>{await B.create({content:a,company_id:n}),u()},C=async()=>{P(!0);try{await N(s)}catch(a){console.error("Error saving company:",a)}finally{P(!1)}},q=async()=>{var a,o;I(!0);try{const t=await he({company_id:n});(a=t.data)!=null&&a.ok?u():alert("Enrichment failed: "+(((o=t.data)==null?void 0:o.error)||"Unknown error"))}catch(t){console.error("Error enriching company:",t),alert("Enrichment failed: "+t.message)}finally{I(!1)}},K=()=>{const a=me("EmailCenter")+`?company_id=${n}`;window.location.href=a,p()},Q=a=>{if(!a||a.length===0)return[];const o=a.reduce((t,r)=>t+r.cnt,0);return a.map(t=>{let r,d;switch(t.mode.toLowerCase()){case"ocean":r=$,d="text-blue-500";break;case"air":r=Se,d="text-purple-500";break;case"truck":r=Ce,d="text-green-500";break;case"rail":r=ve,d="text-purple-600";break;default:r=$,d="text-gray-500"}return{type:t.mode,percentage:o>0?Math.round(t.cnt/o*100):0,icon:r,color:d}}).sort((t,r)=>r.percentage-t.percentage)};if(!m||!s)return null;const A=!1,L=Q(h==null?void 0:h.mode_breakdown),M=h||s;return e.jsx(e.Fragment,{children:e.jsx(se,{open:m,onOpenChange:p,children:e.jsxs(te,{className:"max-w-4xl h-[90vh] flex flex-col p-0",children:[e.jsx(ne,{className:"p-6 border-b",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-2xl font-bold text-gray-900",children:M.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsxs("span",{children:["ID: ",n]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"Trade Data Available"})]})]}),L.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-3",children:L.map(a=>{const o=a.icon;return e.jsxs(oe,{variant:"outline",className:"flex items-center gap-1.5 pl-2 pr-2.5 py-1",children:[e.jsx(o,{className:`w-4 h-4 ${a.color}`}),e.jsx("span",{className:"font-medium text-gray-700",children:a.type.charAt(0).toUpperCase()+a.type.slice(1)}),e.jsxs("span",{className:"text-gray-500",children:[a.percentage,"%"]})]},a.type)})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(S,{size:"sm",onClick:C,variant:"outline",className:"flex items-center gap-2",disabled:j||A,children:[j&&e.jsx(be,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(ue,{className:"w-4 h-4"}),"Save"]}),e.jsxs(S,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:K,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Start Outreach"]})]})]})}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsxs(le,{defaultValue:"overview",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 border-b",children:e.jsxs(ie,{children:[e.jsx(x,{value:"overview",children:"Overview"}),e.jsxs(x,{value:"shipments",children:["Shipments (",b.length,")"]}),y?e.jsxs(x,{value:"contacts",children:[e.jsx(we,{className:"w-3 h-3 mr-1.5"}),"Contacts"]}):null,e.jsxs(x,{value:"ai_insights",children:[e.jsx(xe,{className:"w-3 h-3 mr-1.5"}),"AI Insights"]}),e.jsxs(x,{value:"notes",children:["Notes (",T.length,")"]})]})}),e.jsxs("div",{className:"flex-grow overflow-auto",children:[e.jsx(f,{value:"overview",className:"p-6",children:e.jsx(fe,{company:h,shipments:b,isLoading:w})}),e.jsx(f,{value:"shipments",className:"p-6",children:e.jsx(ge,{shipments:b,isLoading:w})}),e.jsx(f,{value:"contacts",className:"p-6",children:e.jsx(ye,{contacts:H,companyId:n,company:M,onAddContact:V,isGated:!A,onUnlock:C,isLoading:j})}),e.jsx(f,{value:"ai_insights",className:"p-6",children:e.jsx(je,{company:h||s,onCompanyUpdate:v,user:g,isGated:!1,onUnlock:C,isLoading:j,onEnrich:q,isEnriching:J})}),e.jsx(f,{value:"notes",className:"p-6",children:e.jsx(Ne,{notes:T,onAddNote:X,isLoading:w})})]})]})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:p,className:"absolute top-4 right-4 rounded-full",children:e.jsx(ce,{className:"w-5 h-5"})})]})})})}const Je=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{De as C,Je as a,He as c};
