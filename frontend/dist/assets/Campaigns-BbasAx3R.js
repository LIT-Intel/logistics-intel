import{c as re,j as e,C as O,d as M,e as I,R as k,b as L,B as C,M as ee,r as v,S as Me,F as Ie,D as fe,E as Re,A as Fe,G as qe}from"./main-DiC1IAlF.js";import{B as te}from"./badge-DNjX02d3.js";import{P as V,i as Be,D as $e,f as ze,E as We,L as ie,a as X,C as Ue,A as Ke,b as K,c as Ve,d as he,h as Ge,e as He,g as we,u as Qe,G as Xe,j as ye,k as Ye,X as _e,Y as Ce,l as Je,s as Ze,R as et,m as tt,T as st}from"./generateCategoricalChart-DX1E5OQK.js";import{P as le}from"./pen-line-BqJDERYy.js";import{T as Se}from"./trash-2-Cip2sZ3t.js";import{U as ke}from"./users-zaJWI-mS.js";import{C as at}from"./calendar-DJftmBni.js";import{T as Ae}from"./target-bO5JrSeo.js";import{f as J}from"./format-DIePDvv_.js";import{I as Z}from"./input-D3qoHKP4.js";import{T as ce}from"./textarea-CXGBSKST.js";import{S as oe,b as de,d as me,e as ue,f as E}from"./select-BgKO13yw.js";import{CampaignTemplate as rt,User as nt,EmailInteraction as it}from"./entities-CpFcElq0.js";import{A as lt}from"./arrow-right-DS0b72WP.js";import{a as G}from"./api-4HC720_u.js";import{P as se}from"./plus-Dh5jiV-J.js";import{M as Pe}from"./message-square-Dd9EZFiL.js";import{D as ct,a as ot,b as dt,c as mt}from"./dialog-CW8lXrNm.js";import{A as ut,a as ht,b as xt}from"./alert-CdY0v8hf.js";import{T as pt}from"./triangle-alert-8avUk6_2.js";import"./index-Drb4M11N.js";import"./isEqual-D6WY1jOw.js";import"./base44Client-C-YMJfZQ.js";import"./index-Cio_o5ec.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],yt=re("MousePointer",ft);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],ge=re("Pause",gt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],je=re("Play",jt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],bt=re("UserPlus",vt);function Nt({campaign:t,onToggle:n,onEdit:s,onDelete:a,onClick:c}){var m;const i=u=>{const x={active:"bg-green-100 text-green-800",paused:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800"};return x[u]||x.draft},l=u=>{const f={active:je,paused:ge,completed:Ae,draft:le}[u]||le;return e.jsx(f,{className:"w-4 h-4"})},d=t.sent_count>0?Math.round((t.open_rate||0)*100):0;return t.sent_count>0&&Math.round((t.reply_count||0)/t.sent_count*100),e.jsxs(O,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none hover:shadow-xl transition-all duration-300 cursor-pointer",children:[e.jsxs(M,{className:"pb-3",onClick:()=>c&&c(t),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{className:"text-lg line-clamp-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(te,{className:i(t.status),children:[k.createElement(l(t.status),{className:"w-3 h-3 mr-1"}),t.status]}),e.jsx(te,{variant:"outline",className:"text-xs",children:(m=t.campaign_type)==null?void 0:m.replace("_"," ")})]})]})}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:(()=>{const u=t.created_at||t.created_date||t.createdOn||Date.now();try{return`Created ${J(new Date(u),"MMM dd, yyyy")}`}catch{return""}})()})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:t.sent_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:[d,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Open Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:t.reply_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Replies"})]})]}),t.status==="active"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[t.sent_count||0," / ",(t.target_contacts||[]).length]})]}),e.jsx(V,{value:(t.target_contacts||[]).length>0?(t.sent_count||0)/(t.target_contacts||[]).length*100:0,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{size:"sm",variant:"outline",onClick:u=>{u.stopPropagation(),n(t.id,t.status)},disabled:t.status==="completed",className:"h-8",children:[t.status==="active"?e.jsx(ge,{className:"w-3 h-3 mr-1"}):e.jsx(je,{className:"w-3 h-3 mr-1"}),t.status==="active"?"Pause":"Start"]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:u=>{u.stopPropagation(),s(t)},className:"h-8",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Edit"]})]}),e.jsx(C,{size:"sm",variant:"outline",onClick:u=>{u.stopPropagation(),a(t.id)},className:"h-8 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Se,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),(t.target_contacts||[]).length," contacts"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),(t.sequence_steps||[]).length," steps"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(at,{className:"w-3 h-3"}),t.status==="active"?"Running":"Paused"]})]})]})]})}function wt({onSelectTemplate:t,onClose:n}){const[s,a]=v.useState([]),[c,i]=v.useState([]),[l,d]=v.useState(""),[m,u]=v.useState("all"),[x,f]=v.useState(!0),p=[{value:"all",label:"All Templates"},{value:"prospecting",label:"Prospecting"},{value:"nurturing",label:"Nurturing"},{value:"demo",label:"Demo & Discovery"},{value:"closing",label:"Closing"},{value:"followup",label:"Follow-up"}],N=async()=>{try{const r=await rt.filter({is_active:!0},"name"),o=Array.isArray(r)?r:r!=null&&r.data&&Array.isArray(r.data)?r.data:[];a(o)}catch(r){console.error("Error loading templates:",r),a([])}f(!1)},h=v.useCallback(()=>{let r=s;l&&(r=r.filter(o=>o.name.toLowerCase().includes(l.toLowerCase())||o.objective.toLowerCase().includes(l.toLowerCase())||o.audience.toLowerCase().includes(l.toLowerCase()))),m!=="all"&&(r=r.filter(o=>o.category===m)),i(r)},[s,l,m]);v.useEffect(()=>{N()},[]),v.useEffect(()=>{h()},[h]);const w=r=>({prospecting:"bg-blue-100 text-blue-800",nurturing:"bg-green-100 text-green-800",demo:"bg-purple-100 text-purple-800",closing:"bg-orange-100 text-orange-800",followup:"bg-gray-100 text-gray-800"})[r]||"bg-gray-100 text-gray-800",y=r=>{switch(r){case"email":return"ðŸ“§";case"linkedin_connect":return"ðŸ”—";case"linkedin_message":return"ðŸ’¼";default:return"ðŸ“„"}};return x?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-center",children:"Loading templates..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Choose Campaign Template"}),e.jsx(C,{variant:"outline",onClick:n,children:"Close"})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Z,{placeholder:"Search templates...",value:l,onChange:r=>d(r.target.value),className:"pl-10"}),e.jsx(Me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]}),e.jsx("div",{className:"flex gap-2",children:p.map(r=>e.jsx(C,{variant:m===r.value?"default":"outline",size:"sm",onClick:()=>u(r.value),children:r.label},r.value))})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No templates found matching your criteria."}),e.jsx(C,{variant:"outline",onClick:()=>{d(""),u("all")},children:"Clear Filters"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(r=>e.jsxs(O,{className:"hover:shadow-lg transition-shadow cursor-pointer border-2 hover:border-blue-300",onClick:()=>t(r),children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{className:"text-lg mb-2",children:r.name}),e.jsx(te,{className:w(r.category),children:r.category})]}),e.jsx(lt,{className:"w-5 h-5 text-gray-400"})]})}),e.jsxs(L,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:r.objective}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:r.audience}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["Sequence (",r.steps.length," steps):"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.steps.slice(0,4).map((o,g)=>e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",title:o.subject||o.message,children:[y(o.type)," Day ",o.day_offset]},g)),r.steps.length>4&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",r.steps.length-4," more"]})]})]})]})]},r.id))})})]})})}function _t({campaign:t,onClose:n,onSave:s}){const[a,c]=v.useState(!1),[i,l]=v.useState({name:"",campaign_type:"email_only",status:"draft",email_template:"",linkedin_template:"",subject_line:"",target_companies:[],target_contacts:[],sequence_steps:[]}),[d,m]=v.useState([]),[u,x]=v.useState(!1);v.useEffect(()=>{t&&l({name:t.name||"",campaign_type:t.campaign_type||"email_only",status:t.status||"draft",email_template:t.email_template||"",linkedin_template:t.linkedin_template||"",subject_line:t.subject_line||"",target_companies:t.target_companies||[],target_contacts:t.target_contacts||[],sequence_steps:t.sequence_steps||[]})},[t]),v.useEffect(()=>{(async()=>{x(!0);try{const o=await G.get("/crm/leads?limit=100"),g=Array.isArray(o==null?void 0:o.rows)?o.rows:Array.isArray(o)?o:[];m(g.map(_=>({email:_.email,full_name:_.contact_name})))}catch(o){console.error("Failed to load available contacts:",o)}finally{x(!1)}})()},[]);const f=async r=>{r.preventDefault();try{const o=await nt.me().catch(()=>null),g={name:i.name,type:i.campaign_type,status:i.status,steps:(i.sequence_steps||[]).map(_=>({type:_.type,wait_days:_.wait_days,subject:_.subject,template:_.template})),audience:{emails:i.target_contacts,companies:i.target_companies},subject_line:i.subject_line,email_template:i.email_template,linkedin_template:i.linkedin_template,created_by:(o==null?void 0:o.email)||void 0};await G.post("/crm/campaigns",g),s&&s(g),n&&n()}catch(o){console.error("Error saving campaign:",o),alert("Failed to save campaign. Please try again.")}},p=r=>{l(o=>{var g,_,S;return{...o,name:r.name,email_template:((g=r.steps.find(b=>b.type==="email"))==null?void 0:g.body)||"",subject_line:((_=r.steps.find(b=>b.type==="email"))==null?void 0:_.subject)||"",linkedin_template:((S=r.steps.find(b=>b.type==="linkedin_message"))==null?void 0:S.message)||"",sequence_steps:r.steps.map((b,j)=>({step_number:j+1,type:b.type,wait_days:b.day_offset,template:b.body||b.message||"",subject:b.subject||""}))}}),c(!1)},N=()=>{const r={step_number:i.sequence_steps.length+1,type:"email",wait_days:i.sequence_steps.length===0?0:3,template:"",subject:""};l({...i,sequence_steps:[...i.sequence_steps,r]})},h=(r,o,g)=>{const _=[...i.sequence_steps];_[r][o]=g,l({...i,sequence_steps:_})},w=r=>{const o=i.sequence_steps.filter((g,_)=>_!==r);o.forEach((g,_)=>{g.step_number=_+1}),l({...i,sequence_steps:o})},y=r=>{switch(r){case"email":return e.jsx(ee,{className:"w-4 h-4"});case"linkedin":return e.jsx(bt,{className:"w-4 h-4"});case"linkedin_message":return e.jsx(Pe,{className:"w-4 h-4"});default:return e.jsx(ee,{className:"w-4 h-4"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Edit Campaign":"Create New Campaign"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>c(!0),children:"Use Template"}),e.jsx(C,{variant:"outline",onClick:n,children:"Close"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Name"}),e.jsx(Z,{required:!0,value:i.name,onChange:r=>l({...i,name:r.target.value}),placeholder:"e.g., Q1 Manufacturing Outreach"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Type"}),e.jsxs(oe,{value:i.campaign_type,onValueChange:r=>l({...i,campaign_type:r}),children:[e.jsx(de,{children:e.jsx(me,{})}),e.jsxs(ue,{children:[e.jsx(E,{value:"email_only",children:"Email Only"}),e.jsx(E,{value:"linkedin_only",children:"LinkedIn Only"}),e.jsx(E,{value:"email_linkedin_sequence",children:"Email + LinkedIn"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs(oe,{value:i.status,onValueChange:r=>l({...i,status:r}),children:[e.jsx(de,{children:e.jsx(me,{})}),e.jsxs(ue,{children:[e.jsx(E,{value:"draft",children:"Draft"}),e.jsx(E,{value:"active",children:"Active"}),e.jsx(E,{value:"paused",children:"Paused"}),e.jsx(E,{value:"completed",children:"Completed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Companies (comma-separated)"}),e.jsx(ce,{value:i.target_companies.join(", "),onChange:r=>l({...i,target_companies:r.target.value.split(",").map(o=>o.trim()).filter(Boolean)}),placeholder:"e.g., Google, Microsoft, Apple",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Contacts (email addresses, comma-separated)"}),e.jsx(ce,{value:i.target_contacts.join(", "),onChange:r=>l({...i,target_contacts:r.target.value.split(",").map(o=>o.trim()).filter(Boolean)}),placeholder:"e.g., john.doe@example.com, jane.smith@example.com",rows:3}),u?e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Loading available contacts..."}):d.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Available: ",d.map(r=>r.email).join(", ").substring(0,100),d.length>5?"...":""]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Campaign Sequence"}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",onClick:N,children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),i.sequence_steps.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-3",children:"No sequence steps yet"}),e.jsxs(C,{type:"button",variant:"outline",onClick:()=>c(!0),children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Use Template"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"or"}),e.jsxs(C,{type:"button",variant:"outline",onClick:N,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Create Step"]})]}):e.jsx("div",{className:"space-y-3",children:i.sequence_steps.map((r,o)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:r.step_number}),e.jsxs("span",{className:"font-medium",children:["Step ",r.step_number]}),y(r.type)]}),e.jsx(C,{type:"button",variant:"ghost",size:"sm",onClick:()=>w(o),children:e.jsx(Se,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Type"}),e.jsxs(oe,{value:r.type,onValueChange:g=>h(o,"type",g),children:[e.jsx(de,{children:e.jsx(me,{})}),e.jsxs(ue,{children:[e.jsx(E,{value:"email",children:"Email"}),e.jsx(E,{value:"linkedin",children:"LinkedIn Connect"}),e.jsx(E,{value:"linkedin_message",children:"LinkedIn Message"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Wait Days"}),e.jsx(Z,{type:"number",min:"0",value:r.wait_days,onChange:g=>h(o,"wait_days",parseInt(g.target.value)||0)})]}),r.type==="email"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Subject"}),e.jsx(Z,{value:r.subject||"",onChange:g=>h(o,"subject",g.target.value),placeholder:"Email subject..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:r.type==="email"?"Email Content":"LinkedIn Message"}),e.jsx(ce,{value:r.template,onChange:g=>h(o,"template",g.target.value),placeholder:r.type==="email"?"Email body...":"LinkedIn message...",rows:4})]})]},o))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsx(C,{type:"submit",children:t?"Update Campaign":"Create Campaign"})]})]})})]})}),a&&e.jsx(wt,{onSelectTemplate:p,onClose:()=>c(!1)})]})}var Ct=["type","layout","connectNulls","ref"],St=["key"];function $(t){"@babel/helpers - typeof";return $=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$(t)}function ve(t,n){if(t==null)return{};var s=kt(t,n),a,c;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(c=0;c<i.length;c++)a=i[c],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function kt(t,n){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(n.indexOf(a)>=0)continue;s[a]=t[a]}return s}function H(){return H=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},H.apply(this,arguments)}function be(t,n){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function D(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?be(Object(s),!0).forEach(function(a){T(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):be(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function B(t){return Tt(t)||Dt(t)||Pt(t)||At()}function At(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pt(t,n){if(t){if(typeof t=="string")return xe(t,n);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return xe(t,n)}}function Dt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Tt(t){if(Array.isArray(t))return xe(t)}function xe(t,n){(n==null||n>t.length)&&(n=t.length);for(var s=0,a=new Array(n);s<n;s++)a[s]=t[s];return a}function Et(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Ne(t,n){for(var s=0;s<n.length;s++){var a=n[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Te(a.key),a)}}function Ot(t,n,s){return n&&Ne(t.prototype,n),s&&Ne(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lt(t,n,s){return n=ae(n),Mt(t,De()?Reflect.construct(n,s||[],ae(t).constructor):n.apply(t,s))}function Mt(t,n){if(n&&($(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return It(t)}function It(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function De(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(De=function(){return!!t})()}function ae(t){return ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ae(t)}function Rt(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&pe(t,n)}function pe(t,n){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,c){return a.__proto__=c,a},pe(t,n)}function T(t,n,s){return n=Te(n),n in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}function Te(t){var n=Ft(t,"string");return $(n)=="symbol"?n:n+""}function Ft(t,n){if($(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,n);if($(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var R=(function(t){function n(){var s;Et(this,n);for(var a=arguments.length,c=new Array(a),i=0;i<a;i++)c[i]=arguments[i];return s=Lt(this,n,[].concat(c)),T(s,"state",{isAnimationFinished:!0,totalLength:0}),T(s,"generateSimpleStrokeDasharray",function(l,d){return"".concat(d,"px ").concat(l-d,"px")}),T(s,"getStrokeDasharray",function(l,d,m){var u=m.reduce(function(r,o){return r+o});if(!u)return s.generateSimpleStrokeDasharray(d,l);for(var x=Math.floor(l/u),f=l%u,p=d-l,N=[],h=0,w=0;h<m.length;w+=m[h],++h)if(w+m[h]>f){N=[].concat(B(m.slice(0,h)),[f-w]);break}var y=N.length%2===0?[0,p]:[p];return[].concat(B(n.repeat(m,x)),B(N),y).map(function(r){return"".concat(r,"px")}).join(", ")}),T(s,"id",Qe("recharts-line-")),T(s,"pathRef",function(l){s.mainCurve=l}),T(s,"handleAnimationEnd",function(){s.setState({isAnimationFinished:!0}),s.props.onAnimationEnd&&s.props.onAnimationEnd()}),T(s,"handleAnimationStart",function(){s.setState({isAnimationFinished:!1}),s.props.onAnimationStart&&s.props.onAnimationStart()}),s}return Rt(n,t),Ot(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();this.setState({totalLength:a})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();a!==this.state.totalLength&&this.setState({totalLength:a})}}},{key:"getTotalLength",value:function(){var a=this.mainCurve;try{return a&&a.getTotalLength&&a.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(a,c){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,l=i.points,d=i.xAxis,m=i.yAxis,u=i.layout,x=i.children,f=ze(x,We);if(!f)return null;var p=function(w,y){return{x:w.x,y:w.y,value:w.value,errorVal:we(w.payload,y)}},N={clipPath:a?"url(#clipPath-".concat(c,")"):null};return k.createElement(ie,N,f.map(function(h){return k.cloneElement(h,{key:"bar-".concat(h.props.dataKey),data:l,xAxis:d,yAxis:m,layout:u,dataPointFormatter:p})}))}},{key:"renderDots",value:function(a,c,i){var l=this.props.isAnimationActive;if(l&&!this.state.isAnimationFinished)return null;var d=this.props,m=d.dot,u=d.points,x=d.dataKey,f=X(this.props,!1),p=X(m,!0),N=u.map(function(w,y){var r=D(D(D({key:"dot-".concat(y),r:3},f),p),{},{index:y,cx:w.x,cy:w.y,value:w.value,dataKey:x,payload:w.payload,points:u});return n.renderDotItem(m,r)}),h={clipPath:a?"url(#clipPath-".concat(c?"":"dots-").concat(i,")"):null};return k.createElement(ie,H({className:"recharts-line-dots",key:"dots"},h),N)}},{key:"renderCurveStatically",value:function(a,c,i,l){var d=this.props,m=d.type,u=d.layout,x=d.connectNulls;d.ref;var f=ve(d,Ct),p=D(D(D({},X(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:c?"url(#clipPath-".concat(i,")"):null,points:a},l),{},{type:m,layout:u,connectNulls:x});return k.createElement(Ue,H({},p,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(a,c){var i=this,l=this.props,d=l.points,m=l.strokeDasharray,u=l.isAnimationActive,x=l.animationBegin,f=l.animationDuration,p=l.animationEasing,N=l.animationId,h=l.animateNewValues,w=l.width,y=l.height,r=this.state,o=r.prevPoints,g=r.totalLength;return k.createElement(Ke,{begin:x,duration:f,isActive:u,easing:p,from:{t:0},to:{t:1},key:"line-".concat(N),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(_){var S=_.t;if(o){var b=o.length/d.length,j=d.map(function(P,ne){var W=Math.floor(ne*b);if(o[W]){var U=o[W],q=K(U.x,P.x),Ee=K(U.y,P.y);return D(D({},P),{},{x:q(S),y:Ee(S)})}if(h){var Oe=K(w*2,P.x),Le=K(y/2,P.y);return D(D({},P),{},{x:Oe(S),y:Le(S)})}return D(D({},P),{},{x:P.x,y:P.y})});return i.renderCurveStatically(j,a,c)}var A=K(0,g),F=A(S),z;if(m){var Q="".concat(m).split(/[,\s]+/gim).map(function(P){return parseFloat(P)});z=i.getStrokeDasharray(F,g,Q)}else z=i.generateSimpleStrokeDasharray(g,F);return i.renderCurveStatically(d,a,c,{strokeDasharray:z})})}},{key:"renderCurve",value:function(a,c){var i=this.props,l=i.points,d=i.isAnimationActive,m=this.state,u=m.prevPoints,x=m.totalLength;return d&&l&&l.length&&(!u&&x>0||!Ve(u,l))?this.renderCurveWithAnimation(a,c):this.renderCurveStatically(l,a,c)}},{key:"render",value:function(){var a,c=this.props,i=c.hide,l=c.dot,d=c.points,m=c.className,u=c.xAxis,x=c.yAxis,f=c.top,p=c.left,N=c.width,h=c.height,w=c.isAnimationActive,y=c.id;if(i||!d||!d.length)return null;var r=this.state.isAnimationFinished,o=d.length===1,g=fe("recharts-line",m),_=u&&u.allowDataOverflow,S=x&&x.allowDataOverflow,b=_||S,j=he(y)?this.id:y,A=(a=X(l,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},F=A.r,z=F===void 0?3:F,Q=A.strokeWidth,P=Q===void 0?2:Q,ne=Ge(l)?l:{},W=ne.clipDot,U=W===void 0?!0:W,q=z*2+P;return k.createElement(ie,{className:g},_||S?k.createElement("defs",null,k.createElement("clipPath",{id:"clipPath-".concat(j)},k.createElement("rect",{x:_?p:p-N/2,y:S?f:f-h/2,width:_?N:N*2,height:S?h:h*2})),!U&&k.createElement("clipPath",{id:"clipPath-dots-".concat(j)},k.createElement("rect",{x:p-q/2,y:f-q/2,width:N+q,height:h+q}))):null,!o&&this.renderCurve(b,j),this.renderErrorBar(b,j),(o||l)&&this.renderDots(b,U,j),(!w||r)&&He.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(a,c){return a.animationId!==c.prevAnimationId?{prevAnimationId:a.animationId,curPoints:a.points,prevPoints:c.curPoints}:a.points!==c.curPoints?{curPoints:a.points}:null}},{key:"repeat",value:function(a,c){for(var i=a.length%2!==0?[].concat(B(a),[0]):a,l=[],d=0;d<c;++d)l=[].concat(B(l),B(i));return l}},{key:"renderDotItem",value:function(a,c){var i;if(k.isValidElement(a))i=k.cloneElement(a,c);else if(Be(a))i=a(c);else{var l=c.key,d=ve(c,St),m=fe("recharts-line-dot",typeof a!="boolean"?a.className:"");i=k.createElement($e,H({key:l},d,{className:m}))}return i}}])})(v.PureComponent);T(R,"displayName","Line");T(R,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Xe.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});T(R,"getComposedData",function(t){var n=t.props,s=t.xAxis,a=t.yAxis,c=t.xAxisTicks,i=t.yAxisTicks,l=t.dataKey,d=t.bandSize,m=t.displayedData,u=t.offset,x=n.layout,f=m.map(function(p,N){var h=we(p,l);return x==="horizontal"?{x:ye({axis:s,ticks:c,bandSize:d,entry:p,index:N}),y:he(h)?null:a.scale(h),value:h,payload:p}:{x:he(h)?null:s.scale(h),y:ye({axis:a,ticks:i,bandSize:d,entry:p,index:N}),value:h,payload:p}});return D({points:f,layout:x},u)});var qt=Ye({chartName:"LineChart",GraphicalChild:R,axisComponents:[{axisType:"xAxis",AxisComp:_e},{axisType:"yAxis",AxisComp:Ce}],formatAxisMap:Je});function Bt({campaign:t,onClose:n}){var w;const[s,a]=v.useState({totalSent:(t==null?void 0:t.sent_count)||0,opens:Math.round(((t==null?void 0:t.sent_count)||0)*.35),clicks:Math.round(((t==null?void 0:t.sent_count)||0)*.12),replies:(t==null?void 0:t.reply_count)||0,unsubscribes:Math.round(((t==null?void 0:t.sent_count)||0)*.02),bounces:Math.round(((t==null?void 0:t.sent_count)||0)*.03)}),[c,i]=v.useState([]),[l,d]=v.useState(!0),m=v.useCallback(async()=>{if(t){d(!0);try{const y=await it.filter({campaign_id:t.id},"-created_date"),r={totalSent:y.filter(o=>o.direction==="sent").length,opens:y.filter(o=>o.opened_at).length,clicks:y.filter(o=>o.clicked_at).length,replies:y.filter(o=>o.replied_at).length,unsubscribes:Math.round(y.length*.015),bounces:y.filter(o=>o.status==="bounced").length};a(r.totalSent>0?r:s)}catch(y){console.error("Failed to load campaign analytics:",y)}d(!1)}},[t,s]),u=v.useCallback(()=>{const y=[];for(let r=6;r>=0;r--){const o=Ze(new Date,r);y.push({date:J(o,"MMM dd"),sent:Math.floor(Math.random()*50)+10,opens:Math.floor(Math.random()*30)+5,clicks:Math.floor(Math.random()*15)+2,replies:Math.floor(Math.random()*8)+1})}i(y)},[]);v.useEffect(()=>{m(),u()},[m,u]);const x=(y,r)=>r===0?0:Math.round(y/r*100),f=x(s.opens,s.totalSent),p=x(s.clicks,s.totalSent),N=x(s.replies,s.totalSent),h=x(s.bounces,s.totalSent);return t?e.jsx(ct,{open:!0,onOpenChange:n,children:e.jsxs(ot,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[e.jsx(dt,{className:"p-6 border-b",children:e.jsxs(mt,{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),"Campaign Analytics: ",t.name]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6 space-y-6",children:l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(O,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(I,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Emails Sent"]})}),e.jsx(L,{children:e.jsx("div",{className:"text-2xl font-bold",children:s.totalSent.toLocaleString()})})]}),e.jsxs(O,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(I,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Open Rate"]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[f,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.opens," opens"]})]})]}),e.jsxs(O,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(I,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),"Click Rate"]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[p,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.clicks," clicks"]})]})]}),e.jsxs(O,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(I,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Reply Rate"]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[N,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.replies," replies"]})]})]})]}),e.jsxs(O,{children:[e.jsx(M,{children:e.jsx(I,{children:"Performance Breakdown"})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),"Open Rate"]}),e.jsxs("span",{className:"font-medium",children:[f,"% (",s.opens," of ",s.totalSent,")"]})]}),e.jsx(V,{value:f,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),"Click Rate"]}),e.jsxs("span",{className:"font-medium",children:[p,"% (",s.clicks," of ",s.totalSent,")"]})]}),e.jsx(V,{value:p,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),"Reply Rate"]}),e.jsxs("span",{className:"font-medium",children:[N,"% (",s.replies," of ",s.totalSent,")"]})]}),e.jsx(V,{value:N,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),"Bounce Rate"]}),e.jsxs("span",{className:"font-medium",children:[h,"% (",s.bounces," of ",s.totalSent,")"]})]}),e.jsx(V,{value:h,className:"h-2"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Industry Benchmarks"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Open Rate"}),e.jsx("div",{className:"text-blue-800",children:"25-35%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Click Rate"}),e.jsx("div",{className:"text-blue-800",children:"8-15%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Reply Rate"}),e.jsx("div",{className:"text-blue-800",children:"5-12%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Bounce Rate"}),e.jsx("div",{className:"text-blue-800",children:"<2%"})]})]})]})]})]}),e.jsxs(O,{children:[e.jsx(M,{children:e.jsx(I,{children:"Campaign Activity (Last 7 Days)"})}),e.jsx(L,{children:e.jsx("div",{className:"h-64",children:e.jsx(et,{width:"100%",height:"100%",children:e.jsxs(qt,{data:c,children:[e.jsx(tt,{strokeDasharray:"3 3",strokeOpacity:.3}),e.jsx(_e,{dataKey:"date",tick:{fontSize:12}}),e.jsx(Ce,{tick:{fontSize:12}}),e.jsx(st,{contentStyle:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px"}}),e.jsx(R,{type:"monotone",dataKey:"sent",stroke:"#3b82f6",strokeWidth:2,name:"Sent"}),e.jsx(R,{type:"monotone",dataKey:"opens",stroke:"#10b981",strokeWidth:2,name:"Opens"}),e.jsx(R,{type:"monotone",dataKey:"clicks",stroke:"#8b5cf6",strokeWidth:2,name:"Clicks"}),e.jsx(R,{type:"monotone",dataKey:"replies",stroke:"#f59e0b",strokeWidth:2,name:"Replies"})]})})})})]}),e.jsxs(O,{children:[e.jsx(M,{children:e.jsx(I,{children:"Campaign Details"})}),e.jsx(L,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx(te,{className:t.status==="active"?"bg-green-100 text-green-800":t.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:t.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Campaign Type:"}),e.jsx("span",{className:"font-medium",children:(w=t.campaign_type)==null?void 0:w.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Target Contacts:"}),e.jsx("span",{className:"font-medium",children:(t.target_contacts||[]).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sequence Steps:"}),e.jsx("span",{className:"font-medium",children:(t.sequence_steps||[]).length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"font-medium",children:J(new Date(t.created_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Activity:"}),e.jsx("span",{className:"font-medium",children:J(new Date,"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Completion:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(s.totalSent/Math.max((t.target_contacts||[]).length,1)*100),"%"]})]})]})]})})]})]})})]})}):null}const Y=t=>t?Array.isArray(t)?t:Array.isArray(t==null?void 0:t.rows)?t.rows:Array.isArray(t==null?void 0:t.data)?t.data:[]:[];function ms(){const{user:t}=Fe(),[n,s]=v.useState([]),[a,c]=v.useState(!0),[i,l]=v.useState(null),[d,m]=v.useState(!1),[u,x]=v.useState(null),[f,p]=v.useState(""),[N,h]=v.useState(!1),[w,y]=v.useState(null);v.useEffect(()=>{(async()=>{c(!0),l(null),p("Starting to load campaigns...");try{const j=t||null;if(j&&!qe(j,"campaigns")){console.log("CampaignsPage: User does not have campaigns access"),h(!1),c(!1),p("User does not have access to Campaigns feature.");return}h(!0);try{const A=await G.get("/public/campaigns");s(Y(A)),p(F=>F+`
Loaded ${Y(A).length} campaigns.`)}catch(A){console.error("CampaignsPage: Failed to load campaigns:",A),l(`Failed to load campaigns: ${A.message||A}`),s([])}}catch(j){console.error("CampaignsPage: Critical error loading user or initial data:",j);const A=`Failed to load initial data (user/access): ${j.message}`;l(A),h(!1),p(`CRITICAL ERROR: ${A}`)}finally{c(!1)}})()},[t]);const r=()=>{x(null),m(!0)},o=b=>{x(b),m(!0)},g=async b=>{m(!1),x(null),c(!0);try{const j=await G.get("/public/campaigns");s(Y(j)),l(null)}catch(j){console.error("Failed to refresh campaigns after save:",j),l(`Failed to refresh campaigns: ${j.message}`)}finally{c(!1)}},_=async b=>{c(!0);try{const j=await G.get("/crm/campaigns");s(Y(j)),l(null)}catch(j){console.error("Failed to refresh campaigns after delete:",j),l(`Failed to refresh campaigns: ${j.message}`)}finally{c(!1)}},S=async(b,j)=>{console.warn("Toggle action is disabled until write API is available")};return a?e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 h-full bg-[#F6F8FB] min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1E5EFF] mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading data..."}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded text-xs text-gray-700 max-w-md",children:["Debug: ",f]})]}):d||u?e.jsx(_t,{campaign:u,onSave:g,onClose:()=>{m(!1),x(null)}}):e.jsxs("div",{className:"p-6 bg-[#F6F8FB] min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:["Q4 Prospecting","Reactivation Push","Freight Expo Leads","Top Lanes Outreach"].map((b,j)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow border p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Smoke Test"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:b}),e.jsx("div",{className:"text-xs text-gray-500",children:"Leads: â€” | Status: Draft"})]},j))}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Campaigns"}),e.jsxs(C,{onClick:r,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),i&&e.jsxs(ut,{variant:"destructive",className:"mb-6",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx(ht,{children:"Data Loading Error"}),e.jsxs(xt,{children:[i,e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"This indicates a backend connectivity issue or missing data. Please contact Base44 support if this persists."}),f&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs",children:"Technical Details"}),e.jsx("pre",{className:"text-xs mt-1 bg-gray-100 p-2 rounded whitespace-pre-wrap",children:f})]})]})]}),n.length===0&&!a&&!i&&e.jsx(O,{className:"text-center p-12 border-2 border-dashed",children:e.jsxs(L,{children:[e.jsx(ke,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No campaigns yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new outreach campaign."}),e.jsx("div",{className:"mt-6",children:e.jsxs(C,{onClick:r,children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Create Campaign"]})})]})}),!a&&!i&&n.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(b=>e.jsx(Nt,{campaign:b,onToggle:S,onEdit:o,onDelete:_,onClick:j=>y(j)},b.id))})]}),w&&e.jsx(Bt,{campaign:w,onClose:()=>y(null)})]})}export{ms as default};
