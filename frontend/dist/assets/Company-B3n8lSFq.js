import{a0 as F,r as a,j as e,B as m}from"./main-D-7w3H6z.js";import{T as H,a as V,b as x,c as u}from"./tabs-D2LN6exz.js";import{O as Z,a as $,b as J,E as K,N as Q}from"./NotesTab-diJaR9K6.js";import{Contact as A,Note as T}from"./entities-CpFcElq0.js";import{p as E,b as W,e as X,r as Y}from"./api-WB8G_zPo.js";import"./index-B3_2pEZt.js";import"./index-CJeicktP.js";import"./badge-BniCWYso.js";import"./format-DIePDvv_.js";import"./truck-D-kNK6K2.js";import"./ship-BP4kgUrO.js";import"./select-B_8VoJZ1.js";import"./input-B4tq-QXj.js";import"./label-VIkuwWUc.js";import"./functions-MwX3WfTm.js";import"./loader-circle-CjsUPNLp.js";import"./plus-Cr6cDgMg.js";import"./lock-Bt906_zi.js";import"./users-DYf2QGKD.js";import"./message-square-C4pP6Pza.js";import"./trash-2-D6H6Leqp.js";import"./textarea-C7H5rGWh.js";import"./base44Client-C-YMJfZQ.js";function _e(){const{id:I}=F(),t=I,[y,v]=a.useState(null),[i,k]=a.useState(null),[g,P]=a.useState([]),[d,L]=a.useState(0),[o,b]=a.useState(1),l=50,[R,z]=a.useState([]),[B,G]=a.useState([]),[c,N]=a.useState(!0),[j,_]=a.useState(!1),[f,w]=a.useState(null),p=a.useCallback(async()=>{if(t){N(!0);try{const[s,r,U,q]=await Promise.all([E({company_ids:[String(t)],limit:1,offset:0}),W({company_id:t,limit:l,offset:(o-1)*l}),A.filter({company_id:t},"-created_date",50),T.filter({company_id:t},"-created_date",50)]);let n=Array.isArray(s==null?void 0:s.data)&&s.data.length?s.data[0]:null;if(!n){const h=await E({company_id:String(t),limit:1,offset:0});n=Array.isArray(h==null?void 0:h.data)&&h.data.length?h.data[0]:null}n&&(k(n),v({shipments_12m:n.shipments_12m,last_seen:n.last_activity,top_route:Array.isArray(n.top_routes)&&n.top_routes.length?n.top_routes[0]:void 0,top_carriers:Array.isArray(n.top_carriers)?n.top_carriers:[],industry:null,hq_city:null,hq_country:null,domain:null,employee_count:null}));const C=Array.isArray(r==null?void 0:r.data)?r.data:[];P(C),L(typeof(r==null?void 0:r.total)=="number"?r.total:C.length),z(U||[]),G(q||[])}catch(s){console.error("Company load error",s)}finally{N(!1)}}},[t,o]);a.useEffect(()=>{p()},[p]);const M=async s=>{await A.create({...s,company_id:t}),p()},D=async s=>{await T.create({content:s,company_id:t}),p()},S=async()=>{_(!0);try{await X({company_id:String(t)}),await p()}catch(s){console.error("Enrich error",s)}finally{_(!1)}},O=async()=>{if(t)try{const s=await Y({company_id:String(t)});w({summary:(s==null?void 0:s.summary)||"",bullets:Array.isArray(s==null?void 0:s.bullets)?s.bullets:[]})}catch(s){console.error("Recall error",s),w({summary:"",bullets:[]}),alert("Recall failed")}};return!y&&!c?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Company not found"}),e.jsx("p",{className:"text-gray-600",children:"This company may not be saved yet. Go back to Search to discover and save companies."}),e.jsx("div",{className:"mt-4",children:e.jsx(m,{variant:"outline",onClick:()=>window.location.href="/app/search",children:"Back to Search"})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:(i==null?void 0:i.company_name)||"Company"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",t]}),i&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Shipments (12M):"})," ",e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat().format(i.shipments_12m||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Activity:"})," ",e.jsx("span",{className:"font-semibold",children:i.last_activity?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit"}).format(new Date(i.last_activity)):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Top Route:"})," ",e.jsx("span",{className:"font-semibold",children:i.top_routes&&i.top_routes[0]||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Top Carrier:"})," ",e.jsx("span",{className:"font-semibold",children:i.top_carriers&&i.top_carriers[0]||"—"})]})]}),e.jsx(m,{size:"sm",onClick:O,className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:"Recall"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700",onClick:()=>{window.location.href=`/app/pre-call?company_id=${t}`},children:"Pre-Call Briefing"}),e.jsx(m,{size:"sm",onClick:S,disabled:j,className:"bg-purple-600 hover:bg-purple-700 text-white",children:j?"Enriching…":"Enrich Now"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border shadow-sm",children:e.jsxs(H,{defaultValue:"overview",className:"w-full",children:[e.jsx("div",{className:"px-4 pt-4 border-b",children:e.jsxs(V,{children:[e.jsx(x,{value:"overview",children:"Overview"}),e.jsx(x,{value:"shipments",children:"Shipments"}),e.jsx(x,{value:"contacts",children:"Contacts"}),e.jsx(x,{value:"ai_insights",children:"AI Insights"}),e.jsx(x,{value:"notes",children:"Notes"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx(u,{value:"overview",children:e.jsx(Z,{company:y,shipments:g,isLoading:c})}),e.jsxs(u,{value:"shipments",children:[e.jsx($,{shipments:g,isLoading:c}),d>l&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",Math.min(d,o*l)-l+1,"-",Math.min(d,o*l)," of ",d]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",disabled:o<=1||c,onClick:()=>b(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(m,{variant:"outline",size:"sm",disabled:o*l>=d||c,onClick:()=>b(s=>s+1),children:"Next"})]})]})]}),e.jsx(u,{value:"contacts",children:e.jsx(J,{contacts:R,companyId:t,company:y,onAddContact:M,isGated:!1,onUnlock:()=>{},isLoading:!1})}),e.jsxs(u,{value:"ai_insights",children:[e.jsx(K,{company:y||{id:t},onCompanyUpdate:v,user:null,isGated:!1,onUnlock:()=>{},isLoading:!1,onEnrich:S,isEnriching:j}),f&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI Recall"}),e.jsx("p",{className:"mt-2 text-sm whitespace-pre-wrap",children:f.summary}),e.jsx("ul",{className:"list-disc pl-5 mt-2",children:(f.bullets||[]).map((s,r)=>e.jsx("li",{className:"text-sm",children:s},r))})]})]}),e.jsx(u,{value:"notes",children:e.jsx(Q,{notes:B,onAddNote:D,isLoading:c})})]})]})})]})}export{_e as default};
