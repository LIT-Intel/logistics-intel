import{c as G,r as c,j as e,a as ae,B as y,M as se}from"./main-CHtrqkqB.js";import{D as te,a as re,b as ne,c as ie,X as ce}from"./dialog-BLIgN1br.js";import{B as oe}from"./badge-VAgm91vg.js";import{T as le,a as me,b as v,c as j}from"./tabs-U1cyERKM.js";import{Contact as $,Note as F}from"./entities-CpFcElq0.js";import{c as de}from"./index-DR9D_4bA.js";import{postSearchCompanies as pe,getCompanyShipments as he,enrichCompany as ue}from"./api-D316z6pj.js";import{B as xe,O as fe,S as ge,a as ye,E as ve,N as je,T as Ne}from"./NotesTab-Djdpsfi6.js";import{L as we}from"./loader-circle-Lvp0dEMP.js";import{L as be}from"./lock-CgtdNciX.js";import{S as Se}from"./sparkles-DCPMkPQW.js";import{S as O}from"./ship-B5B8nrk0.js";import{T as ke,P as Ce}from"./truck-BtF7IDZ9.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Te=G("BookmarkCheck",_e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],De=G("Globe",Ae),Ee="https://lit-caller-gw-2e68g4k3.uc.gateway.dev";async function Pe(s){if(!s.ok)throw new Error(`${s.status}`);return s.json()}async function Ie(){const s=await fetch(`${Ee}/crm/feature-flags`,{headers:{accept:"application/json"}});return Pe(s)}function Le(){const[s,h]=c.useState({companyDrawerPremium:!0});return c.useEffect(()=>{let o=!1;return Ie().then(S=>{if(o)return;const N={};for(const w of S.flags||[])N[w.key]=!!w.enabled;h({companyDrawerPremium:N.companyDrawerPremium??!0})}).catch(()=>{}),()=>{o=!0}},[]),s}function Be({company:s,isOpen:h,onClose:o,onSave:S,user:N,isSaved:w=!1}){const{companyDrawerPremium:R}=Le(),[u,k]=c.useState(null),[C,A]=c.useState([]),[V,D]=c.useState([]),[E,P]=c.useState([]),[_,I]=c.useState(!0),[l,L]=c.useState(!1),[q,B]=c.useState(!1),t=s==null?void 0:s.id,x=c.useCallback(async()=>{var a,p;if(t){I(!0);try{const i=pe({company_id:String(t),limit:1,offset:0}),n=he({company_id:String(t),limit:50,offset:0}),d=$.filter({company_id:t},"-created_date",50),Q=F.filter({company_id:t},"-created_date",50),[g,b,W,Y]=await Promise.all([i,n,d,Q]),r=Array.isArray(g==null?void 0:g.items)&&g.items.length?g.items[0]:null;if(r){const ee={id:r.company_id,name:r.company_name||"Unknown",shipments_12m:r.shipments||0,last_seen:r.lastShipmentDate||null,top_route:Array.isArray(r.originsTop)&&Array.isArray(r.destsTop)?`${((a=r.originsTop[0])==null?void 0:a.v)||""} → ${((p=r.destsTop[0])==null?void 0:p.v)||""}`:void 0,top_carriers:Array.isArray(r.carriersTop)?r.carriersTop.map(T=>T.v):[],mode_breakdown:Array.isArray(r.modes)?r.modes.map(T=>({mode:String(T).toLowerCase(),cnt:0})):[]};k(ee)}const U=Array.isArray(b==null?void 0:b.rows)?b.rows:[];A(Array.isArray(U)?U:[]),D(W),P(Y)}catch(i){console.error("Error loading related company data:",i)}finally{I(!1)}}},[t]);c.useEffect(()=>{h&&t?x():(k(null),A([]),P([]),D([]))},[h,t,x]);const H=async a=>{await $.create({...a,company_id:t}),x()},J=async a=>{await F.create({content:a,company_id:t}),x()},f=async()=>{L(!0);try{await S(s)}catch(a){console.error("Error saving company:",a)}finally{L(!1)}},X=async()=>{B(!0);try{await ue({company_id:String(t)}),x()}catch(a){console.error("Error enriching company:",a),alert("Enrichment failed: "+((a==null?void 0:a.message)||String(a)))}finally{B(!1)}},Z=()=>{const a=de("EmailCenter")+`?company_id=${t}`;window.location.href=a,o()},K=a=>{if(!a||a.length===0)return[];const p=a.reduce((i,n)=>i+n.cnt,0);return a.map(i=>{let n,d;switch(i.mode.toLowerCase()){case"ocean":n=O,d="text-blue-500";break;case"air":n=Ce,d="text-purple-500";break;case"truck":n=ke,d="text-green-500";break;case"rail":n=Ne,d="text-purple-600";break;default:n=O,d="text-gray-500"}return{type:i.mode,percentage:p>0?Math.round(i.cnt/p*100):0,icon:n,color:d}}).sort((i,n)=>n.percentage-i.percentage)};if(!h||!s)return null;const m=!!w,M=K(u==null?void 0:u.mode_breakdown),z=u||s;return e.jsx(e.Fragment,{children:e.jsx(te,{open:h,onOpenChange:a=>{a||o==null||o()},children:e.jsxs(re,{className:"max-w-4xl h-[90vh] flex flex-col p-0 md:rounded-2xl rounded-none md:inset-auto inset-0",children:[e.jsx(ne,{className:"p-6 border-b",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{className:"text-2xl font-bold text-gray-900",children:z.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["ID: ",t]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Trade Data Available"})]})]}),M.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-3",children:M.map(a=>{const p=a.icon;return e.jsxs(oe,{variant:"outline",className:"flex items-center gap-1.5 pl-2 pr-2.5 py-1",children:[e.jsx(p,{className:`w-4 h-4 ${a.color}`}),e.jsx("span",{className:"font-medium text-gray-700",children:a.type.charAt(0).toUpperCase()+a.type.slice(1)}),e.jsxs("span",{className:"text-gray-500",children:[a.percentage,"%"]})]},a.type)})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(y,{size:"sm",onClick:f,variant:"outline",className:"flex items-center gap-2",disabled:l||m,children:[l&&e.jsx(we,{className:"mr-2 h-4 w-4 animate-spin"}),m?e.jsx(Te,{className:"w-4 h-4 text-blue-600"}):e.jsx(xe,{className:"w-4 h-4"}),m?"Saved":"Save"]}),e.jsxs(y,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:Z,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Start Outreach"]})]})]})}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsxs(le,{defaultValue:"overview",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 border-b",children:e.jsxs(me,{children:[e.jsx(v,{value:"overview",children:"Overview"}),e.jsxs(v,{value:"shipments",children:["Shipments (",C.length,")"]}),R?e.jsxs(v,{value:"contacts",disabled:!m,children:[!m&&e.jsx(be,{className:"w-3 h-3 mr-1.5"}),"Contacts"]}):null,e.jsxs(v,{value:"ai_insights",children:[e.jsx(Se,{className:"w-3 h-3 mr-1.5"}),"AI Insights"]}),e.jsxs(v,{value:"notes",disabled:!m,children:["Notes (",E.length,")"]})]})}),e.jsxs("div",{className:"flex-grow overflow-auto",children:[e.jsx(j,{value:"overview",className:"p-6",children:e.jsx(fe,{company:u,shipments:C,isLoading:_})}),e.jsx(j,{value:"shipments",className:"p-6",children:e.jsx(ge,{shipments:C,isLoading:_,onRowClick:a=>alert(JSON.stringify(a,null,2))})}),e.jsx(j,{value:"contacts",className:"p-6",children:m?e.jsx(ye,{contacts:V,companyId:t,company:z,onAddContact:H,isGated:!1,onUnlock:f,isLoading:l}):e.jsxs("div",{className:"text-sm text-gray-600",children:["Save this company to manage contacts.",e.jsx("div",{className:"mt-3",children:e.jsx(y,{size:"sm",variant:"outline",onClick:f,disabled:l,children:l?"Saving…":"Save Company"})})]})}),e.jsx(j,{value:"ai_insights",className:"p-6",children:e.jsx(ve,{company:u||s,onCompanyUpdate:k,user:N,isGated:!1,onUnlock:f,isLoading:l,onEnrich:X,isEnriching:q})}),e.jsx(j,{value:"notes",className:"p-6",children:m?e.jsx(je,{notes:E,onAddNote:J,isLoading:_}):e.jsxs("div",{className:"text-sm text-gray-600",children:["Save this company to add and view notes.",e.jsx("div",{className:"mt-3",children:e.jsx(y,{size:"sm",variant:"outline",onClick:f,disabled:l,children:l?"Saving…":"Save Company"})})]})})]})]})}),e.jsx(y,{variant:"ghost",size:"icon",onClick:o,className:"absolute top-4 right-4 rounded-full",children:e.jsx(ce,{className:"w-5 h-5"})})]})})})}const Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{Te as B,Be as C,Ze as a};
