import{aj as y}from"./main-mKPugC2G.js";const l={VITE_API_BASE:"https://lit-caller-gw-2e68g4k3.uc.gateway.dev"};var g={};const w=(()=>{const t=l||{},e=t.VITE_API_BASE||t.VITE_PROXY_BASE||"/api/public";return e.endsWith("/public")?e:e.endsWith("/public/")?e.slice(0,-1):e==="/api/public"?e:e.replace(/\/$/,"")+"/public"})(),f="https://lit-caller-gw-2e68g4k3.uc.gateway.dev".replace(/\/public\/?$/,"");async function d(t){const e=await t;if(!e.ok){const n=await e.text().catch(()=>String(e.status));throw new Error(n||String(e.status))}return e.json()}const u={async get(t,e){var r,o,i;const n=`${f}${t}`,c=await((i=(o=(r=y)==null?void 0:r.currentUser)==null?void 0:o.getIdToken)==null?void 0:i.call(o).catch(()=>null)),s={accept:"application/json",...c?{Authorization:`Bearer ${c}`}:{},...(e==null?void 0:e.headers)||{}};return d(fetch(n,{...e||{},headers:s,credentials:"omit",cache:"no-store"}))},async post(t,e,n){var o,i,h;const c=`${f}${t}`,s=await((h=(i=(o=y)==null?void 0:o.currentUser)==null?void 0:i.getIdToken)==null?void 0:h.call(i).catch(()=>null)),r={"content-type":"application/json",accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{},...(n==null?void 0:n.headers)||{}};return d(fetch(c,{method:"POST",headers:r,body:JSON.stringify(e??{}),credentials:"omit",cache:"no-store",...n}))}};function S(t){const e=Number(t.shipments12m??t.shipments_12m??t.shipments??0),n=(t.lastActivity??t.last_activity??t.lastShipmentDate)||null,c=t.originsTop??t.origins_top??[],s=t.destsTop??t.dests_top??[],r=t.carriersTop??t.carriers_top??[];return{shipments12m:e,lastActivity:n,originsTop:c,destsTop:s,carriersTop:r}}const a="https://lit-caller-gw-2e68g4k3.uc.gateway.dev".replace(/\/$/,"");async function m(t){const e=p=>Array.isArray(p)?p:[],n=Math.min(t==null?void 0:t.limit,50),c=t==null?void 0:t.offset,s={q:(t==null?void 0:t.q)??null,mode:(t==null?void 0:t.mode)??null,origin:e(t==null?void 0:t.origin),dest:e(t==null?void 0:t.dest),hs:e(t==null?void 0:t.hs),limit:n,offset:c};let r;try{r=await fetch(`${a}/public/searchCompanies`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(s)})}catch(p){throw new Error(`network_error:${String(p)}`)}if(!r.ok){const p=await r.text().catch(()=>"");throw new Error(`bad_status:${r.status}:${p.substring(0,300)}`)}const o=await r.json().catch(()=>({})),i=Number((o==null?void 0:o.total)??0),h=Array.isArray(o==null?void 0:o.items)?o.items:[];return{total:i,items:h}}async function j(t,e){return u.post("/public/searchCompanies",t,{signal:e})}async function O(t,e){const{company_id:n,limit:c=50,offset:s=0}=t,r=new URLSearchParams({company_id:n,limit:String(c),offset:String(s)});return u.get(`/public/getCompanyShipments?${r.toString()}`,{signal:e})}async function T(t={},e){return u.get("/public/getFilterOptions",{signal:e})}async function E(t,e){const n=await fetch(`${w}/widgets/tariff/calc`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t||{}),signal:e});if(!n.ok)throw new Error(`calcTariff ${n.status}`);return n.json()}async function b(t,e){const n=await fetch(`${w}/widgets/quote/generate`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t||{}),signal:e});if(!n.ok)throw new Error(`generateQuote ${n.status}`);return n.json()}async function k(t){try{const c=await fetch(`${a}/crm/saveCompany`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify({...t,source:t.source??"search"})});if(c.ok)return c.json()}catch{}const e=await fetch(`${a}/crm/company.create`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify({name:t.company_name})});if(!e.ok){const c=await e.text().catch(()=>"");throw new Error(`company.create ${e.status}:${c.slice(0,200)}`)}const n=await e.json().catch(()=>({}));return{status:"created",crm_company_id:(n==null?void 0:n.company_id)||(n==null?void 0:n.id)||t.company_id}}async function _(t){const e=await fetch(`${a}/crm/enrich`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text().catch(()=>"");throw new Error(`enrich ${e.status}:${n.slice(0,200)}`)}return e.json()}async function A(t){const e=g.NEXT_PUBLIC_AI_VENDOR||(l==null?void 0:l.VITE_AI_VENDOR)||"gemini",n=await fetch(`${a}/ai/recall`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json","x-ai-vendor":String(e)},body:JSON.stringify(t)});if(!n.ok){const c=await n.text().catch(()=>"");throw new Error(`recall ${n.status}:${c.slice(0,200)}`)}return n.json()}async function P(t){const e=await fetch(`${a}/crm/campaigns`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text().catch(()=>"");throw new Error(`saveCampaign ${e.status}:${n.slice(0,200)}`)}return e.json()}async function C(t){const e=await fetch(`${a}/crm/company.create`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t||{})});if(!e.ok){const n=await e.text().catch(()=>"");throw new Error(`company.create ${e.status}:${n.slice(0,200)}`)}return e.json()}async function N(t){const e=`${a}/crm/email.threads?company_id=${encodeURIComponent(t)}`,n=await fetch(e,{headers:{accept:"application/json"}});if(!n.ok)throw new Error(`email.threads ${n.status}`);return n.json()}async function I(t){const e=`${a}/crm/calendar.events?company_id=${encodeURIComponent(t)}`,n=await fetch(e,{headers:{accept:"application/json"}});if(!n.ok)throw new Error(`calendar.events ${n.status}`);return n.json()}async function v(t){const e=await fetch(`${a}/crm/task.create`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`task.create ${e.status}`);return e.json()}async function J(t){const e=await fetch(`${a}/crm/alert.create`,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`alert.create ${e.status}`);return e.json()}export{u as api,E as calcTariff,J as createAlert,C as createCompany,v as createTask,_ as enrichCompany,b as generateQuote,I as getCalendarEvents,O as getCompanyShipments,N as getEmailThreads,T as getFilterOptions,S as kpiFrom,j as postSearchCompanies,A as recallCompany,P as saveCampaign,k as saveCompanyToCrm,m as searchCompanies};
