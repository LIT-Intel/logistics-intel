import{a0 as D,r as i,j as e,B as p}from"./main-D6vxZYeV.js";import{T as O,a as U,b as h,c as x}from"./tabs-gCRSLrvN.js";import{O as q,a as F,b as H,E as V,N as Z}from"./NotesTab-BToip9K3.js";import{Contact as w,Note as C}from"./entities-CpFcElq0.js";import{enrichCompany as $}from"./functions-DItVLH8t.js";import{p as J,d as K}from"./api-kmcxhiMt.js";import"./index-ljTxVNh-.js";import"./index-Cy6wi5M3.js";import"./badge-B9CpQrvY.js";import"./format-DIePDvv_.js";import"./truck-DGckJkxM.js";import"./ship-PN2S97eh.js";import"./select-BHr66boF.js";import"./input-B5GH_Rvh.js";import"./label-CbJd33yU.js";import"./loader-circle-DYBTYwGO.js";import"./plus-UVBAYAVX.js";import"./lock-BAV4dFnT.js";import"./users-Cr7WCzdi.js";import"./message-square-DwfzN-MB.js";import"./trash-2-BI3Qmbxf.js";import"./textarea-6DnRwPRj.js";import"./base44Client-C-YMJfZQ.js";function fe(){const{id:S}=D(),t=S,[u,j]=i.useState(null),[a,T]=i.useState(null),[f,A]=i.useState([]),[m,E]=i.useState(0),[l,v]=i.useState(1),o=50,[k,I]=i.useState([]),[P,L]=i.useState([]),[c,g]=i.useState(!0),[y,N]=i.useState(!1),d=i.useCallback(async()=>{if(t){g(!0);try{const[s,r,M,z]=await Promise.all([J({company_id:t,limit:1,offset:0}),K({company_id:t,limit:o,offset:(l-1)*o}),w.filter({company_id:t},"-created_date",50),C.filter({company_id:t},"-created_date",50)]),n=Array.isArray(s==null?void 0:s.data)&&s.data.length?s.data[0]:null;n&&(T(n),j({shipments_12m:n.shipments_12m,last_seen:n.last_activity,top_route:Array.isArray(n.top_routes)&&n.top_routes.length?n.top_routes[0]:void 0,top_carriers:Array.isArray(n.top_carriers)?n.top_carriers:[],industry:null,hq_city:null,hq_country:null,domain:null,employee_count:null}));const _=Array.isArray(r==null?void 0:r.data)?r.data:[];A(_),E(typeof(r==null?void 0:r.total)=="number"?r.total:_.length),I(M||[]),L(z||[])}catch(s){console.error("Company load error",s)}finally{g(!1)}}},[t,l]);i.useEffect(()=>{d()},[d]);const B=async s=>{await w.create({...s,company_id:t}),d()},G=async s=>{await C.create({content:s,company_id:t}),d()},b=async()=>{N(!0);try{await $({company_id:t}),await d()}catch(s){console.error("Enrich error",s)}finally{N(!1)}};return!u&&!c?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Company not found"}),e.jsx("p",{className:"text-gray-600",children:"This company may not be saved yet. Go back to Search to discover and save companies."}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{variant:"outline",onClick:()=>window.location.href="/app/search",children:"Back to Search"})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:(a==null?void 0:a.company_name)||"Company"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",t]}),a&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Shipments (12M):"})," ",e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat().format(a.shipments_12m||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Activity:"})," ",e.jsx("span",{className:"font-semibold",children:a.last_activity?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit"}).format(new Date(a.last_activity)):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Top Route:"})," ",e.jsx("span",{className:"font-semibold",children:a.top_routes&&a.top_routes[0]||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Top Carrier:"})," ",e.jsx("span",{className:"font-semibold",children:a.top_carriers&&a.top_carriers[0]||"—"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700",onClick:()=>{window.location.href=`/app/pre-call?company_id=${t}`},children:"Pre-Call Briefing"}),e.jsx(p,{size:"sm",onClick:b,disabled:y,className:"bg-purple-600 hover:bg-purple-700 text-white",children:y?"Enriching…":"Enrich Now"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border shadow-sm",children:e.jsxs(O,{defaultValue:"overview",className:"w-full",children:[e.jsx("div",{className:"px-4 pt-4 border-b",children:e.jsxs(U,{children:[e.jsx(h,{value:"overview",children:"Overview"}),e.jsx(h,{value:"shipments",children:"Shipments"}),e.jsx(h,{value:"contacts",children:"Contacts"}),e.jsx(h,{value:"ai_insights",children:"AI Insights"}),e.jsx(h,{value:"notes",children:"Notes"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx(x,{value:"overview",children:e.jsx(q,{company:u,shipments:f,isLoading:c})}),e.jsxs(x,{value:"shipments",children:[e.jsx(F,{shipments:f,isLoading:c}),m>o&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",Math.min(m,l*o)-o+1,"-",Math.min(m,l*o)," of ",m]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",disabled:l<=1||c,onClick:()=>v(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(p,{variant:"outline",size:"sm",disabled:l*o>=m||c,onClick:()=>v(s=>s+1),children:"Next"})]})]})]}),e.jsx(x,{value:"contacts",children:e.jsx(H,{contacts:k,companyId:t,company:u,onAddContact:B,isGated:!1,onUnlock:()=>{},isLoading:!1})}),e.jsx(x,{value:"ai_insights",children:e.jsx(V,{company:u||{id:t},onCompanyUpdate:j,user:null,isGated:!1,onUnlock:()=>{},isLoading:!1,onEnrich:b,isEnriching:y})}),e.jsx(x,{value:"notes",children:e.jsx(Z,{notes:P,onAddNote:G,isLoading:c})})]})]})})]})}export{fe as default};
