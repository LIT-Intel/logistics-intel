import{V as O,r as o,j as e,B as b}from"./main-CSxjyf2y.js";import{T as B,a as P,b as i,c}from"./tabs-DN0jao0y.js";import{O as U,e as G,f as V,g as z,N as D}from"./NotesTab-BVtcbGFY.js";import{Contact as v,Note as C}from"./entities-CnsKiLH-.js";import{getCompanyOverview as $,getCompanyShipments as q,enrichCompany as F}from"./functions-BiBq-vTN.js";import"./index-2Ri7XQMi.js";import"./index-OfiTLaQ9.js";import"./badge-vZXRrHht.js";import"./format-DIePDvv_.js";import"./truck-BfuYRewr.js";import"./ship-lQw5zPSB.js";import"./select-CwXzHEgM.js";import"./input-BsbiDyYk.js";import"./label-SSDgzWKN.js";import"./loader-circle-DZNa8K6w.js";import"./plus-B1a7RQbV.js";import"./textarea-BPbnhhV7.js";import"./users-DMNCVANm.js";import"./message-square-B_MuTDHI.js";import"./trash-2-BclrRXfg.js";import"./base44Client-C-YMJfZQ.js";function me(){const{id:N}=O(),t=N,[l,p]=o.useState(null),[h,w]=o.useState([]),[_,E]=o.useState([]),[T,S]=o.useState([]),[d,u]=o.useState(!0),[m,x]=o.useState(!1),r=o.useCallback(async()=>{var n,y;if(t){u(!0);try{const[s,a,k,L]=await Promise.all([$({company_id:t}),q({company_id:t,limit:50}),v.filter({company_id:t},"-created_date",50),C.filter({company_id:t},"-created_date",50)]),j=((n=s==null?void 0:s.data)==null?void 0:n.result)??(s==null?void 0:s.result)??(s==null?void 0:s.data)??s??null;j&&p(j);const g=((y=a==null?void 0:a.data)==null?void 0:y.results)??(a==null?void 0:a.results)??(a==null?void 0:a.rows)??[];w(Array.isArray(g)?g:[]),E(k||[]),S(L||[])}catch(s){console.error("Company load error",s)}finally{u(!1)}}},[t]);o.useEffect(()=>{r()},[r]);const A=async n=>{await v.create({...n,company_id:t}),r()},I=async n=>{await C.create({content:n,company_id:t}),r()},f=async()=>{x(!0);try{await F({company_id:t}),await r()}catch(n){console.error("Enrich error",n)}finally{x(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Company"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",t]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700",onClick:()=>{window.location.href=`/app/pre-call?company_id=${t}`},children:"Pre-Call Briefing"}),e.jsx(b,{size:"sm",onClick:f,disabled:m,className:"bg-purple-600 hover:bg-purple-700 text-white",children:m?"Enrichingâ€¦":"Enrich Now"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border shadow-sm",children:e.jsxs(B,{defaultValue:"overview",className:"w-full",children:[e.jsx("div",{className:"px-4 pt-4 border-b",children:e.jsxs(P,{children:[e.jsx(i,{value:"overview",children:"Overview"}),e.jsx(i,{value:"shipments",children:"Shipments"}),e.jsx(i,{value:"contacts",children:"Contacts"}),e.jsx(i,{value:"ai_insights",children:"AI Insights"}),e.jsx(i,{value:"notes",children:"Notes"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx(c,{value:"overview",children:e.jsx(U,{company:l,shipments:h,isLoading:d})}),e.jsx(c,{value:"shipments",children:e.jsx(G,{shipments:h,isLoading:d})}),e.jsx(c,{value:"contacts",children:e.jsx(V,{contacts:_,companyId:t,company:l,onAddContact:A,isGated:!1,onUnlock:()=>{},isLoading:!1})}),e.jsx(c,{value:"ai_insights",children:e.jsx(z,{company:l||{id:t},onCompanyUpdate:p,user:null,isGated:!1,onUnlock:()=>{},isLoading:!1,onEnrich:f,isEnriching:m})}),e.jsx(c,{value:"notes",children:e.jsx(D,{notes:T,onAddNote:I,isLoading:d})})]})]})})]})}export{me as default};
