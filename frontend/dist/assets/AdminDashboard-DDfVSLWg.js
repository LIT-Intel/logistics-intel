const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entities-CpFcElq0.js","assets/base44Client-C-YMJfZQ.js"])))=>i.map(i=>d[i]);
import{c as Q,j as e,a as le,S as Y,C as H,d as V,e as z,b as $,r as i,z as N,F as ne,B,M as ie,u as ce,_ as M}from"./main-zOeiBHMR.js";import{User as R}from"./entities-CpFcElq0.js";import{c as S}from"./index-DR9D_4bA.js";import{U as oe}from"./users-vq7uMYKo.js";import{C as de}from"./chart-no-axes-column-increasing-mqx5cmVR.js";import{R as me,C as xe,X as he,Y as G,T as ue,B as J}from"./generateCategoricalChart-DKOnDai6.js";import{B as ge}from"./BarChart-CPBgIYpz.js";import{t as K,f as A}from"./format-DIePDvv_.js";import{s as P,P as fe}from"./progress-Bq6mW_k-.js";import{B as D}from"./badge-7bines77.js";import{D as je,e as pe,a as ye,b as Ne,c as be,d as we,f as ve}from"./dialog-CQSza2aC.js";import{L as _e}from"./list-4TOBiEWj.js";import{C as Ce}from"./circle-check-big-CBLv1Kab.js";import{C as De}from"./circle-alert-D9Wloh-s.js";import{I as Ae}from"./input-D-yAU9AO.js";import{S as F,b as L,d as I,e as E,f as g}from"./select-D1C7xFnS.js";import{U as Se}from"./user-Dw-Jlfhq.js";import"./base44Client-C-YMJfZQ.js";import"./isEqual-C-AJPVns.js";import"./index-DDcZ-_1R.js";import"./index-DUu58DBb.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],ke=Q("Percent",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Ue=Q("UserCheck",Re);function q(s,a){const r=K(s),t=K(a);return r.getTime()>t.getTime()}const w=({title:s,value:a,icon:r,change:t})=>e.jsxs(H,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium text-gray-600",children:s}),e.jsx(r,{className:"h-5 w-5 text-purple-500"})]}),e.jsxs($,{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:a}),t&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t})]})]});function Me({data:s}){return e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsx(w,{title:"Total Users",value:s.totalUsers,icon:oe}),e.jsx(w,{title:"Weekly Active Users",value:s.activeUsers,icon:Ue}),e.jsx(w,{title:"Total Companies",value:s.totalCompanies,icon:le}),e.jsx(w,{title:"Total Searches",value:s.totalSearches,icon:Y}),e.jsx(w,{title:"Avg Searches/User",value:s.avgSearchesPerUser,icon:de}),e.jsx(w,{title:"Enrichment Rate",value:`${s.enrichmentRate}%`,icon:ke})]})}function Pe({users:s,searches:a}){const t=(()=>{const d=new Date,x=Array.from({length:30},(h,o)=>{const f=P(d,29-o);return{date:A(f,"MMM dd"),signups:0,searches:0}});return s.forEach(h=>{const o=new Date(h.created_date),f=P(d,30);if(q(o,f)){const n=A(o,"MMM dd"),c=x.find(u=>u.date===n);c&&c.signups++}}),a.forEach(h=>{const o=new Date(h.created_date),f=P(d,30);if(q(o,f)){const n=A(o,"MMM dd"),c=x.find(u=>u.date===n);c&&c.searches++}}),x})();return e.jsxs(H,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx(V,{children:e.jsx(z,{children:"User Activity (Last 30 Days)"})}),e.jsx($,{children:e.jsx("div",{className:"h-[350px]",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(ge,{data:t,children:[e.jsx(xe,{strokeDasharray:"3 3",vertical:!1}),e.jsx(he,{dataKey:"date",tick:{fontSize:12}}),e.jsx(G,{yAxisId:"left",orientation:"left",stroke:"#8884d8",tick:{fontSize:12}}),e.jsx(G,{yAxisId:"right",orientation:"right",stroke:"#82ca9d",tick:{fontSize:12}}),e.jsx(ue,{}),e.jsx(J,{yAxisId:"left",dataKey:"signups",fill:"#8884d8",name:"New Signups"}),e.jsx(J,{yAxisId:"right",dataKey:"searches",fill:"#82ca9d",name:"Searches"})]})})})})]})}const O=i.forwardRef(({className:s,...a},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:N("w-full caption-bottom text-sm",s),...a})}));O.displayName="Table";const W=i.forwardRef(({className:s,...a},r)=>e.jsx("thead",{ref:r,className:N("[&_tr]:border-b",s),...a}));W.displayName="TableHeader";const X=i.forwardRef(({className:s,...a},r)=>e.jsx("tbody",{ref:r,className:N("[&_tr:last-child]:border-0",s),...a}));X.displayName="TableBody";const Fe=i.forwardRef(({className:s,...a},r)=>e.jsx("tfoot",{ref:r,className:N("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));Fe.displayName="TableFooter";const k=i.forwardRef(({className:s,...a},r)=>e.jsx("tr",{ref:r,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));k.displayName="TableRow";const v=i.forwardRef(({className:s,...a},r)=>e.jsx("th",{ref:r,className:N("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));v.displayName="TableHead";const b=i.forwardRef(({className:s,...a},r)=>e.jsx("td",{ref:r,className:N("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));b.displayName="TableCell";const Le=i.forwardRef(({className:s,...a},r)=>e.jsx("caption",{ref:r,className:N("mt-4 text-sm text-muted-foreground",s),...a}));Le.displayName="TableCaption";function Ie({jobs:s}){const a=(t,d)=>{switch(t){case"processing":return e.jsx(D,{className:"bg-yellow-100 text-yellow-800",children:"Processing"});case"completed":return d>0?e.jsx(D,{className:"bg-orange-100 text-orange-800",children:"Completed with Errors"}):e.jsx(D,{className:"bg-green-100 text-green-800",children:"Completed"});case"failed":return e.jsx(D,{className:"bg-red-100 text-red-800",children:"Failed"});default:return e.jsx(D,{variant:"outline",children:t})}},r=(t,d)=>!t||t.length===0?e.jsxs("p",{className:"text-gray-500 text-sm",children:["No ",d," logs for this job."]}):e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:t.map((x,h)=>e.jsx("li",{className:"text-sm",children:x},h))});return e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 overflow-hidden",children:e.jsxs(O,{children:[e.jsx(W,{children:e.jsxs(k,{children:[e.jsx(v,{children:"File Name"}),e.jsx(v,{children:"Date"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-center",children:"Progress"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(X,{children:s&&s.length>0?s.map(t=>e.jsxs(k,{children:[e.jsxs(b,{className:"font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-500"}),t.file_name]}),e.jsx(b,{children:A(new Date(t.created_date),"MMM dd, yyyy HH:mm")}),e.jsx(b,{children:a(t.status,t.error_rows)}),e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(fe,{value:t.total_rows>0?t.processed_rows/t.total_rows*100:0,className:"w-full h-2 mb-1"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.processed_rows||0," / ",t.total_rows||0," rows"]}),e.jsxs("div",{className:"text-xs flex gap-4 mt-1",children:[e.jsxs("span",{className:"text-green-600",children:["âœ“ ",t.success_rows||0]}),e.jsxs("span",{className:"text-red-600",children:["âœ— ",t.error_rows||0]})]})]})}),e.jsx(b,{className:"text-right",children:e.jsxs(je,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(B,{variant:"ghost",size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"View Log"]})}),e.jsxs(ye,{className:"sm:max-w-3xl",children:[e.jsx(Ne,{children:e.jsxs(be,{children:["Import Log: ",t.file_name]})}),e.jsxs("div",{className:"py-4 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-green-600"}),"Success Log"]}),e.jsx("div",{className:"p-3 bg-green-50/50 rounded-lg",children:r(t.success_log,"success")})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-red-600"}),"Error Log"]}),e.jsx("div",{className:"p-3 bg-red-50/50 rounded-lg",children:r(t.error_log,"error")})]})]}),e.jsx(we,{children:e.jsx(ve,{asChild:!0,children:e.jsx(B,{variant:"outline",children:"Close"})})})]})]})})]},t.id)):e.jsx(k,{children:e.jsx(b,{colSpan:"5",className:"h-24 text-center",children:"No import jobs found."})})})]})})})}function Ee({users:s,onUserUpdate:a}){const[r,t]=i.useState(""),[d,x]=i.useState("all"),h=s.filter(n=>{var j,_;const c=!r||((j=n.full_name)==null?void 0:j.toLowerCase().includes(r.toLowerCase()))||((_=n.email)==null?void 0:_.toLowerCase().includes(r.toLowerCase())),u=d==="all"||n.plan===d;return c&&u}),o=async(n,c)=>{try{await R.update(n,{plan:c}),a&&a()}catch(u){console.error("Failed to update user plan:",u)}},f=async(n,c)=>{try{await R.update(n,{role:c}),a&&a()}catch(u){console.error("Failed to update user role:",u)}};return e.jsxs(H,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx(z,{children:"User Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Ae,{placeholder:"Search users...",value:r,onChange:n=>t(n.target.value),className:"pl-10 w-full sm:w-64"})]}),e.jsxs(F,{value:d,onValueChange:x,children:[e.jsx(L,{className:"w-full sm:w-40",children:e.jsx(I,{placeholder:"Filter by plan"})}),e.jsxs(E,{children:[e.jsx(g,{value:"all",children:"All Plans"}),e.jsx(g,{value:"free",children:"Free"}),e.jsx(g,{value:"starter",children:"Starter"}),e.jsx(g,{value:"growth",children:"Growth"}),e.jsx(g,{value:"growth_plus",children:"Growth+"})]})]})]})]})}),e.jsx($,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Plan"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Joined"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:h.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:n.full_name||"No name"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.email})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(F,{value:n.plan||"free",onValueChange:c=>o(n.id,c),children:[e.jsx(L,{className:"w-32",children:e.jsx(I,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"free",children:"Free"}),e.jsx(g,{value:"starter",children:"Starter"}),e.jsx(g,{value:"growth",children:"Growth"}),e.jsx(g,{value:"growth_plus",children:"Growth+"})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(F,{value:n.role||"user",onValueChange:c=>f(n.id,c),children:[e.jsx(L,{className:"w-28",children:e.jsx(I,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"user",children:"User"}),e.jsx(g,{value:"admin",children:"Admin"})]})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:A(new Date(n.created_date),"MMM dd, yyyy")}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(B,{variant:"outline",size:"sm",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Contact"]})})]},n.id))})]}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your criteria."})]})})]})}function T(s){if(Array.isArray(s))return s;if(!s||typeof s!="object")return[];const a=[s.data,s.items,s.list,s.results,s.records];for(const r of a)if(Array.isArray(r))return r;return[]}function ns(){const s=ce(),[a,r]=i.useState(null),[t,d]=i.useState([]),[x,h]=i.useState([]),[o,f]=i.useState([]),[n,c]=i.useState([]),[u,j]=i.useState(!0),[_,C]=i.useState(null),U=i.useCallback(async()=>{j(!0),C(null);try{console.log("ðŸ” AdminDashboard: Loading user data...");const l=await R.me();if(console.log("ðŸ” AdminDashboard: User data loaded:",{email:l==null?void 0:l.email,role:l==null?void 0:l.role,full_name:l==null?void 0:l.full_name}),r(l||null),!l){console.log("âŒ AdminDashboard: No user data found, redirecting..."),C("No user authentication found"),j(!1),setTimeout(()=>s(S("Dashboard")),2e3);return}if(l.role!=="admin"){console.log(`âŒ AdminDashboard: User role '${l.role}' is not admin, redirecting...`),C(`Access denied. Your role is '${l.role}' but admin access is required.`),j(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}console.log("âœ… AdminDashboard: Admin access confirmed, loading data...");try{const{Company:y}=await M(async()=>{const{Company:m}=await import("./entities-CpFcElq0.js");return{Company:m}},__vite__mapDeps([0,1])),{SearchQuery:p}=await M(async()=>{const{SearchQuery:m}=await import("./entities-CpFcElq0.js");return{SearchQuery:m}},__vite__mapDeps([0,1])),{ImportJob:ee}=await M(async()=>{const{ImportJob:m}=await import("./entities-CpFcElq0.js");return{ImportJob:m}},__vite__mapDeps([0,1])),[se,ae,te,re]=await Promise.all([R.list("-created_date").catch(m=>(console.warn("Failed to load users:",m),[])),y.list("-created_date").catch(m=>(console.warn("Failed to load companies:",m),[])),p.list("-created_date",1e3).catch(m=>(console.warn("Failed to load search queries:",m),[])),ee.list("-created_date",50).catch(m=>(console.warn("Failed to load import jobs:",m),[]))]);d(T(se)),h(T(ae)),f(T(te)),c(T(re)),console.log("âœ… AdminDashboard: All data loaded successfully")}catch(y){console.error("âŒ AdminDashboard: Error loading entities:",y),C(`Failed to load admin data: ${y.message}`),j(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}}catch(l){console.error("âŒ AdminDashboard: Error loading data:",l),C(`Failed to load admin data: ${l.message}`),j(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}j(!1)},[s]);i.useEffect(()=>{U()},[U]);const Z={totalUsers:t.length,activeUsers:t.filter(l=>{const y=new Date;return y.setDate(y.getDate()-7),o.some(p=>(p==null?void 0:p.user_email)===(l==null?void 0:l.email)&&(p==null?void 0:p.created_date)&&new Date(p.created_date)>=y)}).length,totalCompanies:x.length,totalSearches:o.length,avgSearchesPerUser:t.length>0?Math.round(o.length/t.length):0,enrichmentRate:x.length>0?Math.round(x.filter(l=>(l==null?void 0:l.enrichment_status)==="enriched").length/x.length*100):0};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading admin dashboard..."})]})}):_?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h1",{className:"text-xl font-bold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-600 mb-4",children:_}),e.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting to dashboard..."})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded border text-sm text-left",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current User:"})," ",a.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",a.role||"undefined"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a.full_name||"undefined"]})]})]})}):!a||a.role!=="admin"?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current role: ",(a==null?void 0:a.role)||"undefined"]})]})}):e.jsx("div",{className:"p-6 md:p-8 bg-gradient-to-br from-purple-50 to-pink-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Platform analytics and user management"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Logged in as: ",a.email," (Role: ",a.role,")"]})]})}),e.jsx(Me,{data:Z}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mt-8",children:[e.jsx(Pe,{users:t,searches:o}),e.jsx(Ie,{jobs:n})]}),e.jsx("div",{className:"mt-8",children:e.jsx(Ee,{users:t,onUserUpdate:U})})]})})}export{ns as default};
