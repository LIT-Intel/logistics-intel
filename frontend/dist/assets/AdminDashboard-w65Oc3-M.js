const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entities-CpFcElq0.js","assets/base44Client-C-YMJfZQ.js"])))=>i.map(i=>d[i]);
import{c as Q,j as e,a as ne,S as Y,C as z,d as $,e as G,b as J,r as i,z as N,F as ie,B,M as oe,u as ce,_ as M}from"./main-IxhAqWnM.js";import{User as R}from"./entities-CpFcElq0.js";import{c as T}from"./index-DR9D_4bA.js";import{U as de}from"./users-5U1ChCri.js";import{C as me}from"./chart-no-axes-column-increasing-CSLqmCN2.js";import{k as xe,B as H,X as O,Y as V,l as he,R as ue,m as ge,T as pe,s as P,P as fe}from"./generateCategoricalChart-DjbAOyw-.js";import{t as K,f as D}from"./format-DIePDvv_.js";import{B as A}from"./badge-D41q74r8.js";import{D as je,e as ye,a as Ne,b as be,c as we,d as ve,f as Ce}from"./dialog-B3UsghHz.js";import{L as _e}from"./list-CpxwSvg8.js";import{C as Ae}from"./circle-check-big-mGm0XhBa.js";import{C as De}from"./circle-alert-0FMvKNC3.js";import{I as Te}from"./input-CR9alITy.js";import{S as E,b as F,d as L,e as I,f as g}from"./select-C2Q5sDzH.js";import{U as Se}from"./user-BkWuj_Qj.js";import"./base44Client-C-YMJfZQ.js";import"./index-BnZqDeLj.js";import"./isEqual-xcjeVMI-.js";import"./index-CQOb7H-X.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Re=Q("Percent",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Me=Q("UserCheck",Ue);function q(s,a){const r=K(s),t=K(a);return r.getTime()>t.getTime()}var Pe=xe({chartName:"BarChart",GraphicalChild:H,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:O},{axisType:"yAxis",AxisComp:V}],formatAxisMap:he});const w=({title:s,value:a,icon:r,change:t})=>e.jsxs(z,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-gray-600",children:s}),e.jsx(r,{className:"h-5 w-5 text-purple-500"})]}),e.jsxs(J,{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:a}),t&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t})]})]});function Ee({data:s}){return e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsx(w,{title:"Total Users",value:s.totalUsers,icon:de}),e.jsx(w,{title:"Weekly Active Users",value:s.activeUsers,icon:Me}),e.jsx(w,{title:"Total Companies",value:s.totalCompanies,icon:ne}),e.jsx(w,{title:"Total Searches",value:s.totalSearches,icon:Y}),e.jsx(w,{title:"Avg Searches/User",value:s.avgSearchesPerUser,icon:me}),e.jsx(w,{title:"Enrichment Rate",value:`${s.enrichmentRate}%`,icon:Re})]})}function Fe({users:s,searches:a}){const t=(()=>{const d=new Date,x=Array.from({length:30},(h,c)=>{const p=P(d,29-c);return{date:D(p,"MMM dd"),signups:0,searches:0}});return s.forEach(h=>{const c=new Date(h.created_date),p=P(d,30);if(q(c,p)){const n=D(c,"MMM dd"),o=x.find(u=>u.date===n);o&&o.signups++}}),a.forEach(h=>{const c=new Date(h.created_date),p=P(d,30);if(q(c,p)){const n=D(c,"MMM dd"),o=x.find(u=>u.date===n);o&&o.searches++}}),x})();return e.jsxs(z,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx($,{children:e.jsx(G,{children:"User Activity (Last 30 Days)"})}),e.jsx(J,{children:e.jsx("div",{className:"h-[350px]",children:e.jsx(ue,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:t,children:[e.jsx(ge,{strokeDasharray:"3 3",vertical:!1}),e.jsx(O,{dataKey:"date",tick:{fontSize:12}}),e.jsx(V,{yAxisId:"left",orientation:"left",stroke:"#8884d8",tick:{fontSize:12}}),e.jsx(V,{yAxisId:"right",orientation:"right",stroke:"#82ca9d",tick:{fontSize:12}}),e.jsx(pe,{}),e.jsx(H,{yAxisId:"left",dataKey:"signups",fill:"#8884d8",name:"New Signups"}),e.jsx(H,{yAxisId:"right",dataKey:"searches",fill:"#82ca9d",name:"Searches"})]})})})})]})}const W=i.forwardRef(({className:s,...a},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:N("w-full caption-bottom text-sm",s),...a})}));W.displayName="Table";const X=i.forwardRef(({className:s,...a},r)=>e.jsx("thead",{ref:r,className:N("[&_tr]:border-b",s),...a}));X.displayName="TableHeader";const Z=i.forwardRef(({className:s,...a},r)=>e.jsx("tbody",{ref:r,className:N("[&_tr:last-child]:border-0",s),...a}));Z.displayName="TableBody";const Le=i.forwardRef(({className:s,...a},r)=>e.jsx("tfoot",{ref:r,className:N("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));Le.displayName="TableFooter";const k=i.forwardRef(({className:s,...a},r)=>e.jsx("tr",{ref:r,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));k.displayName="TableRow";const v=i.forwardRef(({className:s,...a},r)=>e.jsx("th",{ref:r,className:N("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));v.displayName="TableHead";const b=i.forwardRef(({className:s,...a},r)=>e.jsx("td",{ref:r,className:N("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));b.displayName="TableCell";const Ie=i.forwardRef(({className:s,...a},r)=>e.jsx("caption",{ref:r,className:N("mt-4 text-sm text-muted-foreground",s),...a}));Ie.displayName="TableCaption";function Be({jobs:s}){const a=(t,d)=>{switch(t){case"processing":return e.jsx(A,{className:"bg-yellow-100 text-yellow-800",children:"Processing"});case"completed":return d>0?e.jsx(A,{className:"bg-orange-100 text-orange-800",children:"Completed with Errors"}):e.jsx(A,{className:"bg-green-100 text-green-800",children:"Completed"});case"failed":return e.jsx(A,{className:"bg-red-100 text-red-800",children:"Failed"});default:return e.jsx(A,{variant:"outline",children:t})}},r=(t,d)=>!t||t.length===0?e.jsxs("p",{className:"text-gray-500 text-sm",children:["No ",d," logs for this job."]}):e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:t.map((x,h)=>e.jsx("li",{className:"text-sm",children:x},h))});return e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 overflow-hidden",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(k,{children:[e.jsx(v,{children:"File Name"}),e.jsx(v,{children:"Date"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-center",children:"Progress"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(Z,{children:s&&s.length>0?s.map(t=>e.jsxs(k,{children:[e.jsxs(b,{className:"font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),t.file_name]}),e.jsx(b,{children:D(new Date(t.created_date),"MMM dd, yyyy HH:mm")}),e.jsx(b,{children:a(t.status,t.error_rows)}),e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(fe,{value:t.total_rows>0?t.processed_rows/t.total_rows*100:0,className:"w-full h-2 mb-1"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.processed_rows||0," / ",t.total_rows||0," rows"]}),e.jsxs("div",{className:"text-xs flex gap-4 mt-1",children:[e.jsxs("span",{className:"text-green-600",children:["âœ“ ",t.success_rows||0]}),e.jsxs("span",{className:"text-red-600",children:["âœ— ",t.error_rows||0]})]})]})}),e.jsx(b,{className:"text-right",children:e.jsxs(je,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(B,{variant:"ghost",size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"View Log"]})}),e.jsxs(Ne,{className:"sm:max-w-3xl",children:[e.jsx(be,{children:e.jsxs(we,{children:["Import Log: ",t.file_name]})}),e.jsxs("div",{className:"py-4 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-green-600"}),"Success Log"]}),e.jsx("div",{className:"p-3 bg-green-50/50 rounded-lg",children:r(t.success_log,"success")})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-red-600"}),"Error Log"]}),e.jsx("div",{className:"p-3 bg-red-50/50 rounded-lg",children:r(t.error_log,"error")})]})]}),e.jsx(ve,{children:e.jsx(Ce,{asChild:!0,children:e.jsx(B,{variant:"outline",children:"Close"})})})]})]})})]},t.id)):e.jsx(k,{children:e.jsx(b,{colSpan:"5",className:"h-24 text-center",children:"No import jobs found."})})})]})})})}function He({users:s,onUserUpdate:a}){const[r,t]=i.useState(""),[d,x]=i.useState("all"),h=s.filter(n=>{var f,C;const o=!r||((f=n.full_name)==null?void 0:f.toLowerCase().includes(r.toLowerCase()))||((C=n.email)==null?void 0:C.toLowerCase().includes(r.toLowerCase())),u=d==="all"||n.plan===d;return o&&u}),c=async(n,o)=>{try{await R.update(n,{plan:o}),a&&a()}catch(u){console.error("Failed to update user plan:",u)}},p=async(n,o)=>{try{await R.update(n,{role:o}),a&&a()}catch(u){console.error("Failed to update user role:",u)}};return e.jsxs(z,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx($,{children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx(G,{children:"User Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Te,{placeholder:"Search users...",value:r,onChange:n=>t(n.target.value),className:"pl-10 w-full sm:w-64"})]}),e.jsxs(E,{value:d,onValueChange:x,children:[e.jsx(F,{className:"w-full sm:w-40",children:e.jsx(L,{placeholder:"Filter by plan"})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"All Plans"}),e.jsx(g,{value:"free",children:"Free"}),e.jsx(g,{value:"starter",children:"Starter"}),e.jsx(g,{value:"growth",children:"Growth"}),e.jsx(g,{value:"growth_plus",children:"Growth+"})]})]})]})]})}),e.jsx(J,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Plan"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Joined"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:h.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:n.full_name||"No name"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.email})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(E,{value:n.plan||"free",onValueChange:o=>c(n.id,o),children:[e.jsx(F,{className:"w-32",children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(g,{value:"free",children:"Free"}),e.jsx(g,{value:"starter",children:"Starter"}),e.jsx(g,{value:"growth",children:"Growth"}),e.jsx(g,{value:"growth_plus",children:"Growth+"})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(E,{value:n.role||"user",onValueChange:o=>p(n.id,o),children:[e.jsx(F,{className:"w-28",children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(g,{value:"user",children:"User"}),e.jsx(g,{value:"admin",children:"Admin"})]})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:D(new Date(n.created_date),"MMM dd, yyyy")}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(B,{variant:"outline",size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Contact"]})})]},n.id))})]}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your criteria."})]})})]})}function S(s){if(Array.isArray(s))return s;if(!s||typeof s!="object")return[];const a=[s.data,s.items,s.list,s.results,s.records];for(const r of a)if(Array.isArray(r))return r;return[]}function ns(){const s=ce(),[a,r]=i.useState(null),[t,d]=i.useState([]),[x,h]=i.useState([]),[c,p]=i.useState([]),[n,o]=i.useState([]),[u,f]=i.useState(!0),[C,_]=i.useState(null),U=i.useCallback(async()=>{f(!0),_(null);try{console.log("ðŸ” AdminDashboard: Loading user data...");const l=await R.me();if(console.log("ðŸ” AdminDashboard: User data loaded:",{email:l==null?void 0:l.email,role:l==null?void 0:l.role,full_name:l==null?void 0:l.full_name}),r(l||null),!l){console.log("âŒ AdminDashboard: No user data found, redirecting..."),_("No user authentication found"),f(!1),setTimeout(()=>s(T("Dashboard")),2e3);return}if(l.role!=="admin"){console.log(`âŒ AdminDashboard: User role '${l.role}' is not admin, redirecting...`),_(`Access denied. Your role is '${l.role}' but admin access is required.`),f(!1),setTimeout(()=>s(T("Dashboard")),3e3);return}console.log("âœ… AdminDashboard: Admin access confirmed, loading data...");try{const{Company:y}=await M(async()=>{const{Company:m}=await import("./entities-CpFcElq0.js");return{Company:m}},__vite__mapDeps([0,1])),{SearchQuery:j}=await M(async()=>{const{SearchQuery:m}=await import("./entities-CpFcElq0.js");return{SearchQuery:m}},__vite__mapDeps([0,1])),{ImportJob:se}=await M(async()=>{const{ImportJob:m}=await import("./entities-CpFcElq0.js");return{ImportJob:m}},__vite__mapDeps([0,1])),[ae,te,re,le]=await Promise.all([R.list("-created_date").catch(m=>(console.warn("Failed to load users:",m),[])),y.list("-created_date").catch(m=>(console.warn("Failed to load companies:",m),[])),j.list("-created_date",1e3).catch(m=>(console.warn("Failed to load search queries:",m),[])),se.list("-created_date",50).catch(m=>(console.warn("Failed to load import jobs:",m),[]))]);d(S(ae)),h(S(te)),p(S(re)),o(S(le)),console.log("âœ… AdminDashboard: All data loaded successfully")}catch(y){console.error("âŒ AdminDashboard: Error loading entities:",y),_(`Failed to load admin data: ${y.message}`),f(!1),setTimeout(()=>s(T("Dashboard")),3e3);return}}catch(l){console.error("âŒ AdminDashboard: Error loading data:",l),_(`Failed to load admin data: ${l.message}`),f(!1),setTimeout(()=>s(T("Dashboard")),3e3);return}f(!1)},[s]);i.useEffect(()=>{U()},[U]);const ee={totalUsers:t.length,activeUsers:t.filter(l=>{const y=new Date;return y.setDate(y.getDate()-7),c.some(j=>(j==null?void 0:j.user_email)===(l==null?void 0:l.email)&&(j==null?void 0:j.created_date)&&new Date(j.created_date)>=y)}).length,totalCompanies:x.length,totalSearches:c.length,avgSearchesPerUser:t.length>0?Math.round(c.length/t.length):0,enrichmentRate:x.length>0?Math.round(x.filter(l=>(l==null?void 0:l.enrichment_status)==="enriched").length/x.length*100):0};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading admin dashboard..."})]})}):C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h1",{className:"text-xl font-bold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-600 mb-4",children:C}),e.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting to dashboard..."})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded border text-sm text-left",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current User:"})," ",a.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",a.role||"undefined"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a.full_name||"undefined"]})]})]})}):!a||a.role!=="admin"?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current role: ",(a==null?void 0:a.role)||"undefined"]})]})}):e.jsx("div",{className:"p-6 md:p-8 bg-gradient-to-br from-purple-50 to-pink-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Platform analytics and user management"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Logged in as: ",a.email," (Role: ",a.role,")"]})]})}),e.jsx(Ee,{data:ee}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mt-8",children:[e.jsx(Fe,{users:t,searches:c}),e.jsx(Be,{jobs:n})]}),e.jsx("div",{className:"mt-8",children:e.jsx(He,{users:t,onUserUpdate:U})})]})})}export{ns as default};
