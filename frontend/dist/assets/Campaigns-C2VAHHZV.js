import{c as U,j as e,C,d as M,e as D,R as te,b as k,B as g,M as z,r as i,S as ae,F as le,D as ne,A as re,E as ie}from"./main-D9DXAbCC.js";import{B}from"./badge-Cd16Jk0o.js";import{P as L,s as ce}from"./progress-DmXARtSj.js";import{P as $}from"./pen-line-nu38HMVw.js";import{T as Y}from"./trash-2-Bx19LHVm.js";import{U as J}from"./users-C_C_FvVa.js";import{C as de}from"./calendar-Db9N5JPE.js";import{T as Z}from"./target-BoQxW1eb.js";import{f as F}from"./format-DIePDvv_.js";import{I as q}from"./input-BsJUwWpA.js";import{T as K}from"./textarea-BB5ygcid.js";import{S as W,b as H,d as Q,e as V,f as _}from"./select-CqIuqxEs.js";import{CampaignTemplate as oe,User as me,EmailInteraction as xe}from"./entities-CpFcElq0.js";import{A as he}from"./arrow-right-dAAhsVOu.js";import{a as R}from"./api-CSGOmWCZ.js";import{P as O}from"./plus-C23sFSLt.js";import{M as ee}from"./message-square-DH3IP1uj.js";import{D as ue,a as je,b as pe,c as ge}from"./dialog-C7Iz2UWn.js";import{R as fe,C as ye,X as be,Y as Ne,T as ve}from"./generateCategoricalChart-0gPOQDh1.js";import{L as we,a as P}from"./LineChart-CXLNonsN.js";import{A as _e,a as Ce,b as ke}from"./alert-LA-IQ6hq.js";import{T as Se}from"./triangle-alert-CEyT68Ds.js";import"./index-DgsJrVff.js";import"./base44Client-C-YMJfZQ.js";import"./index-D1arpfRs.js";import"./isEqual-6ee1GzS1.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],Ae=U("MousePointer",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],G=U("Pause",Me);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],X=U("Play",De);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Re=U("UserPlus",Le);function Ee({campaign:s,onToggle:f,onEdit:n,onDelete:v,onClick:x}){var p;const l=d=>{const j={active:"bg-green-100 text-green-800",paused:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800"};return j[d]||j.draft},r=d=>{const y={active:X,paused:G,completed:Z,draft:$}[d]||$;return e.jsx(y,{className:"w-4 h-4"})},N=s.sent_count>0?Math.round((s.open_rate||0)*100):0;return s.sent_count>0&&Math.round((s.reply_count||0)/s.sent_count*100),e.jsxs(C,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none hover:shadow-xl transition-all duration-300 cursor-pointer",children:[e.jsxs(M,{className:"pb-3",onClick:()=>x&&x(s),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(D,{className:"text-lg line-clamp-2",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(B,{className:l(s.status),children:[te.createElement(r(s.status),{className:"w-3 h-3 mr-1"}),s.status]}),e.jsx(B,{variant:"outline",className:"text-xs",children:(p=s.campaign_type)==null?void 0:p.replace("_"," ")})]})]})}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:(()=>{const d=s.created_at||s.created_date||s.createdOn||Date.now();try{return`Created ${F(new Date(d),"MMM dd, yyyy")}`}catch{return""}})()})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.sent_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:[N,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Open Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.reply_count||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Replies"})]})]}),s.status==="active"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.sent_count||0," / ",(s.target_contacts||[]).length]})]}),e.jsx(L,{value:(s.target_contacts||[]).length>0?(s.sent_count||0)/(s.target_contacts||[]).length*100:0,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:d=>{d.stopPropagation(),f(s.id,s.status)},disabled:s.status==="completed",className:"h-8",children:[s.status==="active"?e.jsx(G,{className:"w-3 h-3 mr-1"}):e.jsx(X,{className:"w-3 h-3 mr-1"}),s.status==="active"?"Pause":"Start"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:d=>{d.stopPropagation(),n(s)},className:"h-8",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),"Edit"]})]}),e.jsx(g,{size:"sm",variant:"outline",onClick:d=>{d.stopPropagation(),v(s.id)},className:"h-8 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Y,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),(s.target_contacts||[]).length," contacts"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),(s.sequence_steps||[]).length," steps"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),s.status==="active"?"Running":"Paused"]})]})]})]})}function Pe({onSelectTemplate:s,onClose:f}){const[n,v]=i.useState([]),[x,l]=i.useState([]),[r,N]=i.useState(""),[p,d]=i.useState("all"),[j,y]=i.useState(!0),w=[{value:"all",label:"All Templates"},{value:"prospecting",label:"Prospecting"},{value:"nurturing",label:"Nurturing"},{value:"demo",label:"Demo & Discovery"},{value:"closing",label:"Closing"},{value:"followup",label:"Follow-up"}],S=async()=>{try{const t=await oe.filter({is_active:!0},"name"),a=Array.isArray(t)?t:t!=null&&t.data&&Array.isArray(t.data)?t.data:[];v(a)}catch(t){console.error("Error loading templates:",t),v([])}y(!1)},b=i.useCallback(()=>{let t=n;r&&(t=t.filter(a=>a.name.toLowerCase().includes(r.toLowerCase())||a.objective.toLowerCase().includes(r.toLowerCase())||a.audience.toLowerCase().includes(r.toLowerCase()))),p!=="all"&&(t=t.filter(a=>a.category===p)),l(t)},[n,r,p]);i.useEffect(()=>{S()},[]),i.useEffect(()=>{b()},[b]);const T=t=>({prospecting:"bg-blue-100 text-blue-800",nurturing:"bg-green-100 text-green-800",demo:"bg-purple-100 text-purple-800",closing:"bg-orange-100 text-orange-800",followup:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800",h=t=>{switch(t){case"email":return"ðŸ“§";case"linkedin_connect":return"ðŸ”—";case"linkedin_message":return"ðŸ’¼";default:return"ðŸ“„"}};return j?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-center",children:"Loading templates..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Choose Campaign Template"}),e.jsx(g,{variant:"outline",onClick:f,children:"Close"})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{placeholder:"Search templates...",value:r,onChange:t=>N(t.target.value),className:"pl-10"}),e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]}),e.jsx("div",{className:"flex gap-2",children:w.map(t=>e.jsx(g,{variant:p===t.value?"default":"outline",size:"sm",onClick:()=>d(t.value),children:t.label},t.value))})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No templates found matching your criteria."}),e.jsx(g,{variant:"outline",onClick:()=>{N(""),d("all")},children:"Clear Filters"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(t=>e.jsxs(C,{className:"hover:shadow-lg transition-shadow cursor-pointer border-2 hover:border-blue-300",onClick:()=>s(t),children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(D,{className:"text-lg mb-2",children:t.name}),e.jsx(B,{className:T(t.category),children:t.category})]}),e.jsx(he,{className:"w-5 h-5 text-gray-400"})]})}),e.jsxs(k,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.objective}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:t.audience}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["Sequence (",t.steps.length," steps):"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.steps.slice(0,4).map((a,c)=>e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",title:a.subject||a.message,children:[h(a.type)," Day ",a.day_offset]},c)),t.steps.length>4&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.steps.length-4," more"]})]})]})]})]},t.id))})})]})})}function Ie({campaign:s,onClose:f,onSave:n}){const[v,x]=i.useState(!1),[l,r]=i.useState({name:"",campaign_type:"email_only",status:"draft",email_template:"",linkedin_template:"",subject_line:"",target_companies:[],target_contacts:[],sequence_steps:[]}),[N,p]=i.useState([]),[d,j]=i.useState(!1);i.useEffect(()=>{s&&r({name:s.name||"",campaign_type:s.campaign_type||"email_only",status:s.status||"draft",email_template:s.email_template||"",linkedin_template:s.linkedin_template||"",subject_line:s.subject_line||"",target_companies:s.target_companies||[],target_contacts:s.target_contacts||[],sequence_steps:s.sequence_steps||[]})},[s]),i.useEffect(()=>{(async()=>{j(!0);try{const a=await R.get("/crm/leads?limit=100"),c=Array.isArray(a==null?void 0:a.rows)?a.rows:Array.isArray(a)?a:[];p(c.map(u=>({email:u.email,full_name:u.contact_name})))}catch(a){console.error("Failed to load available contacts:",a)}finally{j(!1)}})()},[]);const y=async t=>{t.preventDefault();try{const a=await me.me().catch(()=>null),c={name:l.name,type:l.campaign_type,status:l.status,steps:(l.sequence_steps||[]).map(u=>({type:u.type,wait_days:u.wait_days,subject:u.subject,template:u.template})),audience:{emails:l.target_contacts,companies:l.target_companies},subject_line:l.subject_line,email_template:l.email_template,linkedin_template:l.linkedin_template,created_by:(a==null?void 0:a.email)||void 0};await R.post("/crm/campaigns",c),n&&n(c),f&&f()}catch(a){console.error("Error saving campaign:",a),alert("Failed to save campaign. Please try again.")}},w=t=>{r(a=>{var c,u,E;return{...a,name:t.name,email_template:((c=t.steps.find(o=>o.type==="email"))==null?void 0:c.body)||"",subject_line:((u=t.steps.find(o=>o.type==="email"))==null?void 0:u.subject)||"",linkedin_template:((E=t.steps.find(o=>o.type==="linkedin_message"))==null?void 0:E.message)||"",sequence_steps:t.steps.map((o,m)=>({step_number:m+1,type:o.type,wait_days:o.day_offset,template:o.body||o.message||"",subject:o.subject||""}))}}),x(!1)},S=()=>{const t={step_number:l.sequence_steps.length+1,type:"email",wait_days:l.sequence_steps.length===0?0:3,template:"",subject:""};r({...l,sequence_steps:[...l.sequence_steps,t]})},b=(t,a,c)=>{const u=[...l.sequence_steps];u[t][a]=c,r({...l,sequence_steps:u})},T=t=>{const a=l.sequence_steps.filter((c,u)=>u!==t);a.forEach((c,u)=>{c.step_number=u+1}),r({...l,sequence_steps:a})},h=t=>{switch(t){case"email":return e.jsx(z,{className:"w-4 h-4"});case"linkedin":return e.jsx(Re,{className:"w-4 h-4"});case"linkedin_message":return e.jsx(ee,{className:"w-4 h-4"});default:return e.jsx(z,{className:"w-4 h-4"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s?"Edit Campaign":"Create New Campaign"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>x(!0),children:"Use Template"}),e.jsx(g,{variant:"outline",onClick:f,children:"Close"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Name"}),e.jsx(q,{required:!0,value:l.name,onChange:t=>r({...l,name:t.target.value}),placeholder:"e.g., Q1 Manufacturing Outreach"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Campaign Type"}),e.jsxs(W,{value:l.campaign_type,onValueChange:t=>r({...l,campaign_type:t}),children:[e.jsx(H,{children:e.jsx(Q,{})}),e.jsxs(V,{children:[e.jsx(_,{value:"email_only",children:"Email Only"}),e.jsx(_,{value:"linkedin_only",children:"LinkedIn Only"}),e.jsx(_,{value:"email_linkedin_sequence",children:"Email + LinkedIn"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs(W,{value:l.status,onValueChange:t=>r({...l,status:t}),children:[e.jsx(H,{children:e.jsx(Q,{})}),e.jsxs(V,{children:[e.jsx(_,{value:"draft",children:"Draft"}),e.jsx(_,{value:"active",children:"Active"}),e.jsx(_,{value:"paused",children:"Paused"}),e.jsx(_,{value:"completed",children:"Completed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Companies (comma-separated)"}),e.jsx(K,{value:l.target_companies.join(", "),onChange:t=>r({...l,target_companies:t.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),placeholder:"e.g., Google, Microsoft, Apple",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Contacts (email addresses, comma-separated)"}),e.jsx(K,{value:l.target_contacts.join(", "),onChange:t=>r({...l,target_contacts:t.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),placeholder:"e.g., john.doe@example.com, jane.smith@example.com",rows:3}),d?e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Loading available contacts..."}):N.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Available: ",N.map(t=>t.email).join(", ").substring(0,100),N.length>5?"...":""]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Campaign Sequence"}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),l.sequence_steps.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-3",children:"No sequence steps yet"}),e.jsxs(g,{type:"button",variant:"outline",onClick:()=>x(!0),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Use Template"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"or"}),e.jsxs(g,{type:"button",variant:"outline",onClick:S,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Create Step"]})]}):e.jsx("div",{className:"space-y-3",children:l.sequence_steps.map((t,a)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:t.step_number}),e.jsxs("span",{className:"font-medium",children:["Step ",t.step_number]}),h(t.type)]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(a),children:e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Type"}),e.jsxs(W,{value:t.type,onValueChange:c=>b(a,"type",c),children:[e.jsx(H,{children:e.jsx(Q,{})}),e.jsxs(V,{children:[e.jsx(_,{value:"email",children:"Email"}),e.jsx(_,{value:"linkedin",children:"LinkedIn Connect"}),e.jsx(_,{value:"linkedin_message",children:"LinkedIn Message"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Wait Days"}),e.jsx(q,{type:"number",min:"0",value:t.wait_days,onChange:c=>b(a,"wait_days",parseInt(c.target.value)||0)})]}),t.type==="email"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Subject"}),e.jsx(q,{value:t.subject||"",onChange:c=>b(a,"subject",c.target.value),placeholder:"Email subject..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:t.type==="email"?"Email Content":"LinkedIn Message"}),e.jsx(K,{value:t.template,onChange:c=>b(a,"template",c.target.value),placeholder:t.type==="email"?"Email body...":"LinkedIn message...",rows:4})]})]},a))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(g,{type:"button",variant:"outline",onClick:f,children:"Cancel"}),e.jsx(g,{type:"submit",children:s?"Update Campaign":"Create Campaign"})]})]})})]})}),v&&e.jsx(Pe,{onSelectTemplate:w,onClose:()=>x(!1)})]})}function Fe({campaign:s,onClose:f}){var T;const[n,v]=i.useState({totalSent:(s==null?void 0:s.sent_count)||0,opens:Math.round(((s==null?void 0:s.sent_count)||0)*.35),clicks:Math.round(((s==null?void 0:s.sent_count)||0)*.12),replies:(s==null?void 0:s.reply_count)||0,unsubscribes:Math.round(((s==null?void 0:s.sent_count)||0)*.02),bounces:Math.round(((s==null?void 0:s.sent_count)||0)*.03)}),[x,l]=i.useState([]),[r,N]=i.useState(!0),p=i.useCallback(async()=>{if(s){N(!0);try{const h=await xe.filter({campaign_id:s.id},"-created_date"),t={totalSent:h.filter(a=>a.direction==="sent").length,opens:h.filter(a=>a.opened_at).length,clicks:h.filter(a=>a.clicked_at).length,replies:h.filter(a=>a.replied_at).length,unsubscribes:Math.round(h.length*.015),bounces:h.filter(a=>a.status==="bounced").length};v(t.totalSent>0?t:n)}catch(h){console.error("Failed to load campaign analytics:",h)}N(!1)}},[s,n]),d=i.useCallback(()=>{const h=[];for(let t=6;t>=0;t--){const a=ce(new Date,t);h.push({date:F(a,"MMM dd"),sent:Math.floor(Math.random()*50)+10,opens:Math.floor(Math.random()*30)+5,clicks:Math.floor(Math.random()*15)+2,replies:Math.floor(Math.random()*8)+1})}l(h)},[]);i.useEffect(()=>{p(),d()},[p,d]);const j=(h,t)=>t===0?0:Math.round(h/t*100),y=j(n.opens,n.totalSent),w=j(n.clicks,n.totalSent),S=j(n.replies,n.totalSent),b=j(n.bounces,n.totalSent);return s?e.jsx(ue,{open:!0,onOpenChange:f,children:e.jsxs(je,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[e.jsx(pe,{className:"p-6 border-b",children:e.jsxs(ge,{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600"}),"Campaign Analytics: ",s.name]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6 space-y-6",children:r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(C,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Emails Sent"]})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:n.totalSent.toLocaleString()})})]}),e.jsxs(C,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Open Rate"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[y,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.opens," opens"]})]})]}),e.jsxs(C,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Click Rate"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[w,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.clicks," clicks"]})]})]}),e.jsxs(C,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Reply Rate"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[S,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.replies," replies"]})]})]})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsx(D,{children:"Performance Breakdown"})}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),"Open Rate"]}),e.jsxs("span",{className:"font-medium",children:[y,"% (",n.opens," of ",n.totalSent,")"]})]}),e.jsx(L,{value:y,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),"Click Rate"]}),e.jsxs("span",{className:"font-medium",children:[w,"% (",n.clicks," of ",n.totalSent,")"]})]}),e.jsx(L,{value:w,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),"Reply Rate"]}),e.jsxs("span",{className:"font-medium",children:[S,"% (",n.replies," of ",n.totalSent,")"]})]}),e.jsx(L,{value:S,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),"Bounce Rate"]}),e.jsxs("span",{className:"font-medium",children:[b,"% (",n.bounces," of ",n.totalSent,")"]})]}),e.jsx(L,{value:b,className:"h-2"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Industry Benchmarks"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Open Rate"}),e.jsx("div",{className:"text-blue-800",children:"25-35%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Click Rate"}),e.jsx("div",{className:"text-blue-800",children:"8-15%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Reply Rate"}),e.jsx("div",{className:"text-blue-800",children:"5-12%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Bounce Rate"}),e.jsx("div",{className:"text-blue-800",children:"<2%"})]})]})]})]})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsx(D,{children:"Campaign Activity (Last 7 Days)"})}),e.jsx(k,{children:e.jsx("div",{className:"h-64",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(we,{data:x,children:[e.jsx(ye,{strokeDasharray:"3 3",strokeOpacity:.3}),e.jsx(be,{dataKey:"date",tick:{fontSize:12}}),e.jsx(Ne,{tick:{fontSize:12}}),e.jsx(ve,{contentStyle:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px"}}),e.jsx(P,{type:"monotone",dataKey:"sent",stroke:"#3b82f6",strokeWidth:2,name:"Sent"}),e.jsx(P,{type:"monotone",dataKey:"opens",stroke:"#10b981",strokeWidth:2,name:"Opens"}),e.jsx(P,{type:"monotone",dataKey:"clicks",stroke:"#8b5cf6",strokeWidth:2,name:"Clicks"}),e.jsx(P,{type:"monotone",dataKey:"replies",stroke:"#f59e0b",strokeWidth:2,name:"Replies"})]})})})})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsx(D,{children:"Campaign Details"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx(B,{className:s.status==="active"?"bg-green-100 text-green-800":s.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:s.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Campaign Type:"}),e.jsx("span",{className:"font-medium",children:(T=s.campaign_type)==null?void 0:T.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Target Contacts:"}),e.jsx("span",{className:"font-medium",children:(s.target_contacts||[]).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sequence Steps:"}),e.jsx("span",{className:"font-medium",children:(s.sequence_steps||[]).length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"font-medium",children:F(new Date(s.created_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Activity:"}),e.jsx("span",{className:"font-medium",children:F(new Date,"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Completion:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(n.totalSent/Math.max((s.target_contacts||[]).length,1)*100),"%"]})]})]})]})})]})]})})]})}):null}const I=s=>s?Array.isArray(s)?s:Array.isArray(s==null?void 0:s.rows)?s.rows:Array.isArray(s==null?void 0:s.data)?s.data:[]:[];function os(){const{user:s}=re(),[f,n]=i.useState([]),[v,x]=i.useState(!0),[l,r]=i.useState(null),[N,p]=i.useState(!1),[d,j]=i.useState(null),[y,w]=i.useState(""),[S,b]=i.useState(!1),[T,h]=i.useState(null);i.useEffect(()=>{(async()=>{x(!0),r(null),w("Starting to load campaigns...");try{const m=s||null;if(m&&!ie(m,"campaigns")){console.log("CampaignsPage: User does not have campaigns access"),b(!1),x(!1),w("User does not have access to Campaigns feature.");return}b(!0);try{const A=await R.get("/public/campaigns");n(I(A)),w(se=>se+`
Loaded ${I(A).length} campaigns.`)}catch(A){console.error("CampaignsPage: Failed to load campaigns:",A),r(`Failed to load campaigns: ${A.message||A}`),n([])}}catch(m){console.error("CampaignsPage: Critical error loading user or initial data:",m);const A=`Failed to load initial data (user/access): ${m.message}`;r(A),b(!1),w(`CRITICAL ERROR: ${A}`)}finally{x(!1)}})()},[s]);const t=()=>{j(null),p(!0)},a=o=>{j(o),p(!0)},c=async o=>{p(!1),j(null),x(!0);try{const m=await R.get("/public/campaigns");n(I(m)),r(null)}catch(m){console.error("Failed to refresh campaigns after save:",m),r(`Failed to refresh campaigns: ${m.message}`)}finally{x(!1)}},u=async o=>{x(!0);try{const m=await R.get("/crm/campaigns");n(I(m)),r(null)}catch(m){console.error("Failed to refresh campaigns after delete:",m),r(`Failed to refresh campaigns: ${m.message}`)}finally{x(!1)}},E=async(o,m)=>{console.warn("Toggle action is disabled until write API is available")};return v?e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 h-full bg-[#F6F8FB] min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1E5EFF] mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading data..."}),y&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded text-xs text-gray-700 max-w-md",children:["Debug: ",y]})]}):N||d?e.jsx(Ie,{campaign:d,onSave:c,onClose:()=>{p(!1),j(null)}}):e.jsxs("div",{className:"p-6 bg-[#F6F8FB] min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:["Q4 Prospecting","Reactivation Push","Freight Expo Leads","Top Lanes Outreach"].map((o,m)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow border p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Smoke Test"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:o}),e.jsx("div",{className:"text-xs text-gray-500",children:"Leads: â€” | Status: Draft"})]},m))}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Campaigns"}),e.jsxs(g,{onClick:t,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),l&&e.jsxs(_e,{variant:"destructive",className:"mb-6",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Ce,{children:"Data Loading Error"}),e.jsxs(ke,{children:[l,e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"This indicates a backend connectivity issue or missing data. Please contact Base44 support if this persists."}),y&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs",children:"Technical Details"}),e.jsx("pre",{className:"text-xs mt-1 bg-gray-100 p-2 rounded whitespace-pre-wrap",children:y})]})]})]}),f.length===0&&!v&&!l&&e.jsx(C,{className:"text-center p-12 border-2 border-dashed",children:e.jsxs(k,{children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No campaigns yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new outreach campaign."}),e.jsx("div",{className:"mt-6",children:e.jsxs(g,{onClick:t,children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Create Campaign"]})})]})}),!v&&!l&&f.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(o=>e.jsx(Ee,{campaign:o,onToggle:E,onEdit:a,onDelete:u,onClick:m=>h(m)},o.id))})]}),T&&e.jsx(Fe,{campaign:T,onClose:()=>h(null)})]})}export{os as default};
