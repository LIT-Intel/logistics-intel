import{c as re,r as l,j as e,a as G,B as d,M as E,R as le,u as ie,S as I}from"./main-BwGWMDCi.js";import{CompanySave as T,Company as ne,User as oe}from"./entities-CnsKiLH-.js";import{I as ce}from"./input-Dw7a9WQL.js";import{c as W}from"./index-DR9D_4bA.js";import{c as q}from"./planLimits-C4PMM81i.js";import{L as de}from"./LockedFeature-MkPzR9BK.js";import{B as me}from"./badge-u5ZeETXz.js";import{D as H,a as Q,E as J,b as X,c as S,d as Y,T as xe}from"./NotesTab-B_nF1Pwf.js";import{m as U}from"./proxy-DRIoWjtJ.js";import{M as Z}from"./map-pin-BAz9Zrx6.js";import{E as O}from"./eye-CNpJo64c.js";import{T as K}from"./trash-2-BRf9Ug2A.js";import{S as $}from"./ship-CzOlKfq2.js";import{T as ee,P as he}from"./truck-BzQ1-Eds.js";import{f as se}from"./format-DIePDvv_.js";import{U as ue}from"./UpgradePrompt-X7jmYcgT.js";import{C as pe}from"./CompanyDetailModal-DQJosPmD.js";import{C as ge}from"./circle-alert-BpzwTfDp.js";import{L as fe}from"./list-B1QALGKY.js";import{A as je}from"./index-CGLJIyoO.js";import"./base44Client-C-YMJfZQ.js";import"./textarea-BtZvDFSN.js";import"./crown-CrBRgMro.js";import"./select-BVIETwTL.js";import"./index-v5Hq-Jwm.js";import"./label-B_k9YyLN.js";import"./index-B1OJoX7J.js";import"./tabs-CUfPoQKT.js";import"./functions-DLmuSLgl.js";import"./loader-circle-C-mQTauK.js";import"./plus-ZQB9w3xX.js";import"./users-rmwcVKVM.js";import"./message-square-DIcLcI0k.js";import"./zap-BicKmCma.js";import"./arrow-right-BCoVdI65.js";import"./dialog-C_kz_kbv.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ye=re("Grid3x3",Ne);function ve({company:s,onDelete:j,onView:p,onStartOutreach:i}){var x,C;const[g,f]=l.useState(!1),u=r=>r==null||isNaN(r)?"N/A":r>=1e6?`${(r/1e6).toFixed(1)}M kg`:r>=1e3?`${(r/1e3).toFixed(0)}K kg`:`${r.toFixed(0)} kg`,b=s.total_weight_12m||0,k=s.shipments_12m||0,w=((x=s.top_routes)==null?void 0:x[0])||"Various routes",a=((C=s.top_carriers)==null?void 0:C[0])||"Multiple carriers",m=(r=>!r||typeof r!="object"?[]:Object.entries(r).filter(([,c])=>c>5).sort(([,c],[,N])=>N-c).slice(0,2))(s.mode_mix_json),_=()=>{f(!1),j?j(s.id):console.warn("onDelete handler not provided to CompanyCard")};return e.jsxs(U.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-2},className:"bg-white/90 backdrop-blur-sm rounded-2xl p-5 shadow-lg border border-gray-200/60 hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate text-lg mb-1",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.industry||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:[s.hq_city,s.hq_country].filter(Boolean).join(", ")||"N/A"})]})]})]}),e.jsxs(H,{open:g,onOpenChange:f,children:[e.jsx(Q,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs(X,{align:"end",children:[e.jsxs(S,{onClick:p,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(S,{onClick:()=>i(s),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Start Outreach"]}),e.jsx(Y,{}),e.jsxs(S,{onClick:_,className:"text-red-600 focus:bg-red-50 focus:text-red-700",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"Total Weight (12m)"}),e.jsx("div",{className:"text-base font-bold text-blue-900",children:u(b)})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-purple-600 font-medium",children:"Shipments"}),e.jsx("div",{className:"text-base font-bold text-purple-900",children:k.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Route:"}),e.jsx("span",{className:"font-medium text-gray-900 truncate flex-1",children:w})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Carrier:"}),e.jsx("span",{className:"font-medium text-gray-900 truncate flex-1",children:a})]})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(([r,c])=>{const N={ocean:"bg-blue-100 text-blue-800",air:"bg-purple-100 text-purple-800",truck:"bg-green-100 text-green-800",rail:"bg-orange-100 text-orange-800"};return e.jsxs(me,{className:`text-xs ${N[r]||"bg-gray-100 text-gray-800"}`,children:[r.charAt(0).toUpperCase()+r.slice(1)," ",Math.round(c),"%"]},r)})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.enrichment_status==="enriched"?"bg-green-500":s.enrichment_status==="pending"?"bg-yellow-500":"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:s.enrichment_status||"none"})]}),e.jsx("span",{children:s.last_seen?`Last: ${se(new Date(s.last_seen),"MMM d")}`:"No recent activity"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:p,className:"flex-1",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",onClick:()=>i(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Contact"]})]})]})}function be({company:s,onUpdate:j,onView:p,onStartOutreach:i,onDelete:g,index:f=0}){var c,N;const[u,b]=l.useState(!1),k=o=>o?o>=1e6?`${(o/1e6).toFixed(1)}M kg`:o>=1e3?`${(o/1e3).toFixed(0)}K kg`:`${o.toFixed(0)} kg`:"N/A",w=s.total_weight_12m||0,a=s.shipments_12m||0,F=((c=s.top_routes)==null?void 0:c[0])||"Various routes",m=((N=s.top_carriers)==null?void 0:N[0])||"Multiple carriers",x=(o=>{if(!o||typeof o!="object")return null;const M=Object.entries(o);if(M.length===0)return null;const[D,h]=M.reduce((P,A)=>P[1]>A[1]?P:A);return{mode:D,percentage:Math.round(h)}})(s.mode_mix_json),C=o=>({ocean:$,air:he,truck:ee,rail:xe})[o]||$,r=async()=>{g?g(s.id):console.warn("onDelete prop not provided to CompanyListItem. Cannot delete company."),b(!1)};return e.jsx(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:f*.05},className:"p-4 hover:bg-gray-50/80 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsx("div",{className:`w-2 h-2 rounded-full ${s.enrichment_status==="enriched"?"bg-green-500":s.enrichment_status==="pending"?"bg-yellow-500":"bg-gray-300"}`,title:`Enrichment status: ${s.enrichment_status||"N/A"}`})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",title:"Industry",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{children:s.industry||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-1",title:"Headquarters location",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:[s.hq_city,s.hq_country].filter(Boolean).join(", ")||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{title:"Total weight shipped in last 12 months",children:[e.jsx("span",{className:"text-gray-500",children:"Weight (12m):"}),e.jsx("span",{className:"ml-1 font-medium text-blue-700",children:k(w)})]}),e.jsxs("div",{title:"Total shipments in last 12 months",children:[e.jsx("span",{className:"text-gray-500",children:"Shipments:"}),e.jsx("span",{className:"ml-1 font-medium text-purple-700",children:a.toLocaleString()})]}),e.jsxs("div",{className:"md:col-span-2",title:"Top shipping route",children:[e.jsx("span",{className:"text-gray-500",children:"Route:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900 truncate",children:F})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm mt-2",children:[e.jsxs("div",{title:"Primary shipping carrier",children:[e.jsx("span",{className:"text-gray-500",children:"Primary Carrier:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900 truncate",children:m})]}),x&&e.jsxs("div",{className:"flex items-center gap-1",title:`Primary mode of transport: ${x.mode}`,children:[e.jsx("span",{className:"text-gray-500",children:"Main Mode:"}),le.createElement(C(x.mode),{className:"w-3 h-3 text-gray-600 ml-1 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-gray-900 capitalize",children:[x.mode," (",x.percentage,"%)"]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:s.last_seen?`Last activity: ${se(new Date(s.last_seen),"MMM d, yyyy")}`:"No recent activity"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:p,className:"hidden sm:inline-flex",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",onClick:()=>i(s),className:"bg-blue-600 hover:bg-blue-700 text-white hidden sm:inline-flex",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Contact"]}),e.jsxs(H,{open:u,onOpenChange:b,children:[e.jsx(Q,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs(X,{align:"end",children:[e.jsxs(S,{onClick:p,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(S,{onClick:()=>i(s),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Start Outreach"]}),g&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsxs(S,{onClick:r,className:"text-red-600 focus:bg-red-50 focus:text-red-700",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]})]})]})]})})}function ls(){const[s,j]=l.useState([]),[p,i]=l.useState(!0),[g,f]=l.useState(null),[u,b]=l.useState(""),[k,w]=l.useState(!1),[a,F]=l.useState(null),[m,_]=l.useState("cards"),[x,C]=l.useState(null),[r,c]=l.useState(!1),[N,o]=l.useState(1),[M,D]=l.useState(0),[h,P]=l.useState(null),A=ie(),L=l.useCallback(async()=>{if(h===!1){console.log("ðŸš« Access denied. Not loading saved companies."),i(!1);return}if(!a){console.log("â³ Waiting for appUser to be loaded before fetching companies..."),i(!1);return}i(!0),f(null);try{console.log("ðŸ” Fetching CompanySave records for user:",a.email);const t=await T.filter({created_by:a.email});if(console.log("âœ… Found saved records:",t.length),await new Promise(v=>setTimeout(v,100)),t.length===0){console.log("ðŸ“ No saved companies found"),j([]),D(0),i(!1);return}const n=t.map(v=>v.company_id).filter(Boolean);console.log("ðŸ” Fetching details for company IDs:",n),await new Promise(v=>setTimeout(v,100));const y=await ne.filter({id:{op:"in",value:n}});console.log("âœ… Found company details:",y.length);const B=u.trim()?y.filter(v=>(v.name||"").toLowerCase().includes(u.toLowerCase())):y;j(B),D(B.length)}catch(t){console.error("âŒ Error loading saved companies:",t),f((t==null?void 0:t.message)||"Failed to load saved companies"),j([]),D(0)}finally{i(!1)}},[u,h,a]);l.useEffect(()=>{(async()=>{i(!0);try{console.log("ðŸ” Checking user access for 'company_details' feature...");const n=await oe.me();F(n);const y=q(n,"company_details");P(y),console.log(`âœ… Access for 'company_details': ${y}`),i(!1)}catch(n){console.error("âŒ Error checking feature access or loading user:",n),P(!1),f("Failed to check access. Please try again."),i(!1)}})()},[]),l.useEffect(()=>{if(h===!0&&a){const t=setTimeout(()=>{L()},300);return()=>clearTimeout(t)}else h===!0&&!a&&i(!0)},[u,L,h,a]);const te=t=>{t.key==="Enter"&&L()},R=t=>{if(!q(a,"company_details")){console.log("ðŸš« User does not have access to 'company_details'. Showing upgrade prompt."),w(!0);return}C(t),c(!0)},z=t=>{console.log("ðŸš€ Starting outreach for company:",t.name),A(W(`EmailCenter?company_id=${t.id}`))},V=async t=>{if(!a){console.warn("User not loaded. Cannot delete company save record."),alert("User not logged in. Cannot delete company.");return}if(window.confirm("Are you sure you want to remove this company from your saved list?"))try{console.log("ðŸ” Attempting to delete CompanySave record for company ID:",t,"by user:",a.email);const n=await T.filter({created_by:a.email,company_id:t});n.length>0?(await T.delete(n[0].id),console.log("âœ… Company save record successfully deleted."),L()):(console.log("âŒ No matching CompanySave record found for deletion."),alert("Company save record not found."))}catch(n){console.error("âŒ Failed to remove company from saved list:",n),alert("Failed to remove company. Please try again.")}},ae=()=>{console.log("ðŸ“ Company is already saved - no action needed from modal save button.")};return p&&h===null?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):h===!1?(console.log("ðŸ”’ Displaying LockedFeature due to denied access."),e.jsx(de,{featureName:"Viewing Saved Companies"})):e.jsx("div",{className:"p-4 md:p-6 lg:p-8 bg-gradient-to-br from-gray-50 to-blue-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 lg:mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900",children:"Companies â€” Prospecting & Outreach"}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base",children:"Saving from Search adds to Prospecting. Add to Campaign to move to Outreach."}),a&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["User: ",a.email," | Plan: ",a.plan||"free"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs(d,{variant:"secondary",className:"w-full sm:w-auto",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsx(d,{className:"w-full sm:w-auto",children:"Add Company"})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 shadow-lg border border-gray-200/60 mb-6 md:mb-8",children:e.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{placeholder:"Search your saved companies by name...",value:u,onChange:t=>b(t.target.value),onKeyPress:te,className:"pl-10 bg-gray-50 border-0 text-base"}),e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})})}),g&&e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-6 flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Data Retrieval Error"}),e.jsx("p",{children:g})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-gray-600 text-sm md:text-base",children:["Showing"," ",e.jsxs("span",{className:"font-medium",children:[s.length," of ",M," saved companies"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsxs(d,{variant:m==="cards"?"default":"ghost",size:"sm",onClick:()=>_("cards"),className:"h-8 px-3",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Cards"]}),e.jsxs(d,{variant:m==="list"?"default":"ghost",size:"sm",onClick:()=>_("list"),className:"h-8 px-3",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),"List"]})]})})]}),e.jsx(je,{mode:"wait",children:p&&h!==!1?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.length>0?e.jsx(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:m==="cards"?"max-w-[1440px] mx-auto px-5 grid gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 overflow-hidden",children:s.map((t,n)=>m==="cards"?e.jsx(ve,{company:t,onDelete:()=>V(t.id),onView:()=>R(t),onStartOutreach:()=>z(t)},t.id):e.jsx(be,{company:t,onView:()=>R(t),onStartOutreach:()=>z(t),onDelete:()=>V(t.id),index:n},t.id))},m):e.jsxs("div",{className:"text-center py-12 md:py-16",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-600 mb-2",children:"No Saved Companies Found"}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm md:text-base px-4",children:"Go to the Search page to find and save companies to your list."}),e.jsxs(d,{onClick:()=>A(W("Search")),className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Find Companies to Save"]})]})}),e.jsx(pe,{isOpen:r,onClose:()=>c(!1),company:x,user:a,onSave:ae}),e.jsx(ue,{isOpen:k,onClose:()=>w(!1),feature:"company_details",currentPlan:a==null?void 0:a.plan})]})})}export{ls as default};
