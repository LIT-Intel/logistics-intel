const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["entities-BF_CoRhL.js","base44Client-C-YMJfZQ.js"])))=>i.map(i=>d[i]);
import{j as e,C as V,a as $,b as z,c as G,r as i,x as N,B,u as le,_ as F}from"./index-BAKPb1QP.js";import{User as R}from"./entities-BF_CoRhL.js";import{c as S}from"./index-A7ElDbZk.js";import{U as ne}from"./users-BRdwJaYn.js";import{c as Q}from"./createLucideIcon-BDqU3BKp.js";import{B as ie}from"./building-2-BVbKPFX-.js";import{S as Y}from"./search-j_ivXtL6.js";import{C as ce}from"./chart-no-axes-column-increasing-C9esmGRb.js";import{R as oe,B as de,E as me,X as xe,Y as J,F as he,I as K}from"./BarChart-Bs_6tajx.js";import{t as H,c as ue,f as A,M as fe}from"./format-BguTH7K8.js";import{B as D}from"./badge-BphqTXNQ.js";import{P as ge}from"./progress-CGoiuDYr.js";import{D as pe,e as je,a as ye,b as Ne,c as be,d as we,f as ve}from"./dialog-BavuU3xq.js";import{F as _e}from"./file-text-DUNKPEqY.js";import{L as Ce}from"./list-Lj1ZqIMm.js";import{C as De}from"./circle-check-big-10rvB9dz.js";import{C as Ae}from"./circle-alert-Bn4z-dCg.js";import{I as Se}from"./input-kNnbxgwk.js";import{S as M,a as P,b as I,c as L,d as f}from"./select-DB9F_2eo.js";import{U as Te}from"./user-BTi64Kw-.js";import"./base44Client-C-YMJfZQ.js";import"./isEqual-n8UrzhI3.js";import"./index-DHyO2_ME.js";import"./Combination-rUOcQgBM.js";import"./index-BQqhOIv6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Re=Q("Percent",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Fe=Q("UserCheck",Ue);function Me(s,a){const t=H(s);return isNaN(a)?ue(s,NaN):(a&&t.setDate(t.getDate()+a),t)}function q(s,a){const t=H(s),r=H(a);return t.getTime()>r.getTime()}function E(s,a){return Me(s,-a)}const w=({title:s,value:a,icon:t,change:r})=>e.jsxs(V,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium text-gray-600",children:s}),e.jsx(t,{className:"h-5 w-5 text-purple-500"})]}),e.jsxs(G,{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:a}),r&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]})]});function Pe({data:s}){return e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsx(w,{title:"Total Users",value:s.totalUsers,icon:ne}),e.jsx(w,{title:"Weekly Active Users",value:s.activeUsers,icon:Fe}),e.jsx(w,{title:"Total Companies",value:s.totalCompanies,icon:ie}),e.jsx(w,{title:"Total Searches",value:s.totalSearches,icon:Y}),e.jsx(w,{title:"Avg Searches/User",value:s.avgSearchesPerUser,icon:ce}),e.jsx(w,{title:"Enrichment Rate",value:`${s.enrichmentRate}%`,icon:Re})]})}function Ie({users:s,searches:a}){const r=(()=>{const d=new Date,x=Array.from({length:30},(h,o)=>{const g=E(d,29-o);return{date:A(g,"MMM dd"),signups:0,searches:0}});return s.forEach(h=>{const o=new Date(h.created_date),g=E(d,30);if(q(o,g)){const n=A(o,"MMM dd"),c=x.find(u=>u.date===n);c&&c.signups++}}),a.forEach(h=>{const o=new Date(h.created_date),g=E(d,30);if(q(o,g)){const n=A(o,"MMM dd"),c=x.find(u=>u.date===n);c&&c.searches++}}),x})();return e.jsxs(V,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx($,{children:e.jsx(z,{children:"User Activity (Last 30 Days)"})}),e.jsx(G,{children:e.jsx("div",{className:"h-[350px]",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(de,{data:r,children:[e.jsx(me,{strokeDasharray:"3 3",vertical:!1}),e.jsx(xe,{dataKey:"date",tick:{fontSize:12}}),e.jsx(J,{yAxisId:"left",orientation:"left",stroke:"#8884d8",tick:{fontSize:12}}),e.jsx(J,{yAxisId:"right",orientation:"right",stroke:"#82ca9d",tick:{fontSize:12}}),e.jsx(he,{}),e.jsx(K,{yAxisId:"left",dataKey:"signups",fill:"#8884d8",name:"New Signups"}),e.jsx(K,{yAxisId:"right",dataKey:"searches",fill:"#82ca9d",name:"Searches"})]})})})})]})}const O=i.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:N("w-full caption-bottom text-sm",s),...a})}));O.displayName="Table";const W=i.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:N("[&_tr]:border-b",s),...a}));W.displayName="TableHeader";const X=i.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:N("[&_tr:last-child]:border-0",s),...a}));X.displayName="TableBody";const Le=i.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:N("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));Le.displayName="TableFooter";const k=i.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));k.displayName="TableRow";const v=i.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:N("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));v.displayName="TableHead";const b=i.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:N("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));b.displayName="TableCell";const Ee=i.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:N("mt-4 text-sm text-muted-foreground",s),...a}));Ee.displayName="TableCaption";function Be({jobs:s}){const a=(r,d)=>{switch(r){case"processing":return e.jsx(D,{className:"bg-yellow-100 text-yellow-800",children:"Processing"});case"completed":return d>0?e.jsx(D,{className:"bg-orange-100 text-orange-800",children:"Completed with Errors"}):e.jsx(D,{className:"bg-green-100 text-green-800",children:"Completed"});case"failed":return e.jsx(D,{className:"bg-red-100 text-red-800",children:"Failed"});default:return e.jsx(D,{variant:"outline",children:r})}},t=(r,d)=>!r||r.length===0?e.jsxs("p",{className:"text-gray-500 text-sm",children:["No ",d," logs for this job."]}):e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:r.map((x,h)=>e.jsx("li",{className:"text-sm",children:x},h))});return e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 overflow-hidden",children:e.jsxs(O,{children:[e.jsx(W,{children:e.jsxs(k,{children:[e.jsx(v,{children:"File Name"}),e.jsx(v,{children:"Date"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-center",children:"Progress"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(X,{children:s&&s.length>0?s.map(r=>e.jsxs(k,{children:[e.jsxs(b,{className:"font-medium flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-500"}),r.file_name]}),e.jsx(b,{children:A(new Date(r.created_date),"MMM dd, yyyy HH:mm")}),e.jsx(b,{children:a(r.status,r.error_rows)}),e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ge,{value:r.total_rows>0?r.processed_rows/r.total_rows*100:0,className:"w-full h-2 mb-1"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.processed_rows||0," / ",r.total_rows||0," rows"]}),e.jsxs("div",{className:"text-xs flex gap-4 mt-1",children:[e.jsxs("span",{className:"text-green-600",children:["✓ ",r.success_rows||0]}),e.jsxs("span",{className:"text-red-600",children:["✗ ",r.error_rows||0]})]})]})}),e.jsx(b,{className:"text-right",children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(B,{variant:"ghost",size:"sm",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"View Log"]})}),e.jsxs(ye,{className:"sm:max-w-3xl",children:[e.jsx(Ne,{children:e.jsxs(be,{children:["Import Log: ",r.file_name]})}),e.jsxs("div",{className:"py-4 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),"Success Log"]}),e.jsx("div",{className:"p-3 bg-green-50/50 rounded-lg",children:t(r.success_log,"success")})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-red-600"}),"Error Log"]}),e.jsx("div",{className:"p-3 bg-red-50/50 rounded-lg",children:t(r.error_log,"error")})]})]}),e.jsx(we,{children:e.jsx(ve,{asChild:!0,children:e.jsx(B,{variant:"outline",children:"Close"})})})]})]})})]},r.id)):e.jsx(k,{children:e.jsx(b,{colSpan:"5",className:"h-24 text-center",children:"No import jobs found."})})})]})})})}function He({users:s,onUserUpdate:a}){const[t,r]=i.useState(""),[d,x]=i.useState("all"),h=s.filter(n=>{var p,_;const c=!t||((p=n.full_name)==null?void 0:p.toLowerCase().includes(t.toLowerCase()))||((_=n.email)==null?void 0:_.toLowerCase().includes(t.toLowerCase())),u=d==="all"||n.plan===d;return c&&u}),o=async(n,c)=>{try{await R.update(n,{plan:c}),a&&a()}catch(u){console.error("Failed to update user plan:",u)}},g=async(n,c)=>{try{await R.update(n,{role:c}),a&&a()}catch(u){console.error("Failed to update user role:",u)}};return e.jsxs(V,{className:"bg-white/80 backdrop-blur-sm shadow-lg border-none",children:[e.jsx($,{children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx(z,{children:"User Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Se,{placeholder:"Search users...",value:t,onChange:n=>r(n.target.value),className:"pl-10 w-full sm:w-64"})]}),e.jsxs(M,{value:d,onValueChange:x,children:[e.jsx(P,{className:"w-full sm:w-40",children:e.jsx(I,{placeholder:"Filter by plan"})}),e.jsxs(L,{children:[e.jsx(f,{value:"all",children:"All Plans"}),e.jsx(f,{value:"free",children:"Free"}),e.jsx(f,{value:"starter",children:"Starter"}),e.jsx(f,{value:"growth",children:"Growth"}),e.jsx(f,{value:"growth_plus",children:"Growth+"})]})]})]})]})}),e.jsx(G,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Plan"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Joined"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:h.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:n.full_name||"No name"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.email})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(M,{value:n.plan||"free",onValueChange:c=>o(n.id,c),children:[e.jsx(P,{className:"w-32",children:e.jsx(I,{})}),e.jsxs(L,{children:[e.jsx(f,{value:"free",children:"Free"}),e.jsx(f,{value:"starter",children:"Starter"}),e.jsx(f,{value:"growth",children:"Growth"}),e.jsx(f,{value:"growth_plus",children:"Growth+"})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(M,{value:n.role||"user",onValueChange:c=>g(n.id,c),children:[e.jsx(P,{className:"w-28",children:e.jsx(I,{})}),e.jsxs(L,{children:[e.jsx(f,{value:"user",children:"User"}),e.jsx(f,{value:"admin",children:"Admin"})]})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:A(new Date(n.created_date),"MMM dd, yyyy")}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(B,{variant:"outline",size:"sm",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Contact"]})})]},n.id))})]}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your criteria."})]})})]})}function T(s){if(Array.isArray(s))return s;if(!s||typeof s!="object")return[];const a=[s.data,s.items,s.list,s.results,s.records];for(const t of a)if(Array.isArray(t))return t;return[]}function xs(){const s=le(),[a,t]=i.useState(null),[r,d]=i.useState([]),[x,h]=i.useState([]),[o,g]=i.useState([]),[n,c]=i.useState([]),[u,p]=i.useState(!0),[_,C]=i.useState(null),U=i.useCallback(async()=>{p(!0),C(null);try{console.log("🔍 AdminDashboard: Loading user data...");const l=await R.me();if(console.log("🔍 AdminDashboard: User data loaded:",{email:l==null?void 0:l.email,role:l==null?void 0:l.role,full_name:l==null?void 0:l.full_name}),t(l||null),!l){console.log("❌ AdminDashboard: No user data found, redirecting..."),C("No user authentication found"),p(!1),setTimeout(()=>s(S("Dashboard")),2e3);return}if(l.role!=="admin"){console.log(`❌ AdminDashboard: User role '${l.role}' is not admin, redirecting...`),C(`Access denied. Your role is '${l.role}' but admin access is required.`),p(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}console.log("✅ AdminDashboard: Admin access confirmed, loading data...");try{const{Company:y}=await F(async()=>{const{Company:m}=await import("./entities-BF_CoRhL.js");return{Company:m}},__vite__mapDeps([0,1])),{SearchQuery:j}=await F(async()=>{const{SearchQuery:m}=await import("./entities-BF_CoRhL.js");return{SearchQuery:m}},__vite__mapDeps([0,1])),{ImportJob:ee}=await F(async()=>{const{ImportJob:m}=await import("./entities-BF_CoRhL.js");return{ImportJob:m}},__vite__mapDeps([0,1])),[se,ae,te,re]=await Promise.all([R.list("-created_date").catch(m=>(console.warn("Failed to load users:",m),[])),y.list("-created_date").catch(m=>(console.warn("Failed to load companies:",m),[])),j.list("-created_date",1e3).catch(m=>(console.warn("Failed to load search queries:",m),[])),ee.list("-created_date",50).catch(m=>(console.warn("Failed to load import jobs:",m),[]))]);d(T(se)),h(T(ae)),g(T(te)),c(T(re)),console.log("✅ AdminDashboard: All data loaded successfully")}catch(y){console.error("❌ AdminDashboard: Error loading entities:",y),C(`Failed to load admin data: ${y.message}`),p(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}}catch(l){console.error("❌ AdminDashboard: Error loading data:",l),C(`Failed to load admin data: ${l.message}`),p(!1),setTimeout(()=>s(S("Dashboard")),3e3);return}p(!1)},[s]);i.useEffect(()=>{U()},[U]);const Z={totalUsers:r.length,activeUsers:r.filter(l=>{const y=new Date;return y.setDate(y.getDate()-7),o.some(j=>(j==null?void 0:j.user_email)===(l==null?void 0:l.email)&&(j==null?void 0:j.created_date)&&new Date(j.created_date)>=y)}).length,totalCompanies:x.length,totalSearches:o.length,avgSearchesPerUser:r.length>0?Math.round(o.length/r.length):0,enrichmentRate:x.length>0?Math.round(x.filter(l=>(l==null?void 0:l.enrichment_status)==="enriched").length/x.length*100):0};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading admin dashboard..."})]})}):_?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h1",{className:"text-xl font-bold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-600 mb-4",children:_}),e.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting to dashboard..."})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded border text-sm text-left",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current User:"})," ",a.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",a.role||"undefined"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a.full_name||"undefined"]})]})]})}):!a||a.role!=="admin"?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current role: ",(a==null?void 0:a.role)||"undefined"]})]})}):e.jsx("div",{className:"p-6 md:p-8 bg-gradient-to-br from-purple-50 to-pink-50/30 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Platform analytics and user management"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Logged in as: ",a.email," (Role: ",a.role,")"]})]})}),e.jsx(Pe,{data:Z}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mt-8",children:[e.jsx(Ie,{users:r,searches:o}),e.jsx(Be,{jobs:n})]}),e.jsx("div",{className:"mt-8",children:e.jsx(He,{users:r,onUserUpdate:U})})]})})}export{xs as default};
